/* This file was generated by the Hex-Rays decompiler version 7.7.0.220118.
   Copyright (c) 2007-2021 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <windows.h>
#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int sub_401000();
int sub_4010ED();
int sub_4011DA();
// void __usercall sub_4012C7(int a1@<ebp>);
struct _PEB *sub_401309();
int sub_401315();
_DWORD *__thiscall sub_401330(_DWORD *this, int a2);
const char *__thiscall sub_40135D(_DWORD *this);
char *__thiscall sub_40136B(char *Block, char a2);
int __thiscall sub_401399(_DWORD *this);
_DWORD *__thiscall sub_4013AB(_DWORD *this);
void __stdcall __noreturn sub_4013C3(_DWORD); // weak
_DWORD *__thiscall sub_4013E0(_DWORD *this, int a2);
_DWORD *__thiscall sub_4013FB(_DWORD *this, int a2);
void __noreturn sub_401416(void); // weak
int __cdecl sub_401422(int a1);
int __fastcall sub_40143C(char a1);
void __thiscall sub_4015D7(_DWORD *this);
int __thiscall sub_4015E7(int this, int a2);
int __thiscall sub_40162C(int this, int a2);
int __thiscall sub_401656(int this, char *a2, unsigned __int64 a3, int a4);
void __thiscall sub_4016C5(int *this, unsigned int a2);
_DWORD *__thiscall sub_40171C(_DWORD *this, _DWORD *a2, int a3);
int *__thiscall sub_40174A(int *this);
int __fastcall sub_401774(int *a1, int *a2);
__int64 __cdecl sub_4017DF(unsigned __int64 a1);
__int64 __cdecl sub_40180F(__int64 a1);
unsigned __int64 __cdecl sub_40184B(__int64 a1, unsigned int a2, unsigned int a3);
int *__fastcall sub_4018A7(int *a1, _DWORD *a2);
int *__fastcall sub_4019A4(int *a1, _DWORD *a2);
// int __usercall sub_401A95@<eax>(int a1@<edx>, int a2@<ecx>, int a3);
// int *__usercall sub_401C41@<eax>(int *a1@<edx>, int *a2@<ecx>, int *a3);
// int __usercall sub_401E63@<eax>(int *a1@<edx>, int a2@<ecx>, char a3, _DWORD *a4, char a5);
int *__fastcall sub_401F2F(int *a1, int a2, unsigned int a3);
// int __usercall sub_4020C6@<eax>(int *a1@<edx>, int *a2@<ecx>, int a3, unsigned int a4);
// int __usercall sub_40213F@<eax>(int a1@<edx>, int a2@<ecx>, _DWORD *a3);
int *__thiscall sub_40218E(int *this, __int64 a2);
int *__thiscall sub_402266(int *this, unsigned int a2, int a3, int a4);
int __thiscall sub_4022E4(int this, int a2);
bool __thiscall sub_402339(int this, int a2);
_DWORD *__thiscall sub_402398(int this, _DWORD *a2, int a3);
_DWORD *__thiscall sub_4023D2(int this, _DWORD *a2, int a3);
int *__thiscall sub_402412(int *this, int *a2, int *a3);
void __thiscall sub_40245D(void *); // idb
void __thiscall sub_402462(_DWORD **this);
int __thiscall sub_4024DF(_DWORD *this, int a2, int a3, int a4, int a5, int a6, unsigned int a7);
int __thiscall sub_4027C6(void *this, int a2, int a3, unsigned int *a4);
int __thiscall sub_4028E9(void *this, int a2, __m128i **a3, char a4);
int __thiscall sub_402A7A(void *this);
bool __thiscall sub_402BA1(int *this);
int __thiscall sub_402E28(_DWORD *this);
_DWORD *__thiscall sub_402E58(_DWORD *this, int a2);
unsigned int *__thiscall sub_402EC4(int this, unsigned int *a2, __int64 a3, __int64 a4, int a5, int a6, char a7);
_DWORD *__thiscall sub_402FCE(int this, _DWORD *a2, __int64 a3, int a4, char a5);
int __thiscall sub_403136(int this);
int __thiscall sub_403192(int this, int a2);
int __thiscall sub_4031E5(int this, int a2);
int __thiscall sub_403304(_BYTE *this);
// int __thiscall std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(_DWORD); weak
int __thiscall sub_40339B(_DWORD *this);
void __thiscall sub_4033BD(_DWORD **this);
_DWORD *__thiscall sub_4033E0(_DWORD *this, char a2);
_BYTE *__thiscall sub_403412(_BYTE *Block, char a2);
char *__thiscall sub_403434(char *this, char a2);
_DWORD *__thiscall sub_403466(int this, _DWORD *a2);
_DWORD *__thiscall sub_4034FB(_DWORD *this, char a2);
_DWORD *__thiscall sub_40354F(_DWORD *this, _DWORD *a2, unsigned int a3, int a4, int a5);
_DWORD *__thiscall sub_403606(_DWORD *this, void *Src, size_t Size);
void __noreturn sub_4036A4(void); // weak
void __thiscall sub_4036B0(_DWORD *this, unsigned int a2, _DWORD *a3);
_DWORD *__thiscall sub_403756(size_t Size);
void __fastcall sub_403795(_DWORD *Block, unsigned int a2);
int __thiscall sub_4037C2(int *this);
int __thiscall sub_4037E8(_DWORD *this, int a2);
void __noreturn sub_40381C(void); // weak
_DWORD *__stdcall sub_403828(unsigned int a1);
int __thiscall sub_403848(int this, unsigned int a2, int a3);
char *__thiscall sub_4038D2(void **this, char *Src, int a3, int a4);
_DWORD *__thiscall sub_403966(int this, const void *a2, _DWORD *a3);
int __thiscall sub_403A31(_DWORD *this, int a2, int a3, int a4);
_DWORD *__thiscall sub_403A66(_DWORD *this, unsigned int a2);
char *__thiscall sub_403ACC(char *this, char a2);
_DWORD *__thiscall sub_403AD4(_DWORD *this, char a2);
int __fastcall sub_403ADC(int a1, int a2);
// _DWORD *__userpurge sub_403C42@<eax>(int a1@<ebp>, _DWORD *a2, _BYTE *a3, _BYTE *a4, int a5, int a6);
// int __userpurge sub_403D15@<eax>(int a1@<ebp>, unsigned int a2, int a3, int a4);
void __stdcall sub_403E63(unsigned int a1, _DWORD *a2);
_DWORD *__stdcall sub_403EBC(unsigned int a1, _DWORD *a2);
// _DWORD *__usercall sub_403F89@<eax>(_DWORD *a1@<ecx>, int a2@<edx>, _DWORD *a3);
_DWORD *__thiscall sub_403FE2(int *this, _DWORD *a2, int a3);
int sub_40403A();
int sub_4040E3();
int sub_40418B();
int __cdecl main(int argc, const char **argv, const char **envp);
void __noreturn sub_4044BC(void); // weak
void __thiscall sub_4044EF(void **this);
_DWORD *__thiscall sub_404508(_DWORD *this, _BYTE *a2, int a3);
void __thiscall sub_40452E(void **this);
void **__thiscall sub_404533(void **this, int a2, int a3);
int __thiscall sub_40459E(int this, _DWORD *a2);
_DWORD *__thiscall sub_4045CA(_DWORD *this, _DWORD *Src);
void __thiscall sub_404651(_DWORD *this, size_t Size, _BYTE *a3, int a4);
void __thiscall sub_404691(void **this);
void __thiscall sub_4046D0(int *this);
_DWORD *__thiscall sub_4046ED(_DWORD *this);
// _DWORD *__usercall sub_4047C7@<eax>(_DWORD *a1@<edx>, _DWORD *a2@<ecx>, _DWORD *a3);
int __fastcall sub_4048B4(int a1, const char *a2);
int __cdecl sub_404A45(int); // weak
void *__fastcall sub_404A74(unsigned int a1);
_DWORD *__thiscall sub_404A94(_DWORD *this, int a2, int a3, char a4);
int __thiscall sub_404B41(int *this);
int __thiscall sub_404B64(int *this);
_BYTE *__thiscall sub_404BB5(_BYTE *this, int a2);
void **__thiscall sub_404C1C(void **this, unsigned int a2);
int __thiscall sub_404C57(int *this);
int __thiscall sub_404C9F(int this, _DWORD *a2);
// int __usercall sub_404CD6@<eax>(_DWORD *a1@<edx>, int a2@<ecx>, unsigned __int8 a3);
char *__thiscall sub_404E21(char **this, char *a2, int a3, int a4);
_DWORD *__thiscall sub_404F0B(_DWORD *this, size_t Size);
__m128i *__cdecl sub_404F50(__m128i *a1, __m128i *a2);
// void *__cdecl operator new(size_t Size); idb
// void __stdcall `eh vector destructor iterator'(void *, unsigned int, unsigned int, void (__thiscall *)(void *)); idb
void __cdecl j_free(void *Block);
void __cdecl sub_4051A8(void *Block);
_DWORD *__thiscall sub_4051B6(_DWORD *Block, char a2);
// void __stdcall `eh vector constructor iterator'(void *, unsigned int, unsigned int, void (__thiscall *)(void *), void (__thiscall *)(void *)); idb
// int __thiscall __report_rangecheckfailure(_DWORD); weak
// int __cdecl atexit(void (__cdecl *)());
int sub_405746();
int sub_40574E();
int sub_4058EC();
_DWORD *__thiscall sub_405AC0(_DWORD *this);
void __noreturn sub_405AD8(); // weak
int sub_405B77();
int __cdecl UserMathErrorFunction();
bool sub_405CAA();
LPTOP_LEVEL_EXCEPTION_FILTER sub_405CEC();
// LONG __stdcall __scrt_unhandled_exception_filter(struct _EXCEPTION_POINTERS *ExceptionInfo); idb
void sub_405D4E();
void sub_405DF4();
char sub_405E00();
void *sub_405E24();
void *sub_405E2A();
// int __scrt_initialize_default_local_stdio_options(void); weak
BOOL sub_405E4D();
void *sub_405E59();
void *sub_405E5F();
void sub_405E65();
void __cdecl sub_405E91(); // idb
// void __stdcall __noreturn CxxThrowException(void *pExceptionObject, _ThrowInfo *pThrowInfo);
// void *__cdecl memset(void *, int Val, size_t Size);
// int __cdecl set_new_mode(int NewMode);
void sub_4060C3();
// void *__cdecl memcpy(void *, const void *Src, size_t Size);
// void *__cdecl memmove(void *, const void *Src, size_t Size);
void __cdecl sub_40695D(); // idb
void __cdecl sub_406967(); // idb
void __cdecl sub_406971(); // idb
void __cdecl sub_40697B(); // idb
// int __thiscall std::streambuf::_Pninc(_DWORD); weak
// int __thiscall std::ios::ios(_DWORD); weak
// int __thiscall std::ostream::ostream(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::iostream::basic_iostream<char>(_DWORD, _DWORD, _DWORD); weak
// int __thiscall std::streambuf::~streambuf<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ostream::~ostream<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __cdecl std::uncaught_exceptions(); weak
// int __thiscall std::istream::_Ipfx(_DWORD, _DWORD); weak
// int __thiscall std::streambuf::snextc(_DWORD); weak
// int __thiscall std::ostream::_Osfx(_DWORD); weak
// int __thiscall std::streambuf::sputn(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::ios::setstate(_DWORD, _DWORD, _DWORD);
// int __thiscall std::ios::widen(_DWORD, _DWORD); weak
// int __thiscall std::ostream::put(_DWORD, _DWORD); weak
// int __thiscall std::ostream::flush(_DWORD); weak
// int __thiscall std::streambuf::sbumpc(_DWORD); weak
// int __thiscall std::streambuf::sgetc(_DWORD); weak
// int __thiscall std::streambuf::sputc(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int std::streambuf::streambuf(void); weak
// void __cdecl __noreturn std::_Xlength_error(const char *); weak
// int __cdecl std::setw(_DWORD, _DWORD, _DWORD); weak
// void __cdecl std::_Xout_of_range(const char *); weak
// int __cdecl _std_exception_destroy(_DWORD); weak
// int __cdecl _std_exception_copy(_DWORD, _DWORD); weak

//-------------------------------------------------------------------------
// Data declarations

// extern BOOL (__stdcall *IsProcessorFeaturePresent)(DWORD ProcessorFeature);
// extern HMODULE (__stdcall *GetModuleHandleW)(LPCWSTR lpModuleName);
// extern void (__stdcall *InitializeSListHead)(PSLIST_HEADER ListHead);
// extern LPTOP_LEVEL_EXCEPTION_FILTER (__stdcall *SetUnhandledExceptionFilter)(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// extern _UNKNOWN std::cin; weak
// extern void (__cdecl __noreturn *invalid_parameter_noinfo_noreturn)();
__int128 xmmword_4071E0 = 0x102030405060708090A0B0C0D0E0Fi64; // weak
void *type_info::`vftable' = &sub_4051B6; // weak
void *std::exception::`vftable' = &sub_40136B; // weak
void *std::bad_alloc::`vftable' = &sub_40136B; // weak
void *std::bad_array_new_length::`vftable' = &sub_40136B; // weak
int (__stdcall *off_4072C8)(int) = &sub_403AD4; // weak
_UNKNOWN unk_4072CC; // weak
int (__thiscall *off_4072D4)(void *Block, char) = &sub_403412; // weak
int (__stdcall *off_407310)(int) = &sub_403ACC; // weak
_UNKNOWN unk_407314; // weak
_UNKNOWN unk_40731C; // weak
int (__stdcall *off_407324)(int, int, int) = &sub_4027C6; // weak
const _ThrowInfo _TI2_AVbad_alloc_std__ = { 0u, &sub_401399, NULL, &_CTA2_AVbad_alloc_std__ }; // idb
const _ThrowInfo _TI3_AVbad_array_new_length_std__ = { 0u, &sub_401399, NULL, &_CTA3_AVbad_array_new_length_std__ }; // idb
int dword_40A004 = 1; // weak
int dword_40A010 = 1; // weak
int dword_40A3D8; // weak
int dword_40A3DC; // weak
int dword_40A3E0; // weak
union _SLIST_HEADER ListHead; // idb
_UNKNOWN unk_40A3F0; // weak
_UNKNOWN unk_40A3F8; // weak
int dword_40A400; // weak
int dword_40A404; // weak
_DWORD dword_40A408[2]; // weak
void *Block; // idb
void *dword_40A414; // idb
int dword_40A418; // weak
int dword_40A41C; // weak
int dword_40A420; // weak
int dword_40A424; // weak
_UNKNOWN unk_40A42C; // weak
_UNKNOWN unk_40A430; // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = 120779315;
  v6[1] = -1690852714;
  v6[2] = 987782044;
  v6[3] = -686254453;
  v6[4] = 620147277;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = 2034781181;
  v5[1] = -565763295;
  v5[2] = -1917053112;
  v5[3] = -784121239;
  v5[4] = 1211855279;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -737866525;
  v4[1] = -87013448;
  v4[2] = 1148744304;
  v4[3] = -387155722;
  v4[4] = 1002842513;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&dword_40A400, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_40695D);
}
// 40A400: using guessed type int dword_40A400;

//----- (004010ED) --------------------------------------------------------
int sub_4010ED()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = -1963204422;
  v6[1] = -1256440389;
  v6[2] = -1838863551;
  v6[3] = -1397570986;
  v6[4] = 91604784;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = 1450262758;
  v5[1] = 388979981;
  v5[2] = 963305469;
  v5[3] = -609091096;
  v5[4] = 783443537;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -2083184370;
  v4[1] = -628347752;
  v4[2] = 1833553915;
  v4[3] = 616564496;
  v4[4] = 1758939125;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&dword_40A424, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_406967);
}
// 40A424: using guessed type int dword_40A424;

//----- (004011DA) --------------------------------------------------------
int sub_4011DA()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = -431631174;
  v6[1] = 167467927;
  v6[2] = -2076276486;
  v6[3] = 350225387;
  v6[4] = -335311827;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = -1206364452;
  v5[1] = -274983458;
  v5[2] = 1755464728;
  v5[3] = -934355571;
  v5[4] = -8630772;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -1491598442;
  v4[1] = 1588880116;
  v4[2] = -1705674312;
  v4[3] = -856792348;
  v4[4] = -90173564;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&unk_40A408, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_406971);
}

//----- (004012C7) --------------------------------------------------------
void __usercall sub_4012C7(int a1@<ebp>)
{
  *(_BYTE *)(a1 - 22) = 1;
  *(_WORD *)(a1 - 24) = 0;
  *(_DWORD *)(a1 - 4) = 0;
  sub_403C42(a1, (_DWORD *)(a1 - 32), (_BYTE *)(a1 - 24), (_BYTE *)(a1 - 21), 0, 0);
  atexit(sub_40697B);
  sub_4060C3();
}

//----- (00401309) --------------------------------------------------------
struct _PEB *sub_401309()
{
  struct _PEB *result; // eax

  result = NtCurrentPeb();
  dword_40A420 = (int)result;
  return result;
}
// 40A420: using guessed type int dword_40A420;

//----- (00401315) --------------------------------------------------------
int sub_401315()
{
  sub_40403A();
  sub_4040E3();
  return sub_40418B();
}

//----- (00401330) --------------------------------------------------------
_DWORD *__thiscall sub_401330(_DWORD *this, int a2)
{
  *this = &std::exception::`vftable';
  this[1] = 0;
  this[2] = 0;
  _std_exception_copy(a2 + 4, this + 1);
  return this;
}
// 4070E8: using guessed type int __cdecl _std_exception_copy(_DWORD, _DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (0040135D) --------------------------------------------------------
const char *__thiscall sub_40135D(_DWORD *this)
{
  const char *result; // eax

  result = "Unknown exception";
  if ( this[1] )
    return (const char *)this[1];
  return result;
}

//----- (0040136B) --------------------------------------------------------
char *__thiscall sub_40136B(char *Block, char a2)
{
  *(_DWORD *)Block = &std::exception::`vftable';
  _std_exception_destroy(Block + 4);
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}
// 4070E4: using guessed type int __cdecl _std_exception_destroy(_DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (00401399) --------------------------------------------------------
int __thiscall sub_401399(_DWORD *this)
{
  *this = &std::exception::`vftable';
  return _std_exception_destroy(this + 1);
}
// 4070E4: using guessed type int __cdecl _std_exception_destroy(_DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (004013AB) --------------------------------------------------------
_DWORD *__thiscall sub_4013AB(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad array new length";
  *this = &std::bad_array_new_length::`vftable';
  return result;
}
// 40725C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (004013C3) --------------------------------------------------------
void __noreturn sub_4013C3()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_4013AB(pExceptionObject);
  CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI3_AVbad_array_new_length_std__);
}
// 4013C3: using guessed type void __noreturn sub_4013C3();
// 4013C3: using guessed type _DWORD pExceptionObject[3];

//----- (004013E0) --------------------------------------------------------
_DWORD *__thiscall sub_4013E0(_DWORD *this, int a2)
{
  sub_401330(this, a2);
  *this = &std::bad_array_new_length::`vftable';
  return this;
}
// 40725C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (004013FB) --------------------------------------------------------
_DWORD *__thiscall sub_4013FB(_DWORD *this, int a2)
{
  sub_401330(this, a2);
  *this = &std::bad_alloc::`vftable';
  return this;
}
// 407240: using guessed type void *std::bad_alloc::`vftable';

//----- (00401416) --------------------------------------------------------
void __noreturn sub_401416()
{
  std::_Xlength_error("string too long");
}
// 401416: using guessed type void __noreturn sub_401416();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (00401422) --------------------------------------------------------
int __cdecl sub_401422(int a1)
{
  int result; // eax

  result = a1;
  *(_DWORD *)(a1 + 20) = *(_DWORD *)(a1 + 20) & 0xFFFFF1FF | 0x800;
  return result;
}

//----- (0040143C) --------------------------------------------------------
int __fastcall sub_40143C(char a1)
{
  int result; // eax
  int v2; // [esp-4h] [ebp-4h]

  switch ( a1 )
  {
    case '0':
      return 0;
    case '1':
      return 1;
    case '2':
      v2 = 2;
      goto LABEL_6;
    case '3':
      v2 = 3;
      goto LABEL_6;
    case '4':
      v2 = 4;
      goto LABEL_6;
    case '5':
      v2 = 5;
      goto LABEL_6;
    case '6':
      v2 = 6;
      goto LABEL_6;
    case '7':
      v2 = 7;
      goto LABEL_6;
    case '8':
      v2 = 8;
      goto LABEL_6;
    case '9':
      v2 = 9;
      goto LABEL_6;
    case 'A':
    case 'a':
      v2 = 10;
      goto LABEL_6;
    case 'B':
    case 'b':
      v2 = 11;
      goto LABEL_6;
    case 'C':
    case 'c':
      v2 = 12;
      goto LABEL_6;
    case 'D':
    case 'd':
      v2 = 13;
      goto LABEL_6;
    case 'E':
    case 'e':
      v2 = 14;
      goto LABEL_6;
    case 'F':
    case 'f':
      v2 = 15;
      goto LABEL_6;
    case 'G':
    case 'g':
      v2 = 16;
      goto LABEL_6;
    case 'H':
    case 'h':
      v2 = 17;
      goto LABEL_6;
    case 'I':
    case 'i':
      v2 = 18;
      goto LABEL_6;
    case 'J':
    case 'j':
      v2 = 19;
      goto LABEL_6;
    case 'K':
    case 'k':
      v2 = 20;
      goto LABEL_6;
    case 'L':
    case 'l':
      v2 = 21;
      goto LABEL_6;
    case 'M':
    case 'm':
      v2 = 22;
      goto LABEL_6;
    case 'N':
    case 'n':
      v2 = 23;
      goto LABEL_6;
    case 'O':
    case 'o':
      v2 = 24;
      goto LABEL_6;
    case 'P':
    case 'p':
      v2 = 25;
      goto LABEL_6;
    case 'Q':
    case 'q':
      v2 = 26;
      goto LABEL_6;
    case 'R':
    case 'r':
      v2 = 27;
      goto LABEL_6;
    case 'S':
    case 's':
      v2 = 28;
      goto LABEL_6;
    case 'T':
    case 't':
      v2 = 29;
      goto LABEL_6;
    case 'U':
    case 'u':
      v2 = 30;
      goto LABEL_6;
    case 'V':
    case 'v':
      v2 = 31;
      goto LABEL_6;
    case 'W':
    case 'w':
      v2 = 32;
      goto LABEL_6;
    case 'X':
    case 'x':
      v2 = 33;
      goto LABEL_6;
    case 'Y':
    case 'y':
      v2 = 34;
      goto LABEL_6;
    case 'Z':
    case 'z':
      v2 = 35;
LABEL_6:
      result = v2;
      break;
    default:
      result = -1;
      break;
  }
  return result;
}

//----- (004015D7) --------------------------------------------------------
void __thiscall sub_4015D7(_DWORD *this)
{
  *this = 0;
  this[1] = 0;
  this[2] = 0;
  *((_BYTE *)this + 12) = 0;
}

//----- (004015E7) --------------------------------------------------------
int __thiscall sub_4015E7(int this, int a2)
{
  int result; // eax

  *(_DWORD *)this = 0;
  *(_DWORD *)(this + 4) = 0;
  *(_DWORD *)(this + 8) = 0;
  if ( this != a2 )
    sub_4038D2((void **)this, *(char **)a2, *(_DWORD *)(a2 + 4), this);
  result = this;
  *(_BYTE *)(this + 12) = *(_BYTE *)(a2 + 12);
  return result;
}

//----- (0040162C) --------------------------------------------------------
int __thiscall sub_40162C(int this, int a2)
{
  int result; // eax
  int v4; // [esp+8h] [ebp-4h]

  if ( this != a2 )
    sub_4038D2((void **)this, *(char **)a2, *(_DWORD *)(a2 + 4), v4);
  result = this;
  *(_BYTE *)(this + 12) = *(_BYTE *)(a2 + 12);
  return result;
}
// 401643: variable 'v4' is possibly undefined

//----- (00401656) --------------------------------------------------------
int __thiscall sub_401656(int this, char *a2, unsigned __int64 a3, int a4)
{
  char *v5; // edi
  char v6; // al
  unsigned __int64 v7; // rax
  int v8; // ecx

  *(_DWORD *)this = 0;
  *(_DWORD *)(this + 4) = 0;
  *(_DWORD *)(this + 8) = 0;
  v5 = a2;
  *(_BYTE *)(this + 12) = 0;
  v6 = *a2;
  if ( *a2 == 45 )
  {
    v5 = a2 + 1;
    *(_BYTE *)(this + 12) = 1;
    v6 = a2[1];
  }
  if ( v6 )
  {
    do
    {
      sub_40218E((int *)this, a3);
      LODWORD(v7) = sub_40143C(*v5);
      if ( v7 >= a3 )
        break;
      sub_402266((int *)this, v7, SHIDWORD(v7), v8);
      ++v5;
    }
    while ( *v5 );
  }
  return this;
}
// 4016A9: variable 'v7' is possibly undefined
// 4016B0: variable 'v8' is possibly undefined

//----- (004016C5) --------------------------------------------------------
void __thiscall sub_4016C5(int *this, unsigned int a2)
{
  char *v3; // ebx
  int v4; // edx
  unsigned int v5; // ecx
  char *v6; // eax
  size_t v7; // esi

  v3 = (char *)this[1];
  v4 = *this;
  v5 = (int)&v3[-*this] >> 3;
  if ( a2 >= v5 )
  {
    if ( a2 <= v5 )
      return;
    if ( a2 > (this[2] - v4) >> 3 )
    {
      sub_403848((int)this, a2, v5);
      return;
    }
    v7 = 8 * (a2 - v5);
    memset(v3, 0, v7);
    v6 = &v3[v7];
  }
  else
  {
    v6 = (char *)(v4 + 8 * a2);
  }
  this[1] = (int)v6;
}

//----- (0040171C) --------------------------------------------------------
_DWORD *__thiscall sub_40171C(_DWORD *this, _DWORD *a2, int a3)
{
  _DWORD *v4; // esi
  _DWORD *result; // eax
  int v6; // ecx

  v4 = (_DWORD *)this[1];
  if ( v4 == (_DWORD *)this[2] )
    return sub_403966((int)this, v4, &a2);
  result = a2;
  v6 = a3;
  *v4 = a2;
  v4[1] = v6;
  this[1] += 8;
  return result;
}

//----- (0040174A) --------------------------------------------------------
int *__thiscall sub_40174A(int *this)
{
  int v2; // edx
  int v3; // edi
  int v4; // ecx
  int v5; // eax

  v2 = this[1];
  v3 = *this;
  while ( (v2 - v3) >> 3 )
  {
    v4 = v2 - 8;
    v5 = *(_DWORD *)(v2 - 8);
    v2 = v4;
    if ( *(_DWORD *)(v4 + 4) | v5 )
      break;
    this[1] = v4;
  }
  return this;
}

//----- (00401774) --------------------------------------------------------
int __fastcall sub_401774(int *a1, int *a2)
{
  int v2; // esi
  int v3; // edi
  unsigned int v4; // eax
  unsigned int v5; // ecx
  unsigned int *v7; // ecx
  int v8; // esi
  unsigned int v9; // ebx
  unsigned int v10; // edx
  unsigned int v11; // edi
  bool v12; // cf
  bool v13; // cc

  v2 = *a1;
  v3 = *a2;
  v4 = (a1[1] - *a1) >> 3;
  v5 = (a2[1] - *a2) >> 3;
  if ( v4 != v5 )
    return v4 < v5 ? -1 : 1;
  if ( !v4 )
    return 0;
  v7 = (unsigned int *)(v3 + 8 * v4);
  v8 = v2 - v3;
  while ( 1 )
  {
    v7 -= 2;
    --v4;
    v9 = *(unsigned int *)((char *)v7 + v8);
    v10 = *(unsigned int *)((char *)v7 + v8 + 4);
    v11 = v7[1];
    if ( v9 != *v7 )
      break;
    v12 = v10 < v11;
    v13 = v10 <= v11;
    if ( v10 != v11 )
      goto LABEL_10;
    if ( !v4 )
      return 0;
  }
  v12 = v10 < v11;
  v13 = v10 <= v11;
LABEL_10:
  if ( v13 && (v12 || v9 < *v7) )
    return -1;
  else
    return 1;
}

//----- (004017DF) --------------------------------------------------------
__int64 __cdecl sub_4017DF(unsigned __int64 a1)
{
  _DWORD *v1; // ecx
  bool v2; // cf

  v2 = __CFADD__((_DWORD)a1, *v1);
  *v1 += a1;
  v1[1] += HIDWORD(a1) + v2;
  return *(_QWORD *)v1 < a1;
}
// 4017E5: variable 'v1' is possibly undefined

//----- (0040180F) --------------------------------------------------------
__int64 __cdecl sub_40180F(__int64 a1)
{
  unsigned int *v1; // ecx
  unsigned int v2; // edx
  unsigned int v3; // edi
  bool v4; // cf
  unsigned int v5; // esi
  unsigned int v6; // eax

  v2 = v1[1];
  v3 = *v1;
  v4 = *v1 < (unsigned int)a1;
  v5 = *v1 - a1;
  *v1 = v5;
  v6 = v2 - (v4 + HIDWORD(a1));
  v1[1] = v6;
  return __PAIR64__(v6, v5) > __PAIR64__(v2, v3);
}
// 401812: variable 'v1' is possibly undefined

//----- (0040184B) --------------------------------------------------------
unsigned __int64 __cdecl sub_40184B(__int64 a1, unsigned int a2, unsigned int a3)
{
  __int64 v3; // rdi

  v3 = (unsigned int)(__CFADD__((a1 * (unsigned __int64)a2) >> 32, a3 * a1)
                    + ((a3 * (unsigned __int64)(unsigned int)a1) >> 32));
  return __PAIR64__(
           HIDWORD(v3),
           (a2 * (unsigned __int64)HIDWORD(a1) + ((a2 * (unsigned __int64)(unsigned int)a1) >> 32)) >> 32)
       + (unsigned int)v3
       + a3 * (unsigned __int64)HIDWORD(a1);
}

//----- (004018A7) --------------------------------------------------------
int *__fastcall sub_4018A7(int *a1, _DWORD *a2)
{
  unsigned int v2; // esi
  unsigned int v3; // ebx
  unsigned int v4; // ecx
  bool v5; // zf
  unsigned __int64 v6; // rdi
  int v7; // ebx
  __int64 v8; // rax
  __int64 v9; // rax
  unsigned int v12; // [esp+14h] [ebp-1Ch]
  unsigned int v14; // [esp+28h] [ebp-8h]
  unsigned int v15; // [esp+2Ch] [ebp-4h]

  v2 = (a2[1] - *a2) >> 3;
  v3 = (a1[1] - *a1) >> 3;
  if ( v3 < v2 )
    v3 = (a2[1] - *a2) >> 3;
  v14 = (a2[1] - *a2) >> 3;
  v15 = v3;
  sub_4016C5(a1, v3);
  v4 = 0;
  v5 = v2 == 0;
  v6 = 0i64;
  v12 = 0;
  if ( !v5 )
  {
    do
    {
      v7 = 8 * v4;
      v8 = sub_4017DF(v6);
      v6 = sub_4017DF(*(_QWORD *)(v7 + *a2)) + v8;
      v4 = v12 + 1;
      v12 = v4;
    }
    while ( v4 < v14 );
    v3 = v15;
  }
  while ( v4 < v3 )
  {
    if ( !v6 )
      return sub_40174A(a1);
    v9 = sub_4017DF(v6);
    v4 = v12 + 1;
    v6 = v9;
    ++v12;
  }
  if ( v6 )
    sub_40171C(a1, (_DWORD *)v6, SHIDWORD(v6));
  return sub_40174A(a1);
}

//----- (004019A4) --------------------------------------------------------
int *__fastcall sub_4019A4(int *a1, _DWORD *a2)
{
  unsigned int v2; // esi
  unsigned int v3; // edi
  unsigned int v4; // ebx
  unsigned int i; // eax
  __int64 v6; // kr00_8
  __int64 v7; // rax
  unsigned int v8; // ecx
  __int64 v9; // rax
  unsigned int v11; // [esp+Ch] [ebp-20h]
  unsigned int v13; // [esp+14h] [ebp-18h]
  unsigned int v15; // [esp+24h] [ebp-8h]

  v2 = 0;
  v3 = 0;
  v4 = (a1[1] - *a1) >> 3;
  v15 = (a2[1] - *a2) >> 3;
  v13 = 0;
  if ( !v15 )
  {
    v8 = 0;
    goto LABEL_9;
  }
  for ( i = 0; ; i = v7 + v6 )
  {
    v6 = sub_40180F(__SPAIR64__(v3, i));
    v7 = sub_40180F(*(_QWORD *)(8 * v2 + *a2));
    v3 = (unsigned __int64)(v7 + v6) >> 32;
    v8 = v7 + v6;
    v11 = v7 + v6;
    v2 = v13 + 1;
    v13 = v2;
    if ( v2 >= v15 )
      break;
  }
  while ( v2 < v4 && v3 | v8 )
  {
    v9 = sub_40180F(__SPAIR64__(v3, v11));
    v3 = HIDWORD(v9);
    v8 = v9;
    ++v2;
LABEL_9:
    v11 = v8;
  }
  return sub_40174A(a1);
}

//----- (00401A95) --------------------------------------------------------
int __usercall sub_401A95@<eax>(int a1@<edx>, int a2@<ecx>, int a3)
{
  int v3; // ecx
  char v4; // bl
  char v5; // bl
  unsigned int v6; // esi
  unsigned int v7; // edi
  unsigned int v8; // ebx
  unsigned int v9; // eax
  unsigned int v10; // ecx
  int v11; // edi
  __int64 v12; // rax
  int v13; // ecx
  bool v14; // cf
  unsigned __int64 v15; // rax
  __int64 v16; // rax
  int v17; // ecx
  int *v18; // eax
  int *v19; // eax
  int v22; // [esp+18h] [ebp-54h]
  unsigned int v24; // [esp+24h] [ebp-48h]
  unsigned int v25; // [esp+28h] [ebp-44h]
  int v26; // [esp+2Ch] [ebp-40h]
  int v27[3]; // [esp+30h] [ebp-3Ch] BYREF
  int v28; // [esp+3Ch] [ebp-30h]
  int v29[3]; // [esp+40h] [ebp-2Ch] BYREF
  int v30; // [esp+4Ch] [ebp-20h]
  __int64 v31[3]; // [esp+50h] [ebp-1Ch] BYREF
  int v32; // [esp+68h] [ebp-4h]

  HIDWORD(v31[0]) = a2;
  v22 = (*(_DWORD *)(a1 + 4) - *(_DWORD *)a1) >> 3;
  v3 = *(_DWORD *)(a3 + 4) - *(_DWORD *)a3;
  v4 = *(_BYTE *)(a3 + 12);
  memset(v27, 0, sizeof(v27));
  v5 = *(_BYTE *)(a1 + 12) ^ v4;
  v3 >>= 3;
  v6 = v3 + v22 + 1;
  v24 = v3;
  v31[0] = 0i64;
  v28 = 0;
  v27[0] = 0;
  sub_4036B0(v27, v6, v31);
  LOBYTE(v28) = v5;
  v32 = 0;
  v31[0] = 0i64;
  v30 = 0;
  memset(v29, 0, sizeof(v29));
  sub_4036B0(v29, v6, v31);
  LOBYTE(v30) = 0;
  v7 = 0;
  LOBYTE(v32) = 1;
  v8 = v22;
  HIDWORD(v31[0]) = 0;
  if ( v22 )
  {
    v9 = v24;
    do
    {
      v10 = 0;
      v25 = 0;
      if ( v9 )
      {
        v11 = 8 * v7;
        v26 = v11;
        do
        {
          v12 = sub_4017DF(*(_QWORD *)(*(_DWORD *)a3 + 8 * v10) * *(_QWORD *)(v11 + *(_DWORD *)a1));
          v13 = v12;
          LODWORD(v12) = v29[0];
          v14 = __CFADD__(v13, *(_DWORD *)(v26 + v29[0] + 8));
          *(_DWORD *)(v26 + v29[0] + 8) += v13;
          *(_DWORD *)(v26 + v12 + 12) += HIDWORD(v12) + v14;
          v15 = sub_40184B(
                  *(_QWORD *)(v11 + *(_DWORD *)a1),
                  *(_DWORD *)(*(_DWORD *)a3 + 8 * v25),
                  *(_DWORD *)(*(_DWORD *)a3 + 8 * v25 + 4));
          v26 += 8;
          v16 = sub_4017DF(v15);
          v17 = v16;
          LODWORD(v16) = v29[0];
          v14 = __CFADD__(v17, *(_DWORD *)(v26 + v29[0] + 8));
          *(_DWORD *)(v26 + v29[0] + 8) += v17;
          *(_DWORD *)(v26 + v16 + 12) += HIDWORD(v16) + v14;
          v10 = v25 + 1;
          v25 = v10;
        }
        while ( v10 < v24 );
        v7 = HIDWORD(v31[0]);
        v8 = v22;
        v9 = v24;
      }
      HIDWORD(v31[0]) = ++v7;
    }
    while ( v7 < v8 );
  }
  v18 = sub_4018A7(v27, v29);
  v19 = sub_40174A(v18);
  sub_4015E7(a2, (int)v19);
  sub_40339B(v29);
  sub_40339B(v27);
  return a2;
}

//----- (00401C41) --------------------------------------------------------
int *__usercall sub_401C41@<eax>(int *a1@<edx>, int *a2@<ecx>, int *a3)
{
  unsigned int v4; // ecx
  unsigned int v5; // ebx
  int v6; // ecx
  _DWORD *v7; // eax
  int *v8; // esi
  int *v9; // ecx
  int v10; // edx
  _DWORD *v11; // eax
  _DWORD *v12; // eax
  int v13; // edx
  int v15; // [esp-4h] [ebp-C8h]
  _DWORD v16[4]; // [esp+10h] [ebp-B4h] BYREF
  void *v17[6]; // [esp+20h] [ebp-A4h] BYREF
  int v18; // [esp+38h] [ebp-8Ch]
  int *v19; // [esp+3Ch] [ebp-88h]
  _DWORD v20[4]; // [esp+40h] [ebp-84h] BYREF
  _DWORD v21[4]; // [esp+50h] [ebp-74h] BYREF
  _DWORD v22[4]; // [esp+60h] [ebp-64h] BYREF
  int v23[4]; // [esp+70h] [ebp-54h] BYREF
  char v24[16]; // [esp+80h] [ebp-44h] BYREF
  int v25[4]; // [esp+90h] [ebp-34h] BYREF
  char v26[32]; // [esp+A0h] [ebp-24h] BYREF
  int v27; // [esp+C0h] [ebp-4h]

  v19 = a2;
  v17[5] = a2;
  v27 = 0;
  v17[4] = a2;
  v18 = 0;
  v4 = (a1[1] - *a1) >> 3;
  if ( v4 < (a3[1] - *a3) >> 3 )
    v4 = (a3[1] - *a3) >> 3;
  v5 = (v4 & 1) + (v4 >> 1);
  `eh vector constructor iterator'(v23, 0x10u, 2u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  v27 = 1;
  `eh vector constructor iterator'(v25, 0x10u, 2u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  LOBYTE(v27) = 2;
  sub_4020C6(v23, a1, v6, v5);
  sub_4020C6(v25, a3, v15, v5);
  v5 <<= 6;
  memset(v21, 0, sizeof(v21));
  sub_402412(v21, v25);
  LOBYTE(v27) = 3;
  memset(v20, 0, sizeof(v20));
  sub_402398((int)v23, v16, (int)v24);
  LOBYTE(v27) = 4;
  v7 = sub_402398((int)v25, v17, (int)v26);
  LOBYTE(v27) = 5;
  sub_402412(v20, v7);
  sub_40339B(v17);
  LOBYTE(v27) = 8;
  sub_40339B(v16);
  memset(v22, 0, sizeof(v22));
  sub_402412(v22, v26);
  LOBYTE(v27) = 9;
  v8 = v19;
  v9 = v19;
  *v19 = 0;
  v9[1] = 0;
  v9[2] = 0;
  v9[3] = 0;
  sub_4015E7((int)v9, (int)v22);
  v18 = 1;
  sub_401F2F(v8, v10, v5);
  v11 = sub_4023D2((int)v20, v17, (int)v22);
  LOBYTE(v27) = 10;
  v12 = sub_4023D2((int)v11, v16, (int)v21);
  LOBYTE(v27) = 11;
  sub_4022E4((int)v8, (int)v12);
  sub_40339B(v16);
  LOBYTE(v27) = 9;
  sub_40339B(v17);
  sub_401F2F(v8, v13, v5);
  sub_4022E4((int)v8, (int)v21);
  sub_40339B(v22);
  sub_40339B(v20);
  sub_40339B(v21);
  LOBYTE(v27) = 1;
  `eh vector destructor iterator'(v25, 0x10u, 2u, sub_40245D);
  LOBYTE(v27) = 0;
  `eh vector destructor iterator'(v23, 0x10u, 2u, sub_40245D);
  return v8;
}
// 401CD0: variable 'v6' is possibly undefined
// 401CDE: variable 'v15' is possibly undefined
// 401DAD: variable 'v10' is possibly undefined
// 401E07: variable 'v13' is possibly undefined
// 402412: using guessed type _DWORD __stdcall sub_402412(_DWORD, _DWORD);
// 401C41: using guessed type int var_54[4];
// 401C41: using guessed type int var_34[4];
// 401C41: using guessed type _DWORD var_74[4];
// 401C41: using guessed type _DWORD var_84[4];
// 401C41: using guessed type char var_44[16];
// 401C41: using guessed type _DWORD var_B4[4];
// 401C41: using guessed type _DWORD var_64[4];

//----- (00401E63) --------------------------------------------------------
int __usercall sub_401E63@<eax>(int *a1@<edx>, int a2@<ecx>, char a3, _DWORD *a4, char a5)
{
  int *v7; // eax
  char *v8; // eax
  char *v9; // ecx
  int v10; // eax
  char v12[20]; // [esp+10h] [ebp-4Ch] BYREF
  char v13[16]; // [esp+24h] [ebp-38h] BYREF
  int v14; // [esp+34h] [ebp-28h]
  _DWORD *v15; // [esp+38h] [ebp-24h]
  int v16[7]; // [esp+3Ch] [ebp-20h] BYREF
  int v17; // [esp+58h] [ebp-4h]

  v14 = a2;
  v15 = a4;
  if ( a3 == a5 )
  {
    memset(v16, 0, 16);
    sub_4015E7((int)v16, (int)a1);
    v17 = 0;
    v7 = sub_4018A7(v16, v15);
    sub_4015E7((int)v13, (int)v7);
    sub_40339B(v16);
    v17 = 1;
    v13[12] = a3;
    v8 = v13;
  }
  else
  {
    if ( sub_401774(a1, a4) < 0 )
    {
      v10 = sub_40213F((int)a4, (int)v12, a1);
      v17 = 3;
      *(_BYTE *)(v10 + 12) = a5;
      sub_4015E7(a2, v10);
      v9 = v12;
      goto LABEL_7;
    }
    v8 = (char *)sub_40213F((int)a1, (int)v13, a4);
    v17 = 2;
    v8[12] = a3;
  }
  sub_4015E7(a2, (int)v8);
  v9 = v13;
LABEL_7:
  sub_40339B(v9);
  return a2;
}
// 401E63: using guessed type int var_20[7];

//----- (00401F2F) --------------------------------------------------------
int *__fastcall sub_401F2F(int *a1, int a2, unsigned int a3)
{
  int *v3; // esi
  unsigned int v5; // ebx
  BOOL v6; // eax
  unsigned int v7; // edi
  int v8; // ecx
  int v9; // edx
  int v10; // eax
  unsigned int v11; // ecx
  char v12; // di
  int v13; // ecx
  int v14; // ebx
  __int64 v15; // rax
  int v16; // esi
  int v17; // edi
  int v18; // edi
  __int64 v19; // rax
  unsigned int v20; // ecx
  _DWORD *v21; // edi
  unsigned int v22; // eax
  int v23; // eax
  unsigned int v24; // [esp+14h] [ebp-28h]
  int v25; // [esp+1Ch] [ebp-20h]
  int v26; // [esp+20h] [ebp-1Ch]
  int v27; // [esp+24h] [ebp-18h]
  int v28; // [esp+24h] [ebp-18h]
  unsigned int v29; // [esp+28h] [ebp-14h]
  int v30; // [esp+2Ch] [ebp-10h]
  int v31; // [esp+30h] [ebp-Ch]
  int v33; // [esp+44h] [ebp+8h]

  v3 = a1;
  if ( !a3 )
    return a1;
  v5 = a3 >> 6;
  v24 = v5;
  v6 = (a3 & 0x3F) != 0;
  v33 = a3 & 0x3F;
  v27 = ((a1[1] - *a1) >> 3) + v6;
  v7 = v27 + v5;
  sub_4016C5(a1, v27 + v5);
  if ( v33 )
  {
    v11 = v7 - 1;
    v29 = v7 - 1;
    if ( v7 - 1 <= v5 )
    {
      v19 = 0i64;
    }
    else
    {
      v12 = 64 - v33;
      v13 = 8 * (v11 - v5);
      v30 = 0;
      v28 = v13;
      v31 = 0;
      do
      {
        v14 = *v3;
        v25 = *(_DWORD *)(v13 + *v3 - 4);
        v26 = *(_DWORD *)(v13 + *v3 - 8);
        v15 = *(_QWORD *)(v13 + *v3 - 8) >> v12;
        v16 = v15;
        LODWORD(v15) = v31;
        v17 = HIDWORD(v15);
        HIDWORD(v15) = v30;
        v19 = v15 << v33;
        v18 = HIDWORD(v19) | v17;
        HIDWORD(v19) = v25;
        v31 = v26;
        *(_DWORD *)(v14 + 8 * v29) = v19 | v16;
        v13 = v28 - 8;
        v3 = a1;
        *(_DWORD *)(v14 + 8 * v29 + 4) = v18;
        v5 = v24;
        v12 = 64 - v33;
        v30 = v25;
        --v29;
        v28 -= 8;
      }
      while ( v29 > v24 );
      LODWORD(v19) = v26;
    }
    *(_QWORD *)(*v3 + 8 * v5) = v19 << v33;
  }
  else if ( v7 > v5 )
  {
    v8 = 8 * v27;
    do
    {
      v9 = *v3;
      --v7;
      v10 = *(_DWORD *)(v8 - 8 + *v3);
      *(_DWORD *)(v9 + 8 * v7 + 4) = *(_DWORD *)(v8 - 8 + v9 + 4);
      v8 -= 8;
      *(_DWORD *)(v9 + 8 * v7) = v10;
    }
    while ( v7 > v5 );
  }
  v20 = 0;
  if ( v5 )
  {
    if ( v5 < 2 )
      goto LABEL_25;
    v21 = (_DWORD *)*v3;
    if ( *v3 <= (unsigned int)v3 && *v3 + 8 * (v5 - 1) >= (unsigned int)v3 )
      goto LABEL_25;
    v22 = v5 & 0xFFFFFFFE;
    do
      v20 += 2;
    while ( v20 < v22 );
    *v21 = 0;
    v21[1] = 0;
    qmemcpy(v21 + 2, v21, 4 * ((16 * (v22 >> 1) - 8) >> 2));
    v3 = a1;
    if ( v20 < v5 )
    {
LABEL_25:
      do
      {
        v23 = *v3;
        *(_DWORD *)(v23 + 8 * v20) = 0;
        *(_DWORD *)(v23 + 8 * v20++ + 4) = 0;
      }
      while ( v20 < v5 );
    }
  }
  return sub_40174A(v3);
}

//----- (004020C6) --------------------------------------------------------
int __usercall sub_4020C6@<eax>(int *a1@<edx>, int *a2@<ecx>, int a3, unsigned int a4)
{
  unsigned int v4; // edi
  unsigned int v6; // ebx
  int v7; // edx
  int v8; // ecx
  int v9; // eax
  int v10; // edx
  int *v11; // eax
  int result; // eax
  int v14; // [esp+10h] [ebp-8h]
  unsigned int v15; // [esp+14h] [ebp-4h]

  v4 = a4;
  v6 = 0;
  v14 = 2;
  do
  {
    sub_4016C5(a1, v4);
    v15 = 0;
    if ( v4 )
    {
      do
      {
        v7 = *a2;
        if ( v6 >= (a2[1] - *a2) >> 3 )
          break;
        v8 = *(_DWORD *)(v7 + 8 * v6);
        v9 = *a1;
        v10 = *(_DWORD *)(v7 + 8 * v6++ + 4);
        *(_DWORD *)(v9 + 8 * v15) = v8;
        v4 = a4;
        *(_DWORD *)(v9 + 8 * v15++ + 4) = v10;
      }
      while ( v15 < a4 );
    }
    v11 = sub_40174A(a1);
    result = sub_40162C((int)a1, (int)v11);
    a1 += 4;
    --v14;
  }
  while ( v14 );
  return result;
}

//----- (0040213F) --------------------------------------------------------
int __usercall sub_40213F@<eax>(int a1@<edx>, int a2@<ecx>, _DWORD *a3)
{
  int *v4; // eax
  int v6[9]; // [esp+18h] [ebp-24h] BYREF

  memset(v6, 0, 16);
  sub_4015E7((int)v6, a1);
  v6[8] = 0;
  v4 = sub_4019A4(v6, a3);
  sub_4015E7(a2, (int)v4);
  sub_40339B(v6);
  return a2;
}

//----- (0040218E) --------------------------------------------------------
int *__thiscall sub_40218E(int *this, __int64 a2)
{
  unsigned int v3; // edx
  int v4; // ecx
  unsigned int v5; // edi
  unsigned int v6; // ebx
  __int64 v7; // rax
  unsigned __int64 v8; // kr08_8
  unsigned int v10; // [esp+Ch] [ebp-10h]
  int v11; // [esp+10h] [ebp-Ch]
  __int64 v12; // [esp+14h] [ebp-8h]

  v3 = 0;
  v10 = 0;
  v4 = *this;
  v11 = v4;
  if ( (this[1] - v4) >> 3 )
  {
    v5 = 0;
    v6 = 0;
    do
    {
      v12 = *(_QWORD *)(v4 + 8 * v3) * a2;
      v7 = sub_4017DF(__PAIR64__(v5, v6));
      v8 = sub_40184B(*(_QWORD *)(v11 + 8 * v10), a2, HIDWORD(a2)) + v7;
      v5 = HIDWORD(v8);
      v6 = v8;
      *(_QWORD *)(v11 + 8 * v10) = v12;
      v4 = *this;
      v3 = v10 + 1;
      v10 = v3;
      v11 = *this;
    }
    while ( v3 < (this[1] - *this) >> 3 );
    if ( v8 )
      sub_40171C(this, (_DWORD *)v8, SHIDWORD(v8));
  }
  return sub_40174A(this);
}

//----- (00402266) --------------------------------------------------------
int *__thiscall sub_402266(int *this, unsigned int a2, int a3, int a4)
{
  __int64 v5; // rax
  int v8; // [esp+Ch] [ebp-4h]

  if ( !((this[1] - *this) >> 3) )
    sub_4016C5(this, 1u);
  HIDWORD(v5) = a3;
  v8 = 0;
  if ( (this[1] - *this) >> 3 )
  {
    while ( HIDWORD(v5) | a2 )
    {
      v5 = sub_4017DF(__PAIR64__(HIDWORD(v5), a2));
      a2 = v5;
      if ( ++v8 >= (unsigned int)((this[1] - *this) >> 3) )
        goto LABEL_6;
    }
  }
  else
  {
LABEL_6:
    if ( HIDWORD(v5) | a2 )
      sub_40171C(this, (_DWORD *)a2, SHIDWORD(v5));
  }
  return sub_40174A(this);
}

//----- (004022E4) --------------------------------------------------------
int __thiscall sub_4022E4(int this, int a2)
{
  int v3; // esi
  _DWORD v5[9]; // [esp+10h] [ebp-24h] BYREF

  memset(v5, 0, 16);
  sub_401E63((int *)this, (int)v5, *(_BYTE *)(this + 12), (_DWORD *)a2, *(_BYTE *)(a2 + 12));
  v5[8] = 0;
  v3 = sub_40162C(this, (int)v5);
  sub_40339B(v5);
  return v3;
}

//----- (00402339) --------------------------------------------------------
bool __thiscall sub_402339(int this, int a2)
{
  int v2; // eax
  char v3; // al
  char v4; // bl

  if ( ((*(_DWORD *)(this + 4) - *(_DWORD *)this) & 0xFFFFFFF8) != 0
    || ((*(_DWORD *)(a2 + 4) - *(_DWORD *)a2) & 0xFFFFFFF8) != 0 )
  {
    v3 = *(_BYTE *)(a2 + 12);
    v4 = *(_BYTE *)(this + 12);
    if ( v4 )
    {
      if ( v3 )
      {
        v2 = -sub_401774((int *)this, (int *)a2);
        return v2 == 0;
      }
    }
    else if ( !v3 )
    {
      v2 = sub_401774((int *)this, (int *)a2);
      return v2 == 0;
    }
    if ( !v4 || v3 )
      v2 = 1;
    else
      v2 = -1;
  }
  else
  {
    v2 = 0;
  }
  return v2 == 0;
}

//----- (00402398) --------------------------------------------------------
_DWORD *__thiscall sub_402398(int this, _DWORD *a2, int a3)
{
  *a2 = 0;
  a2[1] = 0;
  a2[2] = 0;
  a2[3] = 0;
  sub_401E63((int *)this, (int)a2, *(_BYTE *)(this + 12), (_DWORD *)a3, *(_BYTE *)(a3 + 12));
  return a2;
}

//----- (004023D2) --------------------------------------------------------
_DWORD *__thiscall sub_4023D2(int this, _DWORD *a2, int a3)
{
  *a2 = 0;
  a2[1] = 0;
  a2[2] = 0;
  a2[3] = 0;
  sub_401E63((int *)this, (int)a2, *(_BYTE *)(this + 12), (_DWORD *)a3, *(_BYTE *)(a3 + 12) == 0);
  return a2;
}

//----- (00402412) --------------------------------------------------------
int *__thiscall sub_402412(int *this, int *a2, int *a3)
{
  int *v3; // esi

  if ( (unsigned int)((this[1] - *this) >> 3) <= 0x14 || (unsigned int)((a3[1] - *a3) >> 3) <= 0x14 )
  {
    v3 = a2;
    sub_401A95((int)this, (int)a2, (int)a3);
  }
  else
  {
    v3 = a2;
    sub_401C41(this, a2, a3);
  }
  return v3;
}

//----- (00402462) --------------------------------------------------------
void __thiscall sub_402462(_DWORD **this)
{
  *this = &off_407324;
  `eh vector destructor iterator'(this + 55, 0x10u, 3u, sub_40245D);
  `eh vector destructor iterator'(this + 43, 0x10u, 3u, sub_40245D);
  `eh vector destructor iterator'(this + 7, 0x10u, 9u, sub_40245D);
  sub_4033BD(this + 1);
}
// 407324: using guessed type int (__stdcall *off_407324)(int, int, int);

//----- (004024DF) --------------------------------------------------------
int __thiscall sub_4024DF(_DWORD *this, int a2, int a3, int a4, int a5, int a6, unsigned int a7)
{
  int v7; // ebx
  _DWORD **v8; // edi
  int *v9; // eax
  int *v10; // ecx
  char *v11; // edi
  char v12; // bl
  int v13; // esi
  int v14; // eax
  unsigned int v15; // edx
  int v16; // ecx
  _DWORD *v17; // eax
  signed int v18; // esi
  int v19; // edi
  int v20; // ebx
  int v21; // ecx
  char *v22; // eax
  int v23; // eax
  _DWORD *v25[6]; // [esp+14h] [ebp-100h] BYREF
  char *v26; // [esp+2Ch] [ebp-E8h]
  _DWORD *v27; // [esp+30h] [ebp-E4h]
  _DWORD *v28; // [esp+34h] [ebp-E0h]
  int *v29; // [esp+38h] [ebp-DCh]
  int v30[44]; // [esp+3Ch] [ebp-D8h] BYREF
  _DWORD *v31[9]; // [esp+ECh] [ebp-28h] BYREF
  int v32; // [esp+110h] [ebp-4h]

  v7 = (int)this;
  v27 = this;
  v32 = 0;
  v8 = (_DWORD **)(this + 1);
  *this = &off_407324;
  v28 = this + 1;
  this[1] = 0;
  this[5] = 0;
  this[6] = 15;
  *((_BYTE *)this + 4) = 0;
  `eh vector constructor iterator'(this + 7, 0x10u, 9u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  `eh vector constructor iterator'((void *)(v7 + 172), 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  `eh vector constructor iterator'((void *)(v7 + 220), 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  LOBYTE(v32) = 5;
  memset(v30, 0, sizeof(v30));
  v30[0] = (int)&unk_40731C;
  v30[4] = (int)&unk_4072CC;
  std::ios::ios(&v30[26]);
  LOBYTE(v32) = 6;
  v29 = (int *)4;
  std::iostream::basic_iostream<char>(v30, &v30[6], 0);
  v32 = 7;
  *(int *)((char *)v30 + *(_DWORD *)(v30[0] + 4)) = (int)&off_407310;
  *(int *)((char *)&v30[-1] + *(_DWORD *)(v30[0] + 4)) = *(_DWORD *)(v30[0] + 4) - 104;
  sub_4034FB(&v30[6], 3);
  LOBYTE(v32) = 8;
  v9 = &a2;
  v29 = &a2;
  if ( a7 < 0x10 )
  {
    v10 = &a2;
  }
  else
  {
    v9 = (int *)a2;
    v10 = (int *)a2;
    v29 = (int *)a2;
  }
  v26 = (char *)v10 + a6;
  if ( v9 != (int *)((char *)v10 + a6) )
  {
    v11 = (char *)v29;
    do
    {
      v12 = *v11;
      v13 = std::ostream::operator<<(&v30[4], sub_401422);
      *(_BYTE *)(*(_DWORD *)(*(_DWORD *)v13 + 4) + v13 + 64) = 48;
      v14 = std::setw(&v25[2], 2, 0);
      (*(void (__cdecl **)(int, _DWORD, _DWORD))v14)(
        v13 + *(_DWORD *)(*(_DWORD *)v13 + 4),
        *(_DWORD *)(v14 + 8),
        *(_DWORD *)(v14 + 12));
      std::ostream::operator<<(v13, v12);
      ++v11;
    }
    while ( v11 != v26 );
    v8 = (_DWORD **)v28;
    v7 = (int)v27;
  }
  sub_403466((int)&v30[6], v25);
  if ( v8 != v25 )
  {
    v15 = (unsigned int)v8[5];
    if ( v15 >= 0x10 )
      sub_403795(*v8, v15 + 1);
    v8[4] = 0;
    *(_BYTE *)v8 = 0;
    v8[5] = (_DWORD *)15;
    qmemcpy(v8, v25, 0x18u);
    v25[4] = 0;
    v25[5] = (_DWORD *)15;
    LOBYTE(v25[0]) = 0;
    LOBYTE(v32) = 8;
  }
  sub_4033BD(v25);
  v17 = (_DWORD *)(v7 + 4);
  v18 = 0;
  v19 = v7 + 220;
  v28 = (_DWORD *)(v7 + 4);
  v20 = 6;
  do
  {
    sub_40354F(v31, v17, v18, v16, v16);
    v20 |= 1u;
    LOBYTE(v32) = 11;
    v22 = (char *)v31;
    if ( v31[5] >= (_DWORD *)0x10 )
      v22 = (char *)v31[0];
    v23 = sub_401656((int)&v25[2], v22, 0x10ui64, v21);
    LOBYTE(v32) = 12;
    sub_40162C(v19, v23);
    sub_40339B(&v25[2]);
    LOBYTE(v32) = 8;
    sub_4033BD(v31);
    v17 = v28;
    v18 += 20;
    v19 += 16;
  }
  while ( v18 < 60 );
  std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(&v30[26]);
  std::ios::~ios<char,std::char_traits<char>>(&v30[26]);
  sub_4033BD((_DWORD **)&a2);
  return (int)v27;
}
// 40272F: variable 'v16' is possibly undefined
// 402752: variable 'v21' is possibly undefined
// 40336B: using guessed type int __thiscall std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(_DWORD);
// 407038: using guessed type int __thiscall std::ios::ios(_DWORD);
// 407040: using guessed type int __thiscall std::iostream::basic_iostream<char>(_DWORD, _DWORD, _DWORD);
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 407074: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 407078: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4070C8: using guessed type int __cdecl std::setw(_DWORD, _DWORD, _DWORD);
// 407310: using guessed type int (__stdcall *off_407310)(int);
// 407324: using guessed type int (__stdcall *off_407324)(int, int, int);

//----- (004027C6) --------------------------------------------------------
int __thiscall sub_4027C6(void *this, int a2, int a3, unsigned int *a4)
{
  int v4; // edi
  unsigned int v5; // eax
  int v6; // ecx
  char *v7; // eax
  int v9; // [esp-4h] [ebp-F4h]
  _DWORD v10[4]; // [esp+10h] [ebp-E0h] BYREF
  _DWORD *v11[7]; // [esp+20h] [ebp-D0h] BYREF
  void *v12; // [esp+3Ch] [ebp-B4h]
  int v13; // [esp+40h] [ebp-B0h]
  int v14; // [esp+44h] [ebp-ACh]
  _DWORD v15[41]; // [esp+48h] [ebp-A8h] BYREF
  int v16; // [esp+ECh] [ebp-4h]

  v12 = this;
  v14 = a2;
  v13 = a3;
  memset(v15, 0, 0x98u);
  sub_402E58(v15, v9);
  v16 = 0;
  v4 = 24;
  do
  {
    v5 = -1775737769 - 1224826265 * *a4;
    *a4 = v5;
    std::ostream::operator<<(v15, v5 % 0xA);
    --v4;
  }
  while ( v4 );
  sub_403466((int)&v15[1], v11);
  LOBYTE(v16) = 1;
  v7 = (char *)v11;
  if ( v11[5] >= (_DWORD *)0x10 )
    v7 = (char *)v11[0];
  sub_401656((int)v10, v7, 0xAui64, v6);
  LOBYTE(v16) = 2;
  sub_40162C((int)v12 + 48 * v14 + 16 * v13 + 28, (int)v10);
  sub_40339B(v10);
  sub_4033BD(v11);
  sub_402E28(&v15[20]);
  return std::ios::~ios<char,std::char_traits<char>>(&v15[20]);
}
// 40280C: variable 'v9' is possibly undefined
// 402876: variable 'v6' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 40707C: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4027C6: using guessed type _DWORD var_E0[4];

//----- (004028E9) --------------------------------------------------------
int __thiscall sub_4028E9(void *this, int a2, __m128i **a3, char a4)
{
  __m128i *v4; // ebx
  __m128i *i; // edi
  int v6; // esi
  int v7; // eax
  int v8; // ecx
  char *v9; // eax
  int v10; // eax
  int v11; // esi
  int v12; // eax
  int v14; // [esp-4h] [ebp-F0h]
  _DWORD v15[4]; // [esp+14h] [ebp-D8h] BYREF
  _DWORD *v16[2]; // [esp+24h] [ebp-C8h] BYREF
  _DWORD v17[4]; // [esp+2Ch] [ebp-C0h] BYREF
  void *v18; // [esp+3Ch] [ebp-B0h]
  int v19; // [esp+40h] [ebp-ACh]
  _DWORD v20[41]; // [esp+44h] [ebp-A8h] BYREF
  int v21; // [esp+E8h] [ebp-4h]

  v18 = this;
  v19 = a2;
  memset(v20, 0, 0x98u);
  sub_402E58(v20, v14);
  v21 = 0;
  sub_404F50(*a3, a3[1]);
  v4 = a3[1];
  for ( i = *a3; i != v4; i = (__m128i *)((char *)i + 1) )
  {
    v6 = std::ostream::operator<<(v20, sub_401422);
    *(_BYTE *)(*(_DWORD *)(*(_DWORD *)v6 + 4) + v6 + 64) = 48;
    v7 = std::setw(v17, 2, 0);
    (*(void (__cdecl **)(int, _DWORD, _DWORD))v7)(
      v6 + *(_DWORD *)(*(_DWORD *)v6 + 4),
      *(_DWORD *)(v7 + 8),
      *(_DWORD *)(v7 + 12));
    std::ostream::operator<<(v6, i->m128i_u8[0]);
  }
  sub_403466((int)&v20[1], v16);
  LOBYTE(v21) = 1;
  v9 = (char *)v16;
  if ( v17[3] >= 0x10u )
    v9 = (char *)v16[0];
  v10 = sub_401656((int)v15, v9, 0x10ui64, v8);
  v11 = (int)v18 + 16 * v19 + 172;
  LOBYTE(v21) = 2;
  sub_40162C(v11, v10);
  sub_40339B(v15);
  LOBYTE(v21) = 0;
  sub_4033BD(v16);
  if ( a4 )
  {
    v12 = sub_4015E7((int)v17, v11);
    LOBYTE(v21) = 3;
    *(_BYTE *)(v12 + 12) = *(_BYTE *)(v11 + 12) == 0;
    sub_4015E7((int)v15, v12);
    sub_40339B(v17);
    LOBYTE(v21) = 4;
    sub_40162C(v11, (int)v15);
    sub_40339B(v15);
  }
  sub_402E28(&v20[20]);
  return std::ios::~ios<char,std::char_traits<char>>(&v20[20]);
}
// 402926: variable 'v14' is possibly undefined
// 4029CB: variable 'v8' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 407074: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 407078: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4070C8: using guessed type int __cdecl std::setw(_DWORD, _DWORD, _DWORD);
// 4028E9: using guessed type _DWORD var_D8[4];

//----- (00402A7A) --------------------------------------------------------
int __thiscall sub_402A7A(void *this)
{
  unsigned int v1; // edi
  int v2; // esi
  int v3; // ebx
  int v4; // ecx
  char *v5; // eax
  int v6; // esi
  int result; // eax
  bool v8; // zf
  int v9; // [esp-4h] [ebp-F0h]
  _DWORD v10[4]; // [esp+10h] [ebp-DCh] BYREF
  _DWORD *v11[6]; // [esp+20h] [ebp-CCh] BYREF
  int v12; // [esp+38h] [ebp-B4h]
  int v13; // [esp+3Ch] [ebp-B0h]
  int v14; // [esp+40h] [ebp-ACh]
  _DWORD v15[41]; // [esp+44h] [ebp-A8h] BYREF
  int v16; // [esp+E8h] [ebp-4h]

  v1 = 4919;
  v14 = 3;
  v2 = (int)this + 28;
  do
  {
    v13 = v2;
    v12 = 3;
    do
    {
      memset(v15, 0, 0x98u);
      sub_402E58(v15, v9);
      v16 = 0;
      v3 = 24;
      do
      {
        v1 = -1775737769 - 1224826265 * v1;
        std::ostream::operator<<(v15, v1 % 0xA);
        --v3;
      }
      while ( v3 );
      sub_403466((int)&v15[1], v11);
      LOBYTE(v16) = 1;
      v5 = (char *)v11;
      if ( v11[5] >= (_DWORD *)0x10 )
        v5 = (char *)v11[0];
      sub_401656((int)v10, v5, 0xAui64, v4);
      v6 = v13;
      LOBYTE(v16) = 2;
      sub_40162C(v13, (int)v10);
      sub_40339B(v10);
      sub_4033BD(v11);
      v16 = -1;
      sub_402E28(&v15[20]);
      result = std::ios::~ios<char,std::char_traits<char>>(&v15[20]);
      v2 = v6 + 16;
      v8 = v12-- == 1;
      v13 = v2;
    }
    while ( !v8 );
    --v14;
  }
  while ( v14 );
  return result;
}
// 402AC5: variable 'v9' is possibly undefined
// 402B30: variable 'v4' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 40707C: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 402A7A: using guessed type _DWORD var_DC[4];

//----- (00402BA1) --------------------------------------------------------
bool __thiscall sub_402BA1(int *this)
{
  int *v1; // edi
  int *v2; // esi
  int *v3; // ebx
  int *v4; // eax
  _DWORD *v5; // esi
  int *v6; // ecx
  int *v7; // eax
  _DWORD *v8; // eax
  int *v9; // esi
  int *v10; // eax
  _DWORD *v11; // esi
  int *v12; // eax
  _DWORD *v13; // eax
  int *v14; // esi
  int *v15; // eax
  _DWORD *v16; // esi
  int *v17; // ebx
  int *v18; // eax
  _DWORD *v19; // eax
  bool v20; // bl
  int v22[4]; // [esp+10h] [ebp-94h] BYREF
  int v23[4]; // [esp+20h] [ebp-84h] BYREF
  _DWORD v24[4]; // [esp+30h] [ebp-74h] BYREF
  int v25[4]; // [esp+40h] [ebp-64h] BYREF
  int v26[4]; // [esp+50h] [ebp-54h] BYREF
  int *v27; // [esp+60h] [ebp-44h]
  char v28[16]; // [esp+64h] [ebp-40h] BYREF
  char v29[16]; // [esp+74h] [ebp-30h] BYREF
  char v30[28]; // [esp+84h] [ebp-20h] BYREF
  int v31; // [esp+A0h] [ebp-4h]

  v1 = this;
  v27 = this;
  `eh vector constructor iterator'(v28, 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  v31 = 0;
  v2 = sub_402412(v1 + 7, v22, v1 + 55);
  v3 = v1 + 59;
  LOBYTE(v31) = 1;
  v4 = sub_402412(v1 + 11, v23, v1 + 59);
  LOBYTE(v31) = 2;
  v5 = sub_402398((int)v2, v24, (int)v4);
  v6 = v1 + 15;
  LOBYTE(v31) = 3;
  v1 += 63;
  v7 = sub_402412(v6, v25, v1);
  LOBYTE(v31) = 4;
  v8 = sub_4023D2((int)v5, v26, (int)v7);
  LOBYTE(v31) = 5;
  sub_40162C((int)v28, (int)v8);
  sub_40339B(v26);
  sub_40339B(v25);
  sub_40339B(v24);
  sub_40339B(v23);
  LOBYTE(v31) = 0;
  sub_40339B(v22);
  v9 = sub_402412(v27 + 19, v26, v27 + 55);
  LOBYTE(v31) = 6;
  v10 = sub_402412(v27 + 23, v25, v3);
  LOBYTE(v31) = 7;
  v11 = sub_402398((int)v9, v24, (int)v10);
  LOBYTE(v31) = 8;
  v12 = sub_402412(v27 + 27, v23, v1);
  LOBYTE(v31) = 9;
  v13 = sub_402398((int)v11, v22, (int)v12);
  LOBYTE(v31) = 10;
  sub_40162C((int)v29, (int)v13);
  sub_40339B(v22);
  sub_40339B(v23);
  sub_40339B(v24);
  sub_40339B(v25);
  LOBYTE(v31) = 0;
  sub_40339B(v26);
  v14 = sub_402412(v27 + 31, v26, v27 + 55);
  LOBYTE(v31) = 11;
  v15 = sub_402412(v27 + 35, v25, v3);
  LOBYTE(v31) = 12;
  v16 = sub_4023D2((int)v14, v24, (int)v15);
  v17 = v27;
  LOBYTE(v31) = 13;
  v18 = sub_402412(v27 + 39, v23, v1);
  LOBYTE(v31) = 14;
  v19 = sub_4023D2((int)v16, v22, (int)v18);
  LOBYTE(v31) = 15;
  sub_40162C((int)v30, (int)v19);
  sub_40339B(v22);
  sub_40339B(v23);
  sub_40339B(v24);
  sub_40339B(v25);
  sub_40339B(v26);
  v20 = sub_402339((int)v28, (int)(v17 + 43))
     && sub_402339((int)v29, (int)(v17 + 47))
     && sub_402339((int)v30, (int)(v17 + 51));
  v31 = -1;
  `eh vector destructor iterator'(v28, 0x10u, 3u, sub_40245D);
  return v20;
}
// 402BA1: using guessed type int var_94[4];
// 402BA1: using guessed type int var_84[4];
// 402BA1: using guessed type _DWORD var_74[4];
// 402BA1: using guessed type int var_64[4];
// 402BA1: using guessed type int var_54[4];

//----- (00402E28) --------------------------------------------------------
int __thiscall sub_402E28(_DWORD *this)
{
  *(_DWORD *)((char *)this + *(_DWORD *)(*(this - 20) + 4) - 80) = &off_4072C8;
  *(_DWORD *)((char *)this + *(_DWORD *)(*(this - 20) + 4) - 84) = *(_DWORD *)(*(this - 20) + 4) - 80;
  sub_403304((_BYTE *)this - 76);
  return std::ostream::~ostream<char,std::char_traits<char>>(this - 18);
}
// 407070: using guessed type int __thiscall std::ostream::~ostream<char,std::char_traits<char>>(_DWORD);
// 4072C8: using guessed type int (__stdcall *off_4072C8)(int);

//----- (00402E58) --------------------------------------------------------
_DWORD *__thiscall sub_402E58(_DWORD *this, int a2)
{
  *this = &unk_407314;
  std::ios::ios(this + 20);
  std::ostream::ostream(this, this + 1, 0, 0);
  *(_DWORD *)((char *)this + *(_DWORD *)(*this + 4)) = &off_4072C8;
  *(_DWORD *)((char *)this + *(_DWORD *)(*this + 4) - 4) = *(_DWORD *)(*this + 4) - 80;
  sub_4034FB(this + 1, 2);
  return this;
}
// 407038: using guessed type int __thiscall std::ios::ios(_DWORD);
// 40703C: using guessed type int __thiscall std::ostream::ostream(_DWORD, _DWORD, _DWORD, _DWORD);
// 4072C8: using guessed type int (__stdcall *off_4072C8)(int);

//----- (00402EC4) --------------------------------------------------------
unsigned int *__thiscall sub_402EC4(int this, unsigned int *a2, __int64 a3, __int64 a4, int a5, int a6, char a7)
{
  unsigned int v7; // ebx
  unsigned int *v8; // esi
  unsigned int v10; // ecx
  char v11; // dl
  int v12; // edx
  int v14; // [esp+Ch] [ebp-18h]
  int v15; // [esp+18h] [ebp-Ch]
  unsigned int v16; // [esp+1Ch] [ebp-8h]
  int v17; // [esp+20h] [ebp-4h]

  v7 = a4 + a3;
  v8 = a2;
  v16 = (unsigned __int64)(a4 + a3) >> 32;
  v15 = **(_DWORD **)(this + 28);
  if ( (*(_BYTE *)(this + 60) & 2) != 0 )
  {
    v10 = 0;
  }
  else
  {
    v10 = **(_DWORD **)(this + 32);
    if ( v10 && *(_DWORD *)(this + 56) < v10 )
      *(_DWORD *)(this + 56) = v10;
  }
  v14 = *(_DWORD *)(this + 56);
  v17 = **(_DWORD **)(this + 12);
  if ( __PAIR64__(v16, v7) > v14 - v17 || (v11 = a7, v16 | v7) && ((a7 & 1) != 0 && !v15 || (a7 & 2) != 0 && !v10) )
  {
    *a2 = -1;
    a2[1] = -1;
  }
  else
  {
    if ( (a7 & 1) != 0 && v15 )
    {
      **(_DWORD **)(this + 12) = v17;
      **(_DWORD **)(this + 28) = v7 + v17;
      v8 = a2;
      **(_DWORD **)(this + 44) = v14 - (v7 + v17);
      v11 = a7;
    }
    if ( (v11 & 2) != 0 && v10 )
    {
      v8 = a2;
      v12 = **(_DWORD **)(this + 48) + **(_DWORD **)(this + 32);
      **(_DWORD **)(this + 16) = v17;
      **(_DWORD **)(this + 32) = v7 + v17;
      **(_DWORD **)(this + 48) = v12 - (v7 + v17);
    }
    *v8 = v7;
    v8[1] = v16;
  }
  v8[2] = 0;
  v8[3] = 0;
  v8[4] = 0;
  v8[5] = 0;
  return v8;
}

//----- (00402FCE) --------------------------------------------------------
_DWORD *__thiscall sub_402FCE(int this, _DWORD *a2, __int64 a3, int a4, char a5)
{
  unsigned int v6; // edi
  unsigned int v7; // ecx
  char v8; // bl
  int v9; // edx
  int v10; // eax
  int v11; // edi
  int v12; // eax
  unsigned int v13; // eax
  __int64 v14; // kr00_8
  int v15; // edx
  int v16; // edx
  _DWORD *result; // eax
  int v18; // [esp+18h] [ebp-10h]
  unsigned int v19; // [esp+1Ch] [ebp-Ch]
  int v20; // [esp+24h] [ebp-4h]
  int v21; // [esp+38h] [ebp+10h]
  int v22; // [esp+3Ch] [ebp+14h]

  v6 = **(_DWORD **)(this + 28);
  v19 = v6;
  if ( (*(_BYTE *)(this + 60) & 2) != 0 )
  {
    v7 = 0;
  }
  else
  {
    v7 = **(_DWORD **)(this + 32);
    if ( v7 && *(_DWORD *)(this + 56) < v7 )
      *(_DWORD *)(this + 56) = v7;
  }
  v8 = a5;
  v9 = **(_DWORD **)(this + 12);
  v20 = *(_DWORD *)(this + 56);
  v18 = v9;
  if ( !a4 )
  {
    v12 = 0;
    v11 = 0;
    goto LABEL_22;
  }
  if ( a4 == 1 )
  {
    if ( (a5 & 3) != 3 )
    {
      if ( (a5 & 1) != 0 )
      {
        if ( !v6 && v9 )
          goto LABEL_35;
        v13 = v6;
      }
      else
      {
        if ( (a5 & 2) == 0 || !v7 && v9 )
          goto LABEL_35;
        v13 = v7;
      }
      v10 = v13 - v9;
      goto LABEL_10;
    }
LABEL_35:
    result = a2;
    *a2 = -1;
    a2[1] = -1;
    goto LABEL_36;
  }
  if ( a4 != 2 )
    goto LABEL_35;
  v10 = v20 - v9;
LABEL_10:
  v11 = v10;
  v12 = v10 >> 31;
LABEL_22:
  v14 = a3 + __PAIR64__(v12, v11);
  v22 = (a3 + __PAIR64__(v12, v11)) >> 32;
  if ( a3 + __PAIR64__(v12, v11) > v20 - v9 || v14 && ((a5 & 1) != 0 && !v19 || (a5 & 2) != 0 && !v7) )
    goto LABEL_35;
  v15 = v14 + v9;
  v21 = v14 + v18;
  if ( (a5 & 1) != 0 && v19 )
  {
    **(_DWORD **)(this + 12) = v18;
    v8 = a5;
    **(_DWORD **)(this + 28) = v15;
    **(_DWORD **)(this + 44) = v20 - v15;
  }
  if ( (v8 & 2) != 0 && v7 )
  {
    v16 = **(_DWORD **)(this + 48) + **(_DWORD **)(this + 32);
    **(_DWORD **)(this + 16) = v18;
    **(_DWORD **)(this + 32) = v21;
    **(_DWORD **)(this + 48) = v16 - v21;
  }
  result = a2;
  *a2 = v14;
  a2[1] = v22;
LABEL_36:
  result[2] = 0;
  result[3] = 0;
  result[4] = 0;
  result[5] = 0;
  return result;
}

//----- (00403136) --------------------------------------------------------
int __thiscall sub_403136(int this)
{
  unsigned __int8 **v2; // edi
  unsigned __int8 *v3; // ecx
  unsigned int *v5; // eax
  unsigned int v6; // esi
  unsigned int v7; // esi

  v2 = *(unsigned __int8 ***)(this + 28);
  v3 = *v2;
  if ( !*v2 )
    return -1;
  if ( v3 < &v3[**(_DWORD **)(this + 44)] )
    return *v3;
  v5 = *(unsigned int **)(this + 32);
  if ( !*v5 || (*(_BYTE *)(this + 60) & 4) != 0 )
    return -1;
  v6 = *(_DWORD *)(this + 56);
  if ( v6 < *v5 )
    v6 = *v5;
  if ( v6 <= (unsigned int)v3 )
    return -1;
  *(_DWORD *)(this + 56) = v6;
  v7 = v6 - (_DWORD)*v2;
  *v2 = *v2;
  **(_DWORD **)(this + 44) = v7;
  return ***(unsigned __int8 ***)(this + 28);
}

//----- (00403192) --------------------------------------------------------
int __thiscall sub_403192(int this, int a2)
{
  unsigned int v3; // esi
  int v4; // ecx

  v3 = **(_DWORD **)(this + 28);
  if ( !v3 )
    return -1;
  if ( v3 <= **(_DWORD **)(this + 12) )
    return -1;
  v4 = a2;
  if ( a2 != -1 && (_BYTE)a2 != *(_BYTE *)(v3 - 1) && (*(_BYTE *)(this + 60) & 2) != 0 )
    return -1;
  ++**(_DWORD **)(this + 44);
  --**(_DWORD **)(this + 28);
  if ( a2 != -1 )
    ***(_BYTE ***)(this + 28) = a2;
  if ( a2 == -1 )
    return 0;
  return v4;
}

//----- (004031E5) --------------------------------------------------------
int __thiscall sub_4031E5(int this, int a2)
{
  unsigned int v4; // ebx
  unsigned int v5; // ecx
  _BYTE *v6; // eax
  int v7; // ecx
  size_t v8; // esi
  size_t v9; // ebx
  char *v10; // ecx
  int v11; // esi
  _BYTE *v12; // eax
  _DWORD *Src; // [esp+Ch] [ebp-8h]
  _DWORD *v14; // [esp+10h] [ebp-4h]

  if ( (*(_BYTE *)(this + 60) & 2) == 0 )
  {
    if ( a2 == -1 )
      return 0;
    v4 = **(_DWORD **)(this + 32);
    v5 = v4 + **(_DWORD **)(this + 48);
    if ( v4 && v4 < v5 )
    {
      v6 = (_BYTE *)std::streambuf::_Pninc(this);
      v7 = a2;
      *v6 = a2;
      *(_DWORD *)(this + 56) = v4 + 1;
      return v7;
    }
    v8 = 32;
    Src = **(_DWORD ***)(this + 12);
    v9 = v4 != 0 ? v5 - (_DWORD)Src : 0;
    if ( v9 < 0x20 )
    {
LABEL_12:
      v14 = sub_403756(v8);
      memcpy(v14, Src, v9);
      *(_DWORD *)(this + 56) = (char *)v14 + v9 + 1;
      **(_DWORD **)(this + 16) = v14;
      **(_DWORD **)(this + 32) = (char *)v14 + v9;
      **(_DWORD **)(this + 48) = v8 - v9;
      if ( (*(_BYTE *)(this + 60) & 4) != 0 )
      {
        **(_DWORD **)(this + 12) = v14;
        **(_DWORD **)(this + 28) = 0;
        **(_DWORD **)(this + 44) = v14;
      }
      else
      {
        v10 = (char *)v14 + **(_DWORD **)(this + 28) - (_DWORD)Src;
        v11 = *(_DWORD *)(this + 56) - (_DWORD)v10;
        **(_DWORD **)(this + 12) = v14;
        **(_DWORD **)(this + 28) = v10;
        **(_DWORD **)(this + 44) = v11;
      }
      if ( (*(_BYTE *)(this + 60) & 1) != 0 )
        sub_403795(Src, v9);
      *(_DWORD *)(this + 60) |= 1u;
      v12 = (_BYTE *)std::streambuf::_Pninc(this);
      v7 = a2;
      *v12 = a2;
      return v7;
    }
    if ( v9 < 0x3FFFFFFF )
    {
      v8 = 2 * v9;
      goto LABEL_12;
    }
    v8 = 0x7FFFFFFF;
    if ( v9 < 0x7FFFFFFF )
      goto LABEL_12;
  }
  return -1;
}
// 407034: using guessed type int __thiscall std::streambuf::_Pninc(_DWORD);

//----- (00403304) --------------------------------------------------------
int __thiscall sub_403304(_BYTE *this)
{
  bool v2; // zf
  int v3; // ecx
  int v4; // edx

  v2 = (this[60] & 1) == 0;
  *(_DWORD *)this = &off_4072D4;
  if ( !v2 )
  {
    v3 = **((_DWORD **)this + 8);
    if ( v3 )
      v4 = v3 + **((_DWORD **)this + 12);
    else
      v4 = **((_DWORD **)this + 7) + **((_DWORD **)this + 11);
    sub_403795(**((_DWORD ***)this + 3), v4 - **((_DWORD **)this + 3));
  }
  **((_DWORD **)this + 3) = 0;
  **((_DWORD **)this + 7) = 0;
  **((_DWORD **)this + 11) = 0;
  **((_DWORD **)this + 4) = 0;
  **((_DWORD **)this + 8) = 0;
  **((_DWORD **)this + 12) = 0;
  *((_DWORD *)this + 15) &= ~1u;
  *((_DWORD *)this + 14) = 0;
  return std::streambuf::~streambuf<char,std::char_traits<char>>(this);
}
// 407044: using guessed type int __thiscall std::streambuf::~streambuf<char,std::char_traits<char>>(_DWORD);
// 4072D4: using guessed type int (__thiscall *off_4072D4)(void *Block, char);

//----- (0040339B) --------------------------------------------------------
int __thiscall sub_40339B(_DWORD *this)
{
  _DWORD *v2; // ecx
  int result; // eax

  v2 = (_DWORD *)*this;
  if ( v2 )
  {
    sub_403795(v2, (this[2] - (_DWORD)v2) & 0xFFFFFFF8);
    result = 0;
    *this = 0;
    this[1] = 0;
    this[2] = 0;
  }
  return result;
}

//----- (004033BD) --------------------------------------------------------
void __thiscall sub_4033BD(_DWORD **this)
{
  unsigned int v2; // edx

  v2 = (unsigned int)this[5];
  if ( v2 >= 0x10 )
    sub_403795(*this, v2 + 1);
  this[4] = 0;
  *(_BYTE *)this = 0;
  this[5] = (_DWORD *)15;
}

//----- (004033E0) --------------------------------------------------------
_DWORD *__thiscall sub_4033E0(_DWORD *this, char a2)
{
  _DWORD *v3; // edi

  v3 = this - 20;
  sub_402E28(this);
  std::ios::~ios<char,std::char_traits<char>>(this);
  if ( (a2 & 1) != 0 )
    sub_4051A8(v3);
  return v3;
}
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);

//----- (00403412) --------------------------------------------------------
_BYTE *__thiscall sub_403412(_BYTE *Block, char a2)
{
  sub_403304(Block);
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}

//----- (00403434) --------------------------------------------------------
char *__thiscall sub_403434(char *this, char a2)
{
  char *v3; // edi

  v3 = this - 104;
  std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>();
  std::ios::~ios<char,std::char_traits<char>>(this);
  if ( (a2 & 1) != 0 )
    sub_4051A8(v3);
  return v3;
}
// 40336B: using guessed type int std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(void);
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);

//----- (00403466) --------------------------------------------------------
_DWORD *__thiscall sub_403466(int this, _DWORD *a2)
{
  unsigned int v3; // ecx
  void **v4; // eax
  void *v5; // edx
  size_t v6; // ecx
  int v7; // edi

  *a2 = 0;
  a2[4] = 0;
  a2[5] = 15;
  *(_BYTE *)a2 = 0;
  if ( (*(_DWORD *)(this + 60) & 0x22) == 2 || (v3 = **(_DWORD **)(this + 32)) == 0 )
  {
    if ( (*(_BYTE *)(this + 60) & 4) != 0 || (v7 = **(_DWORD **)(this + 28)) == 0 )
    {
      v6 = 0;
      v5 = 0;
    }
    else
    {
      v5 = **(void ***)(this + 12);
      v6 = v7 + **(_DWORD **)(this + 44) - (_DWORD)v5;
    }
  }
  else
  {
    v4 = *(void ***)(this + 16);
    if ( v3 < *(_DWORD *)(this + 56) )
      v3 = *(_DWORD *)(this + 56);
    v5 = *v4;
    v6 = v3 - (_DWORD)*v4;
  }
  if ( v5 )
    sub_403606(a2, v5, v6);
  return a2;
}

//----- (004034FB) --------------------------------------------------------
_DWORD *__thiscall sub_4034FB(_DWORD *this, char a2)
{
  int v3; // edx
  int v4; // ecx
  int v5; // eax

  std::streambuf::streambuf();
  this[14] = 0;
  *this = &off_4072D4;
  v3 = (4 * ((a2 & 1) == 0)) | 2;
  if ( (a2 & 2) != 0 )
    v3 = 4 * ((a2 & 1) == 0);
  v4 = v3 | 8;
  if ( (a2 & 8) == 0 )
    v4 = v3;
  v5 = v4 | 0x10;
  if ( (a2 & 4) == 0 )
    v5 = v4;
  this[15] = v5;
  return this;
}
// 4070C0: using guessed type int std::streambuf::streambuf(void);
// 4072D4: using guessed type int (__thiscall *off_4072D4)(void *Block, char);

//----- (0040354F) --------------------------------------------------------
_DWORD *__thiscall sub_40354F(_DWORD *this, _DWORD *a2, unsigned int a3, int a4, int a5)
{
  _DWORD *v5; // eax
  unsigned int v7; // ecx
  unsigned int v8; // ecx
  size_t v9; // esi
  char *v10; // eax
  int v11; // edi
  _DWORD *v12; // esi
  void *Src; // [esp+8h] [ebp-8h]
  size_t Size; // [esp+Ch] [ebp-4h]

  v5 = a2;
  *this = 0;
  this[4] = 0;
  this[5] = 0;
  v7 = a2[4];
  if ( v7 < a3 )
    sub_4036A4();
  v8 = v7 - a3;
  v9 = 20;
  if ( v8 < 0x14 )
    v9 = v8;
  Size = v9;
  if ( a2[5] >= 0x10u )
    v5 = (_DWORD *)*a2;
  v10 = (char *)v5 + a3;
  Src = v10;
  this[5] = 15;
  if ( v9 >= 0x10 )
  {
    v11 = sub_4037E8(this, v9);
    v12 = sub_403756(__CFADD__(v11, 1) ? -1 : v11 + 1);
    this[5] = v11;
    *this = v12;
    this[4] = Size;
    memcpy(v12, Src, Size);
    *((_BYTE *)v12 + Size) = 0;
  }
  else
  {
    this[4] = v9;
    memmove(this, v10, v9);
    *((_BYTE *)this + v9) = 0;
  }
  return this;
}
// 403593: conditional instruction was optimized away because esi.4<15u
// 401416: using guessed type void __noreturn sub_401416(void);
// 4036A4: using guessed type void __noreturn sub_4036A4(void);

//----- (00403606) --------------------------------------------------------
_DWORD *__thiscall sub_403606(_DWORD *this, void *Src, size_t Size)
{
  size_t v4; // eax
  _DWORD *v5; // esi
  int v6; // esi
  unsigned int v8; // [esp+Ch] [ebp-Ch]
  _DWORD *v9; // [esp+10h] [ebp-8h]

  v4 = this[5];
  v8 = v4;
  if ( Size > v4 )
  {
    if ( Size > 0x7FFFFFFF )
      sub_401416();
    v6 = sub_4037E8(this, Size);
    v9 = sub_403756(__CFADD__(v6, 1) ? -1 : v6 + 1);
    this[4] = Size;
    this[5] = v6;
    memcpy(v9, Src, Size);
    *((_BYTE *)v9 + Size) = 0;
    if ( v8 >= 0x10 )
      sub_403795((_DWORD *)*this, v8 + 1);
    *this = v9;
  }
  else
  {
    v5 = this;
    if ( v4 >= 0x10 )
      v5 = (_DWORD *)*this;
    this[4] = Size;
    memmove(v5, Src, Size);
    *((_BYTE *)v5 + Size) = 0;
  }
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (004036A4) --------------------------------------------------------
void __noreturn sub_4036A4()
{
  std::_Xout_of_range("invalid string position");
  JUMPOUT(0x4036AF);
}
// 4036A9: control flows out of bounds to 4036AF
// 4036A4: using guessed type void __noreturn sub_4036A4();
// 4070CC: using guessed type void __cdecl std::_Xout_of_range(const char *);

//----- (004036B0) --------------------------------------------------------
void __thiscall sub_4036B0(_DWORD *this, unsigned int a2, _DWORD *a3)
{
  unsigned int v3; // edi
  _DWORD *v5; // eax
  _DWORD *v6; // esi
  int v7; // ecx
  size_t Size; // [esp+8h] [ebp-10h] BYREF
  __int64 v9; // [esp+Ch] [ebp-Ch]

  v3 = a2;
  if ( a2 )
  {
    if ( a2 > 0x1FFFFFFF )
      sub_40381C();
    v5 = sub_403828(a2);
    v6 = v5;
    *this = v5;
    this[1] = v5;
    Size = 8 * a2;
    v9 = 0i64;
    this[2] = &v5[2 * a2];
    if ( *(_QWORD *)a3 == v9 )
    {
      memset(v5, 0, Size);
      v6 = (_DWORD *)((char *)v6 + Size);
    }
    else
    {
      do
      {
        v7 = a3[1];
        *v6 = *a3;
        v6[1] = v7;
        v6 += 2;
        --v3;
      }
      while ( v3 );
    }
    Size = 0;
    this[1] = v6;
    sub_4037C2((int *)&Size);
  }
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403756) --------------------------------------------------------
_DWORD *__thiscall sub_403756(size_t Size)
{
  void *v1; // eax
  void *v2; // ecx
  _DWORD *result; // eax

  if ( Size < 0x1000 )
  {
    if ( Size )
      return operator new(Size);
    else
      return 0;
  }
  else
  {
    if ( Size + 35 <= Size )
      sub_4013C3();
    v1 = operator new(Size + 35);
    v2 = v1;
    if ( !v1 )
      invalid_parameter_noinfo_noreturn();
    result = (_DWORD *)(((unsigned int)v1 + 35) & 0xFFFFFFE0);
    *(result - 1) = v2;
  }
  return result;
}
// 4013C3: using guessed type void __noreturn sub_4013C3(void);

//----- (00403795) --------------------------------------------------------
void __fastcall sub_403795(_DWORD *Block, unsigned int a2)
{
  if ( a2 >= 0x1000 )
  {
    if ( (unsigned int)Block - *(Block - 1) - 4 > 0x1F )
      invalid_parameter_noinfo_noreturn();
    Block = (_DWORD *)*(Block - 1);
  }
  sub_4051A8(Block);
}

//----- (004037C2) --------------------------------------------------------
int __thiscall sub_4037C2(int *this)
{
  int v1; // esi
  int result; // eax

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
    {
      sub_403795(*(_DWORD **)v1, (*(_DWORD *)(v1 + 8) - *(_DWORD *)v1) & 0xFFFFFFF8);
      result = 0;
      *(_DWORD *)v1 = 0;
      *(_DWORD *)(v1 + 4) = 0;
      *(_DWORD *)(v1 + 8) = 0;
    }
  }
  return result;
}

//----- (004037E8) --------------------------------------------------------
int __thiscall sub_4037E8(_DWORD *this, int a2)
{
  int v2; // edx
  unsigned int v3; // edi

  v2 = 0x7FFFFFFF;
  v3 = this[5];
  if ( (a2 | 0xFu) <= 0x7FFFFFFF && v3 <= 0x7FFFFFFF - (v3 >> 1) )
  {
    v2 = a2 | 0xF;
    if ( (a2 | 0xFu) < v3 + (v3 >> 1) )
      return v3 + (v3 >> 1);
  }
  return v2;
}

//----- (0040381C) --------------------------------------------------------
void __noreturn sub_40381C()
{
  std::_Xlength_error("vector too long");
}
// 40381C: using guessed type void __noreturn sub_40381C();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (00403828) --------------------------------------------------------
_DWORD *__stdcall sub_403828(unsigned int a1)
{
  int savedregs; // [esp+0h] [ebp+0h]

  if ( a1 > 0x1FFFFFFF )
    sub_4013C3(savedregs);
  return sub_403756(8 * a1);
}
// 403842: variable 'savedregs' is possibly undefined
// 4013C3: using guessed type void __stdcall __noreturn sub_4013C3(_DWORD);

//----- (00403848) --------------------------------------------------------
int __thiscall sub_403848(int this, unsigned int a2, int a3)
{
  unsigned int v3; // edi
  unsigned int v4; // ecx
  unsigned int v5; // edx
  _DWORD *v6; // esi
  int v8; // [esp+Ch] [ebp-8h]

  v3 = 0x1FFFFFFF;
  if ( a2 > 0x1FFFFFFF )
    sub_40381C();
  v8 = (*(_DWORD *)(this + 4) - *(_DWORD *)this) >> 3;
  v4 = (*(_DWORD *)(this + 8) - *(_DWORD *)this) >> 3;
  v5 = v4 >> 1;
  if ( v4 <= 0x1FFFFFFF - (v4 >> 1) )
  {
    v3 = v5 + v4;
    if ( v5 + v4 < a2 )
      v3 = a2;
  }
  v6 = sub_403828(v3);
  memset(&v6[2 * v8], 0, 8 * (a2 - v8));
  memmove(v6, *(const void **)this, *(_DWORD *)(this + 4) - *(_DWORD *)this);
  return sub_403A31((_DWORD *)this, (int)v6, a2, v3);
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (004038D2) --------------------------------------------------------
char *__thiscall sub_4038D2(void **this, char *Src, int a3, int a4)
{
  _BYTE *v5; // esi
  unsigned int v6; // edi
  unsigned int v7; // eax
  char *v8; // edi
  char *v9; // esi
  char *result; // eax

  v5 = *this;
  v6 = (a3 - (int)Src) >> 3;
  if ( v6 > ((_BYTE *)this[2] - (_BYTE *)*this) >> 3 )
  {
    sub_403A66(this, (a3 - (int)Src) >> 3);
    v5 = *this;
    memmove(*this, Src, a3 - (_DWORD)Src);
LABEL_6:
    result = &v5[8 * v6];
    goto LABEL_7;
  }
  v7 = ((_BYTE *)this[1] - v5) >> 3;
  if ( v6 <= v7 )
  {
    memmove(v5, Src, a3 - (_DWORD)Src);
    goto LABEL_6;
  }
  v8 = &Src[8 * v7];
  memmove(v5, Src, 8 * v7);
  v9 = (char *)this[1];
  memmove(v9, v8, a3 - (_DWORD)v8);
  result = &v9[8 * ((a3 - (int)v8) >> 3)];
LABEL_7:
  this[1] = result;
  return result;
}

//----- (00403966) --------------------------------------------------------
_DWORD *__thiscall sub_403966(int this, const void *a2, _DWORD *a3)
{
  unsigned int v4; // esi
  int v5; // eax
  int v6; // ebx
  unsigned int v7; // ecx
  unsigned int v8; // edx
  _DWORD *v9; // eax
  _DWORD *v10; // ebx
  int v11; // ecx
  const void *v12; // ecx
  int v13; // ebx
  _DWORD *v15; // [esp+Ch] [ebp-10h]
  unsigned int v16; // [esp+10h] [ebp-Ch]
  void *v17; // [esp+18h] [ebp-4h]

  v4 = 0x1FFFFFFF;
  v5 = (*(_DWORD *)(this + 4) - *(_DWORD *)this) >> 3;
  v6 = ((int)a2 - *(_DWORD *)this) >> 3;
  if ( v5 == 0x1FFFFFFF )
    sub_40381C();
  v7 = (*(_DWORD *)(this + 8) - *(_DWORD *)this) >> 3;
  v16 = v5 + 1;
  v8 = v7 >> 1;
  if ( v7 <= 0x1FFFFFFF - (v7 >> 1) )
  {
    v4 = v8 + v7;
    if ( v8 + v7 < v16 )
      v4 = v5 + 1;
  }
  v9 = sub_403828(v4);
  v17 = v9;
  v10 = &v9[2 * v6];
  v11 = a3[1];
  *v10 = *a3;
  v10[1] = v11;
  v12 = *(const void **)(this + 4);
  v15 = v10;
  if ( a2 == v12 )
  {
    memmove(v9, *(const void **)this, (size_t)v12 - *(_DWORD *)this);
    v13 = (int)v17;
  }
  else
  {
    v13 = (int)v9;
    memmove(v9, *(const void **)this, (size_t)a2 - *(_DWORD *)this);
    memmove(v15 + 2, a2, *(_DWORD *)(this + 4) - (_DWORD)a2);
  }
  sub_403A31((_DWORD *)this, v13, v16, v4);
  return v15;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403A31) --------------------------------------------------------
int __thiscall sub_403A31(_DWORD *this, int a2, int a3, int a4)
{
  _DWORD *v5; // ecx
  int result; // eax

  v5 = (_DWORD *)*this;
  if ( v5 )
    sub_403795(v5, (this[2] - (_DWORD)v5) & 0xFFFFFFF8);
  *this = a2;
  this[1] = a2 + 8 * a3;
  result = a2 + 8 * a4;
  this[2] = result;
  return result;
}

//----- (00403A66) --------------------------------------------------------
_DWORD *__thiscall sub_403A66(_DWORD *this, unsigned int a2)
{
  unsigned int v2; // edi
  _DWORD *v4; // ecx
  unsigned int v5; // edx
  unsigned int v6; // ebx
  _DWORD *v7; // eax
  _DWORD *result; // eax

  v2 = 0x1FFFFFFF;
  if ( a2 > 0x1FFFFFFF )
    sub_40381C();
  v4 = (_DWORD *)*this;
  v5 = (this[2] - *this) >> 3;
  v6 = v5 >> 1;
  if ( v5 <= 0x1FFFFFFF - (v5 >> 1) )
  {
    v2 = v6 + v5;
    if ( v6 + v5 < a2 )
      v2 = a2;
  }
  if ( v4 )
  {
    sub_403795(v4, 8 * v5);
    *this = 0;
    this[1] = 0;
    this[2] = 0;
  }
  v7 = sub_403828(v2);
  *this = v7;
  this[1] = v7;
  result = &v7[2 * v2];
  this[2] = result;
  return result;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403ACC) --------------------------------------------------------
char *__thiscall sub_403ACC(char *this, char a2)
{
  return sub_403434(&this[-*((_DWORD *)this - 1)], a2);
}

//----- (00403AD4) --------------------------------------------------------
_DWORD *__thiscall sub_403AD4(_DWORD *this, char a2)
{
  return sub_4033E0((_DWORD *)((char *)this - *(this - 1)), a2);
}

//----- (00403ADC) --------------------------------------------------------
int __fastcall sub_403ADC(int a1, int a2)
{
  int v2; // ebx
  struct _LIST_ENTRY *p_InMemoryOrderModuleList; // edx
  struct _LIST_ENTRY *Flink; // esi
  unsigned int v5; // edi
  char *v6; // esi
  char v7; // cl
  unsigned __int8 *v8; // edi
  unsigned __int8 v9; // al
  int v10; // ecx
  struct _LIST_ENTRY *v11; // ecx
  _DWORD *v12; // eax
  int v13; // edi
  int v14; // edi
  unsigned __int8 *v15; // ebx
  unsigned __int8 v16; // al
  int v17; // edx
  int v19; // [esp+Ch] [ebp-64h]
  int v20; // [esp+10h] [ebp-60h]
  unsigned int v21; // [esp+14h] [ebp-5Ch]
  struct _LIST_ENTRY *v23; // [esp+1Ch] [ebp-54h]
  int v24; // [esp+20h] [ebp-50h]
  struct _LIST_ENTRY *v26; // [esp+28h] [ebp-48h]
  int v27; // [esp+28h] [ebp-48h]
  char v28[64]; // [esp+2Ch] [ebp-44h] BYREF

  v2 = a2;
  p_InMemoryOrderModuleList = &NtCurrentTeb()->ProcessEnvironmentBlock->Ldr->InMemoryOrderModuleList;
  v23 = p_InMemoryOrderModuleList;
  Flink = p_InMemoryOrderModuleList->Flink;
  v26 = p_InMemoryOrderModuleList->Flink;
  if ( p_InMemoryOrderModuleList->Flink == p_InMemoryOrderModuleList )
    return 0;
  while ( 1 )
  {
    if ( LOWORD(Flink[4].Blink) >= 0x3Fu )
      goto LABEL_24;
    v5 = 0;
    if ( Flink[5].Flink->Flink )
    {
      v6 = (char *)Flink[5].Flink;
      do
      {
        if ( v5 >= 0x3F )
          break;
        v7 = *v6 - 32;
        if ( (unsigned __int8)(*v6 - 97) > 0x19u )
          v7 = *v6;
        v6 += 2;
        v28[v5++] = v7;
      }
      while ( *(_WORD *)v6 );
      Flink = v26;
      if ( v5 >= 0x40 )
      {
        __report_rangecheckfailure(0);
        __debugbreak();
      }
      p_InMemoryOrderModuleList = v23;
      v2 = a2;
    }
    v28[v5] = 0;
    v8 = (unsigned __int8 *)v28;
    v9 = v28[0];
    v10 = -2128831035;
    while ( v9 )
    {
      ++v8;
      v10 = 16777619 * (v10 ^ v9);
      v9 = *v8;
    }
    if ( v10 != v2 )
      goto LABEL_24;
    v11 = Flink[2].Flink;
    v12 = (struct _LIST_ENTRY **)((char *)&v11->Flink
                                + *(unsigned int *)((char *)&v11[7].Blink[15].Flink + (unsigned int)v11));
    v13 = v12[8];
    if ( !v13 )
      goto LABEL_24;
    v20 = (int)v11 + v12[9];
    v24 = (int)v11 + v13;
    v14 = 0;
    v19 = (int)v11 + v12[7];
    v21 = v12[6];
    if ( v21 )
      break;
LABEL_23:
    v2 = a2;
LABEL_24:
    Flink = Flink->Flink;
    v26 = Flink;
    if ( Flink == p_InMemoryOrderModuleList )
      return 0;
  }
  while ( 1 )
  {
    v27 = -2128831035;
    v15 = (unsigned __int8 *)v11 + *(_DWORD *)(v24 + 4 * v14);
    v16 = *v15;
    if ( *v15 )
    {
      v17 = -2128831035;
      do
      {
        ++v15;
        v17 = 16777619 * (v17 ^ v16);
        v16 = *v15;
      }
      while ( *v15 );
      v27 = v17;
      p_InMemoryOrderModuleList = v23;
    }
    if ( v27 == a1 )
      return (int)v11 + *(_DWORD *)(v19 + 4 * *(unsigned __int16 *)(v20 + 2 * v14));
    if ( ++v14 >= v21 )
      goto LABEL_23;
  }
}
// 40536F: using guessed type int __thiscall __report_rangecheckfailure(_DWORD);
// 403ADC: using guessed type char var_44[64];

//----- (00403C42) --------------------------------------------------------
_DWORD *__userpurge sub_403C42@<eax>(int a1@<ebp>, _DWORD *a2, _BYTE *a3, _BYTE *a4, int a5, int a6)
{
  _BYTE *v6; // esi
  int v7; // eax
  void *v8; // edi
  int **v9; // eax
  int *v10; // edx
  unsigned int v11; // ecx
  _BYTE *v12; // edi
  int v13; // eax
  int v14; // eax
  _DWORD *v15; // esi
  int v17; // [esp-20h] [ebp-2Ch] BYREF
  _DWORD *v18; // [esp-18h] [ebp-24h]
  int v19; // [esp-14h] [ebp-20h]
  void *v20; // [esp-10h] [ebp-1Ch] BYREF
  int v21; // [esp-Ch] [ebp-18h]
  _BYTE *v22; // [esp-8h] [ebp-14h]
  _DWORD v23[3]; // [esp+0h] [ebp-Ch] BYREF
  void *retaddr; // [esp+Ch] [ebp+0h]

  v23[0] = a1;
  v23[1] = retaddr;
  v6 = a3;
  v18 = a2;
  v22 = a4;
  v19 = a6 + 32 * ((a5 - (int)Block) >> 2);
  v7 = sub_403D15((int)v23, a4 - a3, a5, a6);
  v8 = Block;
  v21 = 0;
  v20 = Block;
  v9 = (int **)sub_403FE2((int *)&v20, &v17, v7);
  v10 = *v9;
  v11 = (unsigned int)v9[1];
  if ( a3 != v22 )
  {
    v12 = v22;
    do
    {
      v13 = *v10;
      if ( *v6 )
        v14 = v13 | (1 << v11);
      else
        v14 = v13 & ~(1 << v11);
      *v10 = v14;
      if ( v11 >= 0x1F )
      {
        v11 = 0;
        ++v10;
      }
      else
      {
        ++v11;
      }
      ++v6;
    }
    while ( v6 != v12 );
    v8 = Block;
  }
  v15 = v18;
  v21 = 0;
  v20 = v8;
  sub_403FE2((int *)&v20, v18, v19);
  return v15;
}
// 403C42: could not find valid save-restore pair for ebp

//----- (00403D15) --------------------------------------------------------
int __userpurge sub_403D15@<eax>(int a1@<ebp>, unsigned int a2, int a3, int a4)
{
  int v4; // edi
  void *v5; // esi
  int v6; // esi
  _DWORD *v7; // eax
  int *v8; // edx
  _DWORD *v9; // edi
  _DWORD *v10; // ecx
  int v11; // eax
  int v12; // ecx
  int v13; // eax
  int v14; // eax
  int v16; // [esp-2Ch] [ebp-38h] BYREF
  _DWORD v17[2]; // [esp-24h] [ebp-30h] BYREF
  int v18; // [esp-1Ch] [ebp-28h]
  int v19; // [esp-18h] [ebp-24h] BYREF
  void *v20; // [esp-14h] [ebp-20h] BYREF
  _DWORD *v21; // [esp-10h] [ebp-1Ch]
  __int64 v22; // [esp-Ch] [ebp-18h] BYREF
  int v23; // [esp+0h] [ebp-Ch]
  int v24; // [esp+4h] [ebp-8h]
  int retaddr; // [esp+Ch] [ebp+0h]

  v23 = a1;
  v24 = retaddr;
  v4 = a4 + 32 * ((a3 - (int)Block) >> 2);
  v18 = v4;
  if ( a2 )
  {
    if ( 0x7FFFFFFF - dword_40A41C < a2 )
      sub_4044BC();
    v19 = 0;
    sub_403E63((a2 + dword_40A41C + 31) >> 5, &v19);
    if ( dword_40A41C )
    {
      v5 = Block;
      v21 = 0;
      v22 = 0i64;
      v20 = Block;
      sub_403FE2((int *)&v20, &v22, dword_40A41C);
      v21 = 0;
      dword_40A41C += a2;
      v20 = v5;
      sub_403FE2((int *)&v20, v17, dword_40A41C);
      v21 = 0;
      v20 = v5;
      v6 = v17[1];
      v7 = sub_403FE2((int *)&v20, &v16, v4);
      v8 = (int *)v17[0];
      v9 = (_DWORD *)v22;
      v10 = (_DWORD *)*v7;
      v11 = v7[1];
      v21 = v10;
      v12 = HIDWORD(v22);
      v19 = v11;
      while ( v21 != v9 || v11 != v12 )
      {
        if ( v12 )
        {
          --v12;
        }
        else
        {
          v12 = 31;
          --v9;
        }
        if ( v6 )
        {
          --v6;
        }
        else
        {
          v6 = 31;
          --v8;
        }
        v13 = *v8;
        if ( ((1 << v12) & *v9) != 0 )
          v14 = v13 | (1 << v6);
        else
          v14 = v13 & ~(1 << v6);
        *v8 = v14;
        v11 = v19;
      }
      return v18;
    }
    else
    {
      dword_40A41C = a2;
    }
  }
  return v4;
}
// 403D15: could not find valid save-restore pair for ebp
// 4044BC: using guessed type void __noreturn sub_4044BC(void);
// 40A41C: using guessed type int dword_40A41C;

//----- (00403E63) --------------------------------------------------------
void __stdcall sub_403E63(unsigned int a1, _DWORD *a2)
{
  unsigned int v2; // ecx
  _DWORD *v3; // eax

  v2 = ((_BYTE *)dword_40A414 - (_BYTE *)Block) >> 2;
  if ( a1 >= v2 )
  {
    if ( a1 <= v2 )
      return;
    if ( a1 > (dword_40A418 - (int)Block) >> 2 )
    {
      sub_403EBC(a1, a2);
      return;
    }
    v3 = sub_403F89(dword_40A414, a1 - v2, a2);
  }
  else
  {
    v3 = (char *)Block + 4 * a1;
  }
  dword_40A414 = v3;
}
// 40A418: using guessed type int dword_40A418;

//----- (00403EBC) --------------------------------------------------------
_DWORD *__stdcall sub_403EBC(unsigned int a1, _DWORD *a2)
{
  unsigned int v2; // ecx
  unsigned int v3; // edx
  int v4; // edi
  unsigned int v5; // eax
  _DWORD *v6; // ebx
  _DWORD *result; // eax
  int v8; // [esp-4h] [ebp-10h]
  int v9; // [esp+8h] [ebp-4h]

  if ( a1 > 0x3FFFFFFF )
    sub_40381C();
  v2 = (dword_40A418 - (int)Block) >> 2;
  v3 = v2 >> 1;
  v4 = ((_BYTE *)dword_40A414 - (_BYTE *)Block) >> 2;
  if ( v2 <= 0x3FFFFFFF - (v2 >> 1) )
  {
    v5 = v3 + v2;
    if ( v3 + v2 >= a1 )
    {
      if ( v5 > 0x3FFFFFFF )
        sub_4013C3(v8);
    }
    else
    {
      v5 = a1;
    }
  }
  else
  {
    v5 = 0x3FFFFFFF;
  }
  v9 = v5;
  v6 = sub_403756(4 * v5);
  sub_403F89(&v6[v4], a1 - v4, a2);
  memmove(v6, Block, (_BYTE *)dword_40A414 - (_BYTE *)Block);
  if ( Block )
    sub_403795(Block, (dword_40A418 - (_DWORD)Block) & 0xFFFFFFFC);
  Block = v6;
  dword_40A414 = &v6[a1];
  result = &v6[v9];
  dword_40A418 = (int)&v6[v9];
  return result;
}
// 403F7E: variable 'v8' is possibly undefined
// 4013C3: using guessed type void __stdcall __noreturn sub_4013C3(_DWORD);
// 40381C: using guessed type void __noreturn sub_40381C(void);
// 40A418: using guessed type int dword_40A418;

//----- (00403F89) --------------------------------------------------------
_DWORD *__usercall sub_403F89@<eax>(_DWORD *a1@<ecx>, int a2@<edx>, _DWORD *a3)
{
  _DWORD *v3; // edi
  int v4; // esi

  v3 = a1;
  if ( *a3 )
  {
    for ( ; a2; --a2 )
      *v3++ = *a3;
    return v3;
  }
  else
  {
    v4 = a2;
    memset(a1, 0, 4 * a2);
    return &v3[v4];
  }
}

//----- (00403FE2) --------------------------------------------------------
_DWORD *__thiscall sub_403FE2(int *this, _DWORD *a2, int a3)
{
  int v3; // eax
  int *v4; // edi
  unsigned int v5; // esi
  _DWORD *result; // eax

  v3 = *this;
  a2[1] = this[1];
  *a2 = v3;
  v4 = a2 + 1;
  if ( a3 >= 0 || *v4 >= (unsigned int)-a3 )
  {
    v5 = a3 + *v4;
    *a2 += 4 * (v5 >> 5);
  }
  else
  {
    v5 = a3 + *v4;
    *a2 += -4 - 4 * (~v5 >> 5);
  }
  *v4 = v5;
  result = a2;
  *v4 = v5 & 0x1F;
  return result;
}

//----- (0040403A) --------------------------------------------------------
int sub_40403A()
{
  unsigned int v0; // ebx
  void (__stdcall *v1)(char *); // esi
  char v3[23]; // [esp+9h] [ebp-17h] BYREF

  v0 = 0;
  v1 = (void (__stdcall *)(char *))sub_403ADC(1102179001, 701355107);
  qmemcpy(v3, "yj)jUj?j?j+jUj?j?jjj", 20);
  do
  {
    v3[v0] = (35 * (106 - (unsigned __int8)v3[v0]) % 127 + 127) % 127;
    ++v0;
  }
  while ( v0 < 0x14 );
  v1(v3);
  return 0;
}

//----- (004040E3) --------------------------------------------------------
int sub_4040E3()
{
  int (__stdcall *v0)(int, int *, int, char *); // eax
  int v1; // eax
  int *v2; // esi
  int (__stdcall *v4)(int); // [esp+Ch] [ebp-14h]
  void *v5; // [esp+10h] [ebp-10h] BYREF
  char v6[4]; // [esp+14h] [ebp-Ch] BYREF
  int v7; // [esp+18h] [ebp-8h] BYREF

  v4 = (int (__stdcall *)(int))sub_403ADC(-366093686, 341012667);
  if ( !v4
    || (v0 = (int (__stdcall *)(int, int *, int, char *))sub_403ADC(1842915397, 701355107),
        v1 = v0(31, &v7, 4, v6),
        v4(v1) < 0)
    || v7 )
  {
    v2 = sub_4046ED(&v5);
    if ( v2 != &dword_40A400 )
    {
      sub_404691((void **)&dword_40A400);
      dword_40A400 = *v2;
      dword_40A404 = v2[1];
      v2[1] = 0;
      *v2 = 0;
    }
    sub_404691(&v5);
  }
  return 0;
}
// 404111: conditional instruction was optimized away because eax.4!=0
// 40A400: using guessed type int dword_40A400;
// 40A404: using guessed type int dword_40A404;
// 4040E3: using guessed type char var_C[4];

//----- (0040418B) --------------------------------------------------------
int sub_40418B()
{
  int v0; // eax
  void *v2[2]; // [esp+Ch] [ebp-38h] BYREF
  _DWORD *v3; // [esp+14h] [ebp-30h]
  void (__stdcall *v4)(_DWORD, _DWORD, _DWORD); // [esp+18h] [ebp-2Ch]
  void (__stdcall *v5)(_DWORD, _DWORD, _DWORD); // [esp+1Ch] [ebp-28h]
  int (__stdcall *v6)(_DWORD); // [esp+20h] [ebp-24h]
  int (__stdcall *v7)(_DWORD *); // [esp+24h] [ebp-20h]
  int (__stdcall *v8)(_DWORD); // [esp+28h] [ebp-1Ch]
  int (__stdcall *v9)(_DWORD, _DWORD, _DWORD, _DWORD); // [esp+2Ch] [ebp-18h]
  int (__stdcall *v10)(_DWORD, _DWORD, _DWORD, _DWORD); // [esp+30h] [ebp-14h]
  int v11; // [esp+34h] [ebp-10h]
  int v12; // [esp+38h] [ebp-Ch]
  _DWORD *v13; // [esp+3Ch] [ebp-8h]
  _DWORD *v14; // [esp+40h] [ebp-4h]

  v11 = 0;
  v10 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_403ADC(52974849, 701355107);
  v9 = v10;
  v14 = (_DWORD *)v10(0, 716, 4096, 4);
  if ( v14 )
  {
    memset(v14, 0, 0x2CCu);
    v13 = v14 + 179;
    v12 = 0;
    *v14 = 65552;
    v8 = (int (__stdcall *)(_DWORD))sub_403ADC(-2050186626, 701355107);
    v7 = (int (__stdcall *)(_DWORD *))sub_403ADC(-1681545720, 701355107);
    v6 = v8;
    v0 = v7(v14);
    if ( v8(v0) && (v14[1] || v14[2] || v14[3] || v14[4]) )
      v11 = 1;
    v5 = (void (__stdcall *)(_DWORD, _DWORD, _DWORD))sub_403ADC(983223410, 701355107);
    v4 = v5;
    v5(v14, 0, 0x8000);
  }
  if ( !v11 && !*(_BYTE *)(dword_40A420 + 2) )
  {
    v3 = sub_4047C7(&dword_40A400, v2, dword_40A408);
    sub_40459E((int)&dword_40A400, v3);
    sub_40452E(v2);
  }
  return 0;
}
// 40A400: using guessed type int dword_40A400;
// 40A408: using guessed type _DWORD dword_40A408[2];
// 40A420: using guessed type int dword_40A420;

//----- (004042D2) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  char v3; // al
  int v4; // eax
  int v6; // [esp+0h] [ebp-4Ch]
  int v7; // [esp+4h] [ebp-48h]
  int Src[13]; // [esp+18h] [ebp-34h] BYREF

  Src[0] = 0;
  Src[4] = 0;
  Src[5] = 15;
  Src[12] = 1;
  sub_4048B4(v6, v7);
  v3 = std::ios::widen(std::cin + *(_DWORD *)(std::cin + 4), 10);
  sub_404CD6(v3, v6);
  v4 = sub_4048B4(v6, v7);
  std::ostream::operator<<(v4, sub_404A45);
  sub_4033BD(Src);
  return 1;
}
// 40432C: conditional instruction was optimized away because %var_24.4==0
// 402462: using guessed type _DWORD __cdecl sub_402462(_DWORD, _DWORD);
// 4024DF: using guessed type _DWORD __stdcall sub_4024DF(_DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD);
// 4033BD: using guessed type int __thiscall sub_4033BD(_DWORD);
// 4048B4: using guessed type _DWORD __cdecl sub_4048B4(_DWORD, _DWORD);
// 404A45: using guessed type int __cdecl sub_404A45(int);
// 404B41: using guessed type int __thiscall sub_404B41(_DWORD);
// 404CD6: using guessed type _DWORD __cdecl sub_404CD6(char, _DWORD);
// 4070A4: using guessed type int __thiscall std::ios::widen(_DWORD, _DWORD);
// 4070BC: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);

//----- (004044BC) --------------------------------------------------------
void __noreturn sub_4044BC()
{
  std::_Xlength_error("vector<bool> too long");
}
// 4044BC: using guessed type void __noreturn sub_4044BC();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (004044EF) --------------------------------------------------------
void __thiscall sub_4044EF(void **this)
{
  if ( *this )
    j_free(*this);
  this[1] = 0;
  *this = 0;
}

//----- (00404508) --------------------------------------------------------
_DWORD *__thiscall sub_404508(_DWORD *this, _BYTE *a2, int a3)
{
  this[1] = 0;
  *this = 0;
  sub_404651(this, a3 - (_DWORD)a2, a2, (int)this);
  return this;
}

//----- (00404533) --------------------------------------------------------
void **__thiscall sub_404533(void **this, int a2, int a3)
{
  int v4; // ebx
  unsigned int v5; // edi
  unsigned int v6; // ecx
  _DWORD *v7; // ecx
  unsigned int v9; // [esp+14h] [ebp-10h]

  v4 = a2;
  this[1] = 0;
  *this = 0;
  v5 = (a3 - a2) >> 3;
  if ( v5 )
  {
    *this = sub_404A74(v5);
    v6 = 0;
    v9 = 0;
    do
    {
      v7 = (char *)*this + 8 * v6;
      v7[1] = 0;
      *v7 = 0;
      sub_404651(v7, *(_DWORD *)(v4 + 4), *(_BYTE **)v4, (int)v7);
      v4 += 8;
      v6 = v9 + 1;
      v9 = v6;
    }
    while ( v6 < v5 );
    this[1] = (void *)v5;
  }
  return this;
}

//----- (0040459E) --------------------------------------------------------
int __thiscall sub_40459E(int this, _DWORD *a2)
{
  if ( (_DWORD *)this != a2 )
  {
    sub_404691((void **)this);
    *(_DWORD *)this = *a2;
    *(_DWORD *)(this + 4) = a2[1];
    a2[1] = 0;
    *a2 = 0;
  }
  return this;
}

//----- (004045CA) --------------------------------------------------------
_DWORD *__thiscall sub_4045CA(_DWORD *this, _DWORD *Src)
{
  _DWORD *v2; // ebx
  unsigned int v4; // eax
  int v5; // esi
  _DWORD *v6; // eax
  unsigned int v8; // [esp+8h] [ebp-4h]

  v2 = Src;
  *this = 0;
  this[4] = 0;
  this[5] = 0;
  v4 = Src[4];
  v8 = v4;
  if ( Src[5] >= 0x10u )
    v2 = (_DWORD *)*Src;
  if ( v4 > 0x7FFFFFFF )
    sub_401416();
  this[5] = 15;
  if ( v4 >= 0x10 )
  {
    v5 = sub_4037E8(this, v4);
    v6 = sub_403756(__CFADD__(v5, 1) ? -1 : v5 + 1);
    this[4] = v8;
    *this = v6;
    this[5] = v5;
    memcpy(v6, v2, v8 + 1);
  }
  else
  {
    this[4] = v4;
    memmove(this, v2, 0x10u);
  }
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (00404651) --------------------------------------------------------
void __thiscall sub_404651(_DWORD *this, size_t Size, _BYTE *a3, int a4)
{
  size_t v4; // esi
  void *v6; // eax
  _BYTE *v7; // ebx
  size_t v8; // edx

  v4 = Size;
  if ( Size )
  {
    v6 = operator new(Size);
    v7 = a3;
    v8 = 0;
    *this = v6;
    do
    {
      *(_BYTE *)(v8 + *this) = *v7;
      ++v8;
      ++v7;
    }
    while ( v8 < v4 );
    Size = 0;
    this[1] = v4;
    sub_4046D0((int *)&Size);
  }
}

//----- (00404691) --------------------------------------------------------
void __thiscall sub_404691(void **this)
{
  unsigned int *v2; // esi
  unsigned int i; // ebx

  v2 = (unsigned int *)(this + 1);
  if ( *this )
  {
    for ( i = 0; i < *v2; ++i )
      sub_4044EF((void **)*this + 2 * i);
    j_free(*this);
  }
  *this = 0;
  *v2 = 0;
}

//----- (004046D0) --------------------------------------------------------
void __thiscall sub_4046D0(int *this)
{
  int v1; // esi

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
      j_free(*(void **)v1);
    *(_DWORD *)(v1 + 4) = 0;
    *(_DWORD *)v1 = 0;
  }
}

//----- (004046ED) --------------------------------------------------------
_DWORD *__thiscall sub_4046ED(_DWORD *this)
{
  _DWORD *v1; // esi
  unsigned int v2; // edi
  unsigned int v3; // ebx
  size_t v4; // ebx
  int v7; // [esp+18h] [ebp-28h]
  int v8; // [esp+1Ch] [ebp-24h]
  unsigned int v9; // [esp+20h] [ebp-20h]
  size_t v10; // [esp+24h] [ebp-1Ch]
  void *Block[2]; // [esp+28h] [ebp-18h] BYREF
  int v12; // [esp+30h] [ebp-10h]
  int v13; // [esp+3Ch] [ebp-4h]

  v1 = this;
  v2 = 0;
  v3 = dword_40A404;
  *this = 0;
  v9 = v3;
  this[1] = 0;
  sub_404C1C((void **)this, v3);
  v13 = 0;
  v12 = 1;
  if ( v3 )
  {
    do
    {
      v8 = dword_40A424;
      v7 = dword_40A400;
      v10 = *(_DWORD *)(dword_40A400 + 8 * v2 + 4);
      *(_QWORD *)Block = 0i64;
      sub_404F0B(Block, v10);
      v12 |= 2u;
      v4 = 0;
      if ( v10 )
      {
        do
        {
          *((_BYTE *)Block[0] + v4) = *(_BYTE *)(*(_DWORD *)(v7 + 8 * v2) + v4) ^ *(_BYTE *)(*(_DWORD *)(v8 + 8 * v2)
                                                                                           + v4);
          ++v4;
        }
        while ( v4 < v10 );
        v1 = this;
      }
      sub_404C9F(8 * v2 + *v1, Block);
      if ( Block[0] )
        j_free(Block[0]);
      Block[1] = 0;
      Block[0] = 0;
      ++v2;
    }
    while ( v2 < v9 );
  }
  return v1;
}
// 40A400: using guessed type int dword_40A400;
// 40A404: using guessed type int dword_40A404;
// 40A424: using guessed type int dword_40A424;

//----- (004047C7) --------------------------------------------------------
_DWORD *__usercall sub_4047C7@<eax>(_DWORD *a1@<edx>, _DWORD *a2@<ecx>, _DWORD *a3)
{
  _DWORD *v3; // esi
  unsigned int v4; // edi
  unsigned int v5; // ebx
  size_t i; // ebx
  _DWORD *v9; // [esp+18h] [ebp-34h]
  _DWORD *v10; // [esp+1Ch] [ebp-30h]
  unsigned int v12; // [esp+28h] [ebp-24h]
  unsigned int v13; // [esp+2Ch] [ebp-20h]
  size_t v14; // [esp+30h] [ebp-1Ch]
  void *Block[2]; // [esp+34h] [ebp-18h] BYREF
  int v16; // [esp+3Ch] [ebp-10h]
  int v17; // [esp+48h] [ebp-4h]

  v3 = a2;
  v4 = 0;
  v17 = 0;
  v16 = 0;
  v5 = a1[1];
  *a2 = 0;
  v12 = v5;
  a2[1] = 0;
  sub_404C1C((void **)a2, v5);
  v17 = 0;
  v16 = 1;
  v13 = 0;
  if ( v5 )
  {
    do
    {
      v9 = (_DWORD *)(8 * v4 + *a3);
      v10 = (_DWORD *)(8 * v4 + *a1);
      v14 = v10[1];
      *(_QWORD *)Block = 0i64;
      sub_404F0B(Block, v14);
      v16 |= 2u;
      if ( v14 )
      {
        for ( i = 0; i < v14; ++i )
          *((_BYTE *)Block[0] + i) = *(_BYTE *)(*v10 + i) + *(_BYTE *)(*v9 + i);
        v3 = a2;
        v4 = v13;
        v5 = v12;
      }
      sub_404C9F(8 * v4 + *v3, Block);
      if ( Block[0] )
        j_free(Block[0]);
      Block[1] = 0;
      Block[0] = 0;
      v13 = ++v4;
    }
    while ( v4 < v5 );
  }
  return v3;
}

//----- (004048B4) --------------------------------------------------------
int __fastcall sub_4048B4(int a1, const char *a2)
{
  int v3; // ebx
  unsigned int v4; // edx
  int v5; // eax
  int v6; // eax
  unsigned int v7; // ecx
  int v8; // eax
  int v9; // eax
  int i; // ecx
  int v11; // eax
  int v12; // ecx
  int v13; // eax
  bool v14; // cf
  int v15; // eax
  int v16; // edx
  int v17; // eax
  int j; // ecx
  int v19; // eax
  int v20; // ecx
  int v22; // [esp+10h] [ebp-34h] BYREF
  char v23; // [esp+14h] [ebp-30h]
  const char *v24; // [esp+18h] [ebp-2Ch]
  int v25; // [esp+1Ch] [ebp-28h]
  unsigned int v26; // [esp+20h] [ebp-24h]
  int v27; // [esp+28h] [ebp-1Ch]
  __int64 v28; // [esp+2Ch] [ebp-18h]
  int v29; // [esp+40h] [ebp-4h]

  v24 = a2;
  v25 = a1;
  v3 = 0;
  v4 = strlen(a2);
  v5 = *(_DWORD *)a1;
  v26 = v4;
  v6 = *(_DWORD *)(v5 + 4);
  v7 = *(_DWORD *)(v6 + a1 + 32);
  v8 = *(_DWORD *)(v6 + a1 + 36);
  if ( v8 >= 0 && (v8 > 0 || v7 && v7 > v4) )
  {
    v27 = (__PAIR64__(v8, v7) - v4) >> 32;
    HIDWORD(v28) = v7 - v4;
  }
  else
  {
    v28 = 0i64;
    v27 = 0;
  }
  sub_404BB5(&v22, a1);
  v29 = 0;
  if ( v23 )
  {
    LOBYTE(v29) = 1;
    if ( (*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a1 + 4) + a1 + 20) & 0x1C0) != 64 )
    {
      v9 = HIDWORD(v28);
      for ( i = v27; i >= 0 && (i > 0 || v9); v27 = i )
      {
        v11 = *(_DWORD *)(*(_DWORD *)a1 + 4);
        v12 = *(_DWORD *)(v11 + a1 + 56);
        LOBYTE(v11) = *(_BYTE *)(v11 + a1 + 64);
        if ( std::streambuf::sputc(v12, v11) == -1 )
        {
          v3 = 4;
          goto LABEL_16;
        }
        v14 = HIDWORD(v28) != 0;
        v9 = --HIDWORD(v28);
        i = v14 + v27 - 1;
      }
    }
    v15 = std::streambuf::sputn(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a1 + 4) + a1 + 56), v24, v26, 0);
    if ( v15 != v26 || v16 )
    {
LABEL_25:
      v3 = 4;
    }
    else
    {
      v17 = HIDWORD(v28);
      for ( j = v27; j >= 0 && (j > 0 || v17); v27 = j )
      {
        v19 = *(_DWORD *)(*(_DWORD *)a1 + 4);
        v20 = *(_DWORD *)(v19 + a1 + 56);
        LOBYTE(v19) = *(_BYTE *)(v19 + a1 + 64);
        if ( std::streambuf::sputc(v20, v19) == -1 )
          goto LABEL_25;
        v14 = HIDWORD(v28) != 0;
        v17 = --HIDWORD(v28);
        j = v14 + v27 - 1;
      }
    }
LABEL_16:
    v13 = *(_DWORD *)(*(_DWORD *)a1 + 4);
    *(_DWORD *)(v13 + a1 + 32) = 0;
    *(_DWORD *)(v13 + a1 + 36) = 0;
    v29 = 0;
  }
  else
  {
    v3 = 4;
  }
  std::ios::setstate(a1 + *(_DWORD *)(*(_DWORD *)a1 + 4), v3, 0);
  sub_404B64(&v22);
  return a1;
}
// 4048F6: conditional instruction was optimized away because eax.4==0
// 4048F8: conditional instruction was optimized away because eax.4==0
// 4049BE: variable 'v16' is possibly undefined
// 40709C: using guessed type int __thiscall std::streambuf::sputn(_DWORD, _DWORD, _DWORD, _DWORD);
// 4070B8: using guessed type int __thiscall std::streambuf::sputc(_DWORD, _DWORD);

//----- (00404A45) --------------------------------------------------------
int __cdecl sub_404A45(int a1)
{
  unsigned __int8 v1; // al

  v1 = std::ios::widen(a1 + *(_DWORD *)(*(_DWORD *)a1 + 4), 10);
  std::ostream::put(a1, v1);
  std::ostream::flush(a1);
  return a1;
}
// 404A45: using guessed type int __cdecl sub_404A45(int);
// 4070A4: using guessed type int __thiscall std::ios::widen(_DWORD, _DWORD);
// 4070A8: using guessed type int __thiscall std::ostream::put(_DWORD, _DWORD);
// 4070AC: using guessed type int __thiscall std::ostream::flush(_DWORD);

//----- (00404A74) --------------------------------------------------------
void *__fastcall sub_404A74(unsigned int a1)
{
  if ( !a1 )
    return 0;
  if ( a1 > 0x1FFFFFFF )
    sub_4013C3();
  return operator new(8 * a1);
}
// 4013C3: using guessed type void __noreturn sub_4013C3(void);

//----- (00404A94) --------------------------------------------------------
_DWORD *__thiscall sub_404A94(_DWORD *this, int a2, int a3, char a4)
{
  size_t v4; // ebx
  int v5; // esi
  _DWORD *v6; // ecx
  _DWORD *v7; // esi
  _DWORD *v8; // eax
  unsigned int v10; // [esp+Ch] [ebp-Ch]
  _DWORD *v12; // [esp+14h] [ebp-4h]

  v4 = this[4];
  if ( v4 == 0x7FFFFFFF )
    sub_401416();
  v10 = this[5];
  v5 = sub_4037E8(this, v4 + 1);
  v6 = sub_403756(__CFADD__(v5, 1) ? -1 : v5 + 1);
  v12 = v6;
  this[4] = v4 + 1;
  this[5] = v5;
  if ( v10 < 0x10 )
  {
    memcpy(v6, this, v4);
    v8 = v12;
    *((_BYTE *)v12 + v4) = a4;
    *((_BYTE *)v12 + v4 + 1) = 0;
  }
  else
  {
    v7 = (_DWORD *)*this;
    memcpy(v6, (const void *)*this, v4);
    *((_BYTE *)v12 + v4) = a4;
    *((_BYTE *)v12 + v4 + 1) = 0;
    sub_403795(v7, v10 + 1);
    v8 = v12;
  }
  *this = v8;
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (00404B41) --------------------------------------------------------
int __thiscall sub_404B41(int *this)
{
  int v1; // esi
  int result; // eax

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
    {
      sub_403795(*(_DWORD **)v1, *(_DWORD *)(v1 + 8) - *(_DWORD *)v1);
      result = 0;
      *(_DWORD *)v1 = 0;
      *(_DWORD *)(v1 + 4) = 0;
      *(_DWORD *)(v1 + 8) = 0;
    }
  }
  return result;
}

//----- (00404B64) --------------------------------------------------------
int __thiscall sub_404B64(int *this)
{
  if ( !std::uncaught_exceptions() )
    std::ostream::_Osfx(*this);
  return sub_404C57(this);
}
// 407084: using guessed type int __cdecl std::uncaught_exceptions();
// 407098: using guessed type int __thiscall std::ostream::_Osfx(_DWORD);

//----- (00404BB5) --------------------------------------------------------
_BYTE *__thiscall sub_404BB5(_BYTE *this, int a2)
{
  int v3; // ecx
  bool v4; // bl
  int v5; // ecx
  int v6; // ecx

  *(_DWORD *)this = a2;
  v3 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 56);
  if ( v3 )
    (*(void (__thiscall **)(int))(*(_DWORD *)v3 + 4))(v3);
  v4 = 0;
  v5 = *(_DWORD *)(*(_DWORD *)a2 + 4);
  if ( !*(_DWORD *)(v5 + a2 + 12) )
  {
    v6 = *(_DWORD *)(v5 + a2 + 60);
    if ( !v6 || v6 == a2 )
    {
      v4 = 1;
    }
    else
    {
      std::ostream::flush(v6);
      v4 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 12) == 0;
    }
  }
  this[4] = v4;
  return this;
}
// 4070AC: using guessed type int __thiscall std::ostream::flush(_DWORD);

//----- (00404C1C) --------------------------------------------------------
void **__thiscall sub_404C1C(void **this, unsigned int a2)
{
  unsigned int i; // ecx
  _DWORD *v4; // eax

  this[1] = 0;
  *this = 0;
  if ( a2 )
  {
    *this = sub_404A74(a2);
    for ( i = 0; i < a2; ++i )
    {
      v4 = *this;
      v4[2 * i + 1] = 0;
      v4[2 * i] = 0;
    }
    this[1] = (void *)a2;
  }
  return this;
}

//----- (00404C57) --------------------------------------------------------
int __thiscall sub_404C57(int *this)
{
  int v1; // ecx
  int result; // eax
  int v3; // ecx

  v1 = *this;
  result = *(_DWORD *)(*(_DWORD *)v1 + 4);
  v3 = *(_DWORD *)(result + v1 + 56);
  if ( v3 )
    return (*(int (**)(void))(*(_DWORD *)v3 + 8))();
  return result;
}

//----- (00404C9F) --------------------------------------------------------
int __thiscall sub_404C9F(int this, _DWORD *a2)
{
  int result; // eax

  if ( (_DWORD *)this != a2 )
  {
    if ( *(_DWORD *)this )
      j_free(*(void **)this);
    *(_DWORD *)(this + 4) = 0;
    *(_DWORD *)this = 0;
    *(_DWORD *)this = *a2;
    result = a2[1];
    *(_DWORD *)(this + 4) = result;
    a2[1] = 0;
    *a2 = 0;
  }
  return result;
}

//----- (00404CD6) --------------------------------------------------------
int __usercall sub_404CD6@<eax>(_DWORD *a1@<edx>, int a2@<ecx>, unsigned __int8 a3)
{
  int v5; // edi
  int v6; // eax
  int v7; // ecx
  _BYTE *v8; // eax
  int i; // eax
  char v10; // dl
  int v11; // eax
  unsigned int v12; // ecx
  bool v13; // cf
  _DWORD *v14; // eax
  int v15; // eax
  int v17; // [esp+10h] [ebp-2Ch] BYREF
  char v18; // [esp+14h] [ebp-28h]
  int v19; // [esp+18h] [ebp-24h]
  int v20; // [esp+1Ch] [ebp-20h]
  int v21; // [esp+20h] [ebp-1Ch]
  char v22; // [esp+27h] [ebp-15h]
  int v23; // [esp+28h] [ebp-14h]
  int v24; // [esp+38h] [ebp-4h]

  v21 = a2;
  v22 = 0;
  v5 = 0;
  v6 = *(_DWORD *)a2;
  v20 = 0;
  v17 = a2;
  v7 = *(_DWORD *)(*(_DWORD *)(v6 + 4) + a2 + 56);
  if ( v7 )
    (*(void (__thiscall **)(int))(*(_DWORD *)v7 + 4))(v7);
  v18 = std::istream::_Ipfx(a2, 1);
  v24 = 1;
  if ( !v18 )
    goto LABEL_20;
  LOBYTE(v24) = 2;
  v8 = a1;
  if ( a1[5] >= 0x10u )
    v8 = (_BYTE *)*a1;
  a1[4] = 0;
  *v8 = 0;
  v19 = a3;
  for ( i = std::streambuf::sgetc(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 56));
        ;
        i = std::streambuf::snextc(*(_DWORD *)(*(_DWORD *)(v15 + 4) + a2 + 56)) )
  {
    v10 = i;
    if ( i == -1 )
    {
      v5 = 1;
      goto LABEL_19;
    }
    if ( i == v19 )
    {
      v11 = *(_DWORD *)a2;
      v22 = 1;
      std::streambuf::sbumpc(*(_DWORD *)(*(_DWORD *)(v11 + 4) + a2 + 56));
      goto LABEL_19;
    }
    v12 = a1[4];
    if ( v12 >= 0x7FFFFFFF )
      break;
    LOBYTE(v23) = i;
    if ( v12 >= a1[5] )
    {
      sub_404A94(a1, v12, v20, v23);
    }
    else
    {
      v13 = a1[5] < 0x10u;
      a1[4] = v12 + 1;
      v14 = a1;
      if ( !v13 )
        v14 = (_DWORD *)*a1;
      *((_BYTE *)v14 + v12) = v10;
      *((_BYTE *)v14 + v12 + 1) = 0;
    }
    v15 = *(_DWORD *)a2;
    v22 = 1;
  }
  v5 = 2;
LABEL_19:
  v24 = 1;
  if ( !v22 )
LABEL_20:
    v5 |= 2u;
  std::ios::setstate(a2 + *(_DWORD *)(*(_DWORD *)a2 + 4), v5, 0);
  sub_404C57(&v17);
  return a2;
}
// 407090: using guessed type int __thiscall std::istream::_Ipfx(_DWORD, _DWORD);
// 407094: using guessed type int __thiscall std::streambuf::snextc(_DWORD);
// 4070B0: using guessed type int __thiscall std::streambuf::sbumpc(_DWORD);
// 4070B4: using guessed type int __thiscall std::streambuf::sgetc(_DWORD);

//----- (00404E21) --------------------------------------------------------
char *__thiscall sub_404E21(char **this, char *a2, int a3, int a4)
{
  char *v5; // eax
  size_t v6; // edi
  char *v7; // ecx
  unsigned int v8; // eax
  size_t v9; // esi
  char *v10; // esi
  char *result; // eax
  size_t v12; // eax
  char *v13; // edi
  char *v14; // esi
  char *v15; // esi
  unsigned int v16; // [esp+10h] [ebp-Ch]
  int v17; // [esp+18h] [ebp-4h]

  v5 = this[2];
  v6 = a3 - (_DWORD)a2;
  v7 = *this;
  v8 = v5 - v7;
  if ( a3 - (int)a2 <= v8 )
  {
    v12 = this[1] - v7;
    if ( v6 <= v12 )
    {
      v15 = &v7[v6];
      result = (char *)memmove(v7, a2, a3 - (_DWORD)a2);
      this[1] = v15;
    }
    else
    {
      v13 = &a2[v12];
      memmove(v7, a2, this[1] - v7);
      v14 = this[1];
      memmove(v14, v13, a3 - (_DWORD)v13);
      result = &v14[a3 - (_DWORD)v13];
      this[1] = result;
    }
  }
  else
  {
    v9 = 0x7FFFFFFF;
    v17 = 0x7FFFFFFF;
    if ( v6 > 0x7FFFFFFF )
      sub_40381C();
    v16 = v8 >> 1;
    if ( v8 <= 0x7FFFFFFF - (v8 >> 1) )
    {
      v9 = v8 + v16;
      if ( v8 + v16 < v6 )
        v9 = a3 - (_DWORD)a2;
      v17 = v9;
    }
    if ( v7 )
    {
      sub_403795(v7, v8);
      *this = 0;
      this[1] = 0;
      this[2] = 0;
    }
    v10 = (char *)sub_403756(v9);
    *this = v10;
    this[1] = v10;
    this[2] = &v10[v17];
    memmove(v10, a2, v6);
    result = &v10[v6];
    this[1] = &v10[v6];
  }
  return result;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00404F0B) --------------------------------------------------------
_DWORD *__thiscall sub_404F0B(_DWORD *this, size_t Size)
{
  size_t v3; // edi
  size_t i; // ecx

  v3 = Size;
  this[1] = 0;
  *this = 0;
  if ( v3 )
  {
    *this = operator new(v3);
    for ( i = 0; i < v3; ++i )
      *(_BYTE *)(*this + i) = 0;
    Size = 0;
    this[1] = v3;
    sub_4046D0((int *)&Size);
  }
  return this;
}

//----- (00404F50) --------------------------------------------------------
__m128i *__cdecl sub_404F50(__m128i *a1, __m128i *a2)
{
  __m128i *result; // eax
  __m128i *v9; // edx
  __m128i v10; // xmm0
  __m128i v11; // xmm1
  __int8 v12; // dl

  result = a1;
  _ESI = a2;
  if ( (unsigned int)((char *)a2 - (char *)a1) >= 0x40 && (dword_40A004 & 0x20) != 0 )
  {
    __asm { vmovdqu ymm2, ds:ymmword_407200 }
    do
    {
      __asm { vpermq  ymm0, ymmword ptr [eax], 4Eh ; 'N' }
      _ESI -= 2;
      __asm
      {
        vpshufb ymm1, ymm0, ymm2
        vpermq  ymm0, ymmword ptr [esi], 4Eh ; 'N'
        vpshufb ymm0, ymm0, ymm2
        vmovdqu ymmword ptr [eax], ymm0
      }
      result += 2;
      __asm { vmovdqu ymmword ptr [esi], ymm1 }
    }
    while ( result != (__m128i *)&a1->m128i_i8[((unsigned int)((char *)a2 - (char *)a1) >> 1) & 0x7FFFFFE0] );
  }
  if ( (unsigned int)((char *)_ESI - (char *)result) >= 0x20 && (dword_40A004 & 4) != 0 )
  {
    v9 = (__m128i *)((char *)result + (((unsigned int)((char *)_ESI - (char *)result) >> 1) & 0x7FFFFFF0));
    do
    {
      v10 = _ESI[-1];
      --_ESI;
      v11 = _mm_shuffle_epi8(*result, (__m128i)xmmword_4071E0);
      *result++ = _mm_shuffle_epi8(v10, (__m128i)xmmword_4071E0);
      *_ESI = v11;
    }
    while ( result != v9 );
  }
  for ( ; result != _ESI; _ESI->m128i_i8[0] = v12 )
  {
    _ESI = (__m128i *)((char *)_ESI - 1);
    if ( result == _ESI )
      break;
    v12 = result->m128i_i8[0];
    result->m128i_i8[0] = _ESI->m128i_i8[0];
    result = (__m128i *)((char *)result + 1);
  }
  return result;
}
// 404F50: unsupported processor register 'ymm2'
// 4071E0: using guessed type __int128 xmmword_4071E0;
// 40A004: using guessed type int dword_40A004;

//----- (004051A8) --------------------------------------------------------
void __cdecl sub_4051A8(void *Block)
{
  j_free(Block);
}

//----- (004051B6) --------------------------------------------------------
_DWORD *__thiscall sub_4051B6(_DWORD *Block, char a2)
{
  *Block = &type_info::`vftable';
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}
// 407224: using guessed type void *type_info::`vftable';

//----- (00405746) --------------------------------------------------------
int sub_405746()
{
  __scrt_initialize_default_local_stdio_options();
  return 0;
}
// 405E30: using guessed type int __scrt_initialize_default_local_stdio_options(void);

//----- (0040574E) --------------------------------------------------------
int sub_40574E()
{
  int v0; // eax

  sub_405CEC();
  v0 = UserMathErrorFunction();
  return set_new_mode(v0);
}

//----- (004058EC) --------------------------------------------------------
int sub_4058EC()
{
  int v5; // edi
  int v11; // eax
  int v12; // edi
  int v18; // eax
  int v19; // eax
  int v20; // eax
  int v22; // [esp+0h] [ebp-24h]
  char v23; // [esp+10h] [ebp-14h]
  int v24; // [esp+18h] [ebp-Ch]
  int v25; // [esp+1Ch] [ebp-8h]
  int v26; // [esp+20h] [ebp-4h]
  int v27; // [esp+20h] [ebp-4h]

  dword_40A3D8 = 0;
  dword_40A004 |= 1u;
  if ( IsProcessorFeaturePresent(0xAu) )
  {
    _EAX = 0;
    __asm { cpuid }
    v24 = _EAX;
    v5 = _EBX ^ 0x756E6547;
    v26 = _EDX ^ 0x49656E69;
    v25 = _ECX ^ 0x6C65746E;
    _EAX = 1;
    __asm { cpuid }
    v22 = _EAX;
    if ( !(v5 | v25 | v26)
      && ((v11 = _EAX & 0xFFF3FF0, (v22 & 0xFFF3FF0) == 67264)
       || v11 == 132704
       || v11 == 132720
       || v11 == 198224
       || v11 == 198240
       || v11 == 198256) )
    {
      v12 = dword_40A3DC | 1;
      dword_40A3DC |= 1u;
    }
    else
    {
      v12 = dword_40A3DC;
    }
    _EAX = 7;
    v27 = _ECX;
    if ( v24 < 7 )
    {
      _EBX = 0;
    }
    else
    {
      __asm { cpuid }
      _ECX = v27;
      if ( (_EBX & 0x200) != 0 )
        dword_40A3DC = v12 | 2;
    }
    v18 = dword_40A004 | 2;
    dword_40A3D8 = 1;
    dword_40A004 |= 2u;
    if ( (_ECX & 0x100000) != 0 )
    {
      v19 = v18 | 4;
      dword_40A3D8 = 2;
      dword_40A004 = v19;
      if ( (_ECX & 0x8000000) != 0 && (_ECX & 0x10000000) != 0 )
      {
        __asm { xgetbv }
        v23 = v19;
        if ( (v19 & 6) == 6 )
        {
          v20 = dword_40A004 | 8;
          dword_40A3D8 = 3;
          dword_40A004 |= 8u;
          if ( (_EBX & 0x20) != 0 )
          {
            dword_40A3D8 = 5;
            dword_40A004 = v20 | 0x20;
            if ( (_EBX & 0xD0030000) == -805109760 && (v23 & 0xE0) == 224 )
            {
              dword_40A004 |= 0x40u;
              dword_40A3D8 = 6;
            }
          }
        }
      }
    }
  }
  return 0;
}
// 4058EC: could not find valid save-restore pair for ebx
// 40A004: using guessed type int dword_40A004;
// 40A3D8: using guessed type int dword_40A3D8;
// 40A3DC: using guessed type int dword_40A3DC;

//----- (00405AC0) --------------------------------------------------------
_DWORD *__thiscall sub_405AC0(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad allocation";
  *this = &std::bad_alloc::`vftable';
  return result;
}
// 407240: using guessed type void *std::bad_alloc::`vftable';

//----- (00405AD8) --------------------------------------------------------
void __noreturn sub_405AD8()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_405AC0(pExceptionObject);
  CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI2_AVbad_alloc_std__);
}
// 405AD8: using guessed type void __noreturn sub_405AD8();
// 405AD8: using guessed type _DWORD pExceptionObject[3];

//----- (00405B77) --------------------------------------------------------
int sub_405B77()
{
  return 1;
}

//----- (00405CA7) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (00405CAA) --------------------------------------------------------
bool sub_405CAA()
{
  HMODULE ModuleHandleW; // eax
  char *v1; // ecx
  bool result; // al

  ModuleHandleW = GetModuleHandleW(0);
  result = ModuleHandleW
        && *(_WORD *)ModuleHandleW == 23117
        && (v1 = (char *)ModuleHandleW + *((_DWORD *)ModuleHandleW + 15), *(_DWORD *)v1 == 17744)
        && *((_WORD *)v1 + 12) == 267
        && *((_DWORD *)v1 + 29) > 0xEu
        && *((_DWORD *)v1 + 58) != 0;
  return result;
}

//----- (00405CEC) --------------------------------------------------------
LPTOP_LEVEL_EXCEPTION_FILTER sub_405CEC()
{
  return SetUnhandledExceptionFilter(__scrt_unhandled_exception_filter);
}

//----- (00405D4E) --------------------------------------------------------
void sub_405D4E()
{
  dword_40A3E0 = 0;
}
// 40A3E0: using guessed type int dword_40A3E0;

//----- (00405DF4) --------------------------------------------------------
void sub_405DF4()
{
  InitializeSListHead(&ListHead);
}

//----- (00405E00) --------------------------------------------------------
char sub_405E00()
{
  return 1;
}

//----- (00405E24) --------------------------------------------------------
void *sub_405E24()
{
  return &unk_40A3F0;
}

//----- (00405E2A) --------------------------------------------------------
void *sub_405E2A()
{
  return &unk_40A3F8;
}

//----- (00405E4D) --------------------------------------------------------
BOOL sub_405E4D()
{
  return dword_40A010 == 0;
}
// 40A010: using guessed type int dword_40A010;

//----- (00405E59) --------------------------------------------------------
void *sub_405E59()
{
  return &unk_40A430;
}

//----- (00405E5F) --------------------------------------------------------
void *sub_405E5F()
{
  return &unk_40A42C;
}

//----- (00405E65) --------------------------------------------------------
void sub_405E65()
{
  ;
}
// 405E65: could not find valid save-restore pair for edi

//----- (00405E91) --------------------------------------------------------
void __cdecl sub_405E91()
{
  ;
}
// 405E91: could not find valid save-restore pair for edi

//----- (004060C3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4060C3()
{
  ;
}
// 4060E3: positive sp value 18 has been found
// 4060E4: unbalanced stack, ignored a potential tail call

//----- (0040695D) --------------------------------------------------------
void __cdecl sub_40695D()
{
  sub_404691((void **)&dword_40A400);
}
// 40A400: using guessed type int dword_40A400;

//----- (00406967) --------------------------------------------------------
void __cdecl sub_406967()
{
  sub_404691((void **)&dword_40A424);
}
// 40A424: using guessed type int dword_40A424;

//----- (00406971) --------------------------------------------------------
void __cdecl sub_406971()
{
  sub_404691((void **)&unk_40A408);
}

//----- (0040697B) --------------------------------------------------------
void __cdecl sub_40697B()
{
  if ( Block )
  {
    sub_403795(Block, ((_BYTE *)*(&Block + 2) - (_BYTE *)Block) & 0xFFFFFFFC);
    Block = 0;
    *(&Block + 1) = 0;
    *(&Block + 2) = 0;
  }
}

// nfuncs=235 queued=143 decompiled=143 lumina nreq=0 worse=0 better=0
// ALL OK, 143 function(s) have been successfully decompiled

//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int sub_401000();
int sub_4010ED();
int sub_4011DA();
// void __usercall sub_4012C7(int a1@<ebp>);
struct _PEB *sub_401309();
int sub_401315();
_DWORD *__thiscall sub_401330(_DWORD *this, int a2);
const char *__thiscall sub_40135D(_DWORD *this);
char *__thiscall sub_40136B(char *Block, char a2);
int __thiscall sub_401399(_DWORD *this);
_DWORD *__thiscall sub_4013AB(_DWORD *this);
void __stdcall __noreturn sub_4013C3(_DWORD); // weak
_DWORD *__thiscall sub_4013E0(_DWORD *this, int a2);
_DWORD *__thiscall sub_4013FB(_DWORD *this, int a2);
void __noreturn sub_401416(void); // weak
int __cdecl sub_401422(int a1);
int __fastcall sub_40143C(char a1);
void __thiscall sub_4015D7(_DWORD *this);
int __thiscall sub_4015E7(int this, int a2);
int __thiscall sub_40162C(int this, int a2);
int __thiscall sub_401656(int this, char *a2, unsigned __int64 a3, int a4);
void __thiscall sub_4016C5(int *this, unsigned int a2);
_DWORD *__thiscall sub_40171C(_DWORD *this, _DWORD *a2, int a3);
int *__thiscall sub_40174A(int *this);
int __fastcall sub_401774(int *a1, int *a2);
__int64 __cdecl sub_4017DF(unsigned __int64 a1);
__int64 __cdecl sub_40180F(__int64 a1);
unsigned __int64 __cdecl sub_40184B(__int64 a1, unsigned int a2, unsigned int a3);
int *__fastcall sub_4018A7(int *a1, _DWORD *a2);
int *__fastcall sub_4019A4(int *a1, _DWORD *a2);
// int __usercall sub_401A95@<eax>(int a1@<edx>, int a2@<ecx>, int a3);
// int *__usercall sub_401C41@<eax>(int *a1@<edx>, int *a2@<ecx>, int *a3);
// int __usercall sub_401E63@<eax>(int *a1@<edx>, int a2@<ecx>, char a3, _DWORD *a4, char a5);
int *__fastcall sub_401F2F(int *a1, int a2, unsigned int a3);
// int __usercall sub_4020C6@<eax>(int *a1@<edx>, int *a2@<ecx>, int a3, unsigned int a4);
// int __usercall sub_40213F@<eax>(int a1@<edx>, int a2@<ecx>, _DWORD *a3);
int *__thiscall sub_40218E(int *this, __int64 a2);
int *__thiscall sub_402266(int *this, unsigned int a2, int a3, int a4);
int __thiscall sub_4022E4(int this, int a2);
bool __thiscall sub_402339(int this, int a2);
_DWORD *__thiscall sub_402398(int this, _DWORD *a2, int a3);
_DWORD *__thiscall sub_4023D2(int this, _DWORD *a2, int a3);
int *__thiscall sub_402412(int *this, int *a2, int *a3);
void __thiscall sub_40245D(void *); // idb
void __thiscall sub_402462(_DWORD **this);
int __thiscall sub_4024DF(_DWORD *this, int a2, int a3, int a4, int a5, int a6, unsigned int a7);
int __thiscall sub_4027C6(void *this, int a2, int a3, unsigned int *a4);
int __thiscall sub_4028E9(void *this, int a2, __m128i **a3, char a4);
int __thiscall sub_402A7A(void *this);
bool __thiscall sub_402BA1(int *this);
int __thiscall sub_402E28(_DWORD *this);
_DWORD *__thiscall sub_402E58(_DWORD *this, int a2);
unsigned int *__thiscall sub_402EC4(int this, unsigned int *a2, __int64 a3, __int64 a4, int a5, int a6, char a7);
_DWORD *__thiscall sub_402FCE(int this, _DWORD *a2, __int64 a3, int a4, char a5);
int __thiscall sub_403136(int this);
int __thiscall sub_403192(int this, int a2);
int __thiscall sub_4031E5(int this, int a2);
int __thiscall sub_403304(_BYTE *this);
// int __thiscall std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(_DWORD); weak
int __thiscall sub_40339B(_DWORD *this);
void __thiscall sub_4033BD(_DWORD **this);
_DWORD *__thiscall sub_4033E0(_DWORD *this, char a2);
_BYTE *__thiscall sub_403412(_BYTE *Block, char a2);
char *__thiscall sub_403434(char *this, char a2);
_DWORD *__thiscall sub_403466(int this, _DWORD *a2);
_DWORD *__thiscall sub_4034FB(_DWORD *this, char a2);
_DWORD *__thiscall sub_40354F(_DWORD *this, _DWORD *a2, unsigned int a3, int a4, int a5);
_DWORD *__thiscall sub_403606(_DWORD *this, void *Src, size_t Size);
void __noreturn sub_4036A4(void); // weak
void __thiscall sub_4036B0(_DWORD *this, unsigned int a2, _DWORD *a3);
_DWORD *__thiscall sub_403756(size_t Size);
void __fastcall sub_403795(_DWORD *Block, unsigned int a2);
int __thiscall sub_4037C2(int *this);
int __thiscall sub_4037E8(_DWORD *this, int a2);
void __noreturn sub_40381C(void); // weak
_DWORD *__stdcall sub_403828(unsigned int a1);
int __thiscall sub_403848(int this, unsigned int a2, int a3);
char *__thiscall sub_4038D2(void **this, char *Src, int a3, int a4);
_DWORD *__thiscall sub_403966(int this, const void *a2, _DWORD *a3);
int __thiscall sub_403A31(_DWORD *this, int a2, int a3, int a4);
_DWORD *__thiscall sub_403A66(_DWORD *this, unsigned int a2);
char *__thiscall sub_403ACC(char *this, char a2);
_DWORD *__thiscall sub_403AD4(_DWORD *this, char a2);
int __fastcall sub_403ADC(int a1, int a2);
// _DWORD *__userpurge sub_403C42@<eax>(int a1@<ebp>, _DWORD *a2, _BYTE *a3, _BYTE *a4, int a5, int a6);
// int __userpurge sub_403D15@<eax>(int a1@<ebp>, unsigned int a2, int a3, int a4);
void __stdcall sub_403E63(unsigned int a1, _DWORD *a2);
_DWORD *__stdcall sub_403EBC(unsigned int a1, _DWORD *a2);
// _DWORD *__usercall sub_403F89@<eax>(_DWORD *a1@<ecx>, int a2@<edx>, _DWORD *a3);
_DWORD *__thiscall sub_403FE2(int *this, _DWORD *a2, int a3);
int sub_40403A();
int sub_4040E3();
int sub_40418B();
int __cdecl main(int argc, const char **argv, const char **envp);
void __noreturn sub_4044BC(void); // weak
void __thiscall sub_4044EF(void **this);
_DWORD *__thiscall sub_404508(_DWORD *this, _BYTE *a2, int a3);
void __thiscall sub_40452E(void **this);
void **__thiscall sub_404533(void **this, int a2, int a3);
int __thiscall sub_40459E(int this, _DWORD *a2);
_DWORD *__thiscall sub_4045CA(_DWORD *this, _DWORD *Src);
void __thiscall sub_404651(_DWORD *this, size_t Size, _BYTE *a3, int a4);
void __thiscall sub_404691(void **this);
void __thiscall sub_4046D0(int *this);
_DWORD *__thiscall sub_4046ED(_DWORD *this);
// _DWORD *__usercall sub_4047C7@<eax>(_DWORD *a1@<edx>, _DWORD *a2@<ecx>, _DWORD *a3);
int __fastcall sub_4048B4(int a1, const char *a2);
int __cdecl sub_404A45(int); // weak
void *__fastcall sub_404A74(unsigned int a1);
_DWORD *__thiscall sub_404A94(_DWORD *this, int a2, int a3, char a4);
int __thiscall sub_404B41(int *this);
int __thiscall sub_404B64(int *this);
_BYTE *__thiscall sub_404BB5(_BYTE *this, int a2);
void **__thiscall sub_404C1C(void **this, unsigned int a2);
int __thiscall sub_404C57(int *this);
int __thiscall sub_404C9F(int this, _DWORD *a2);
// int __usercall sub_404CD6@<eax>(_DWORD *a1@<edx>, int a2@<ecx>, unsigned __int8 a3);
char *__thiscall sub_404E21(char **this, char *a2, int a3, int a4);
_DWORD *__thiscall sub_404F0B(_DWORD *this, size_t Size);
__m128i *__cdecl sub_404F50(__m128i *a1, __m128i *a2);
// void *__cdecl operator new(size_t Size); idb
// void __stdcall `eh vector destructor iterator'(void *, unsigned int, unsigned int, void (__thiscall *)(void *)); idb
void __cdecl j_free(void *Block);
void __cdecl sub_4051A8(void *Block);
_DWORD *__thiscall sub_4051B6(_DWORD *Block, char a2);
// void __stdcall `eh vector constructor iterator'(void *, unsigned int, unsigned int, void (__thiscall *)(void *), void (__thiscall *)(void *)); idb
// int __thiscall __report_rangecheckfailure(_DWORD); weak
// int __cdecl atexit(void (__cdecl *)());
int sub_405746();
int sub_40574E();
int sub_4058EC();
_DWORD *__thiscall sub_405AC0(_DWORD *this);
void __noreturn sub_405AD8(); // weak
int sub_405B77();
int __cdecl UserMathErrorFunction();
bool sub_405CAA();
LPTOP_LEVEL_EXCEPTION_FILTER sub_405CEC();
// LONG __stdcall __scrt_unhandled_exception_filter(struct _EXCEPTION_POINTERS *ExceptionInfo); idb
void sub_405D4E();
void sub_405DF4();
char sub_405E00();
void *sub_405E24();
void *sub_405E2A();
// int __scrt_initialize_default_local_stdio_options(void); weak
BOOL sub_405E4D();
void *sub_405E59();
void *sub_405E5F();
void sub_405E65();
void __cdecl sub_405E91(); // idb
// void __stdcall __noreturn CxxThrowException(void *pExceptionObject, _ThrowInfo *pThrowInfo);
// void *__cdecl memset(void *, int Val, size_t Size);
// int __cdecl set_new_mode(int NewMode);
void sub_4060C3();
// void *__cdecl memcpy(void *, const void *Src, size_t Size);
// void *__cdecl memmove(void *, const void *Src, size_t Size);
void __cdecl sub_40695D(); // idb
void __cdecl sub_406967(); // idb
void __cdecl sub_406971(); // idb
void __cdecl sub_40697B(); // idb
// int __thiscall std::streambuf::_Pninc(_DWORD); weak
// int __thiscall std::ios::ios(_DWORD); weak
// int __thiscall std::ostream::ostream(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::iostream::basic_iostream<char>(_DWORD, _DWORD, _DWORD); weak
// int __thiscall std::streambuf::~streambuf<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ostream::~ostream<char,std::char_traits<char>>(_DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int __cdecl std::uncaught_exceptions(); weak
// int __thiscall std::istream::_Ipfx(_DWORD, _DWORD); weak
// int __thiscall std::streambuf::snextc(_DWORD); weak
// int __thiscall std::ostream::_Osfx(_DWORD); weak
// int __thiscall std::streambuf::sputn(_DWORD, _DWORD, _DWORD, _DWORD); weak
// int __thiscall std::ios::setstate(_DWORD, _DWORD, _DWORD);
// int __thiscall std::ios::widen(_DWORD, _DWORD); weak
// int __thiscall std::ostream::put(_DWORD, _DWORD); weak
// int __thiscall std::ostream::flush(_DWORD); weak
// int __thiscall std::streambuf::sbumpc(_DWORD); weak
// int __thiscall std::streambuf::sgetc(_DWORD); weak
// int __thiscall std::streambuf::sputc(_DWORD, _DWORD); weak
// int __thiscall std::ostream::operator<<(_DWORD, _DWORD); weak
// int std::streambuf::streambuf(void); weak
// void __cdecl __noreturn std::_Xlength_error(const char *); weak
// int __cdecl std::setw(_DWORD, _DWORD, _DWORD); weak
// void __cdecl std::_Xout_of_range(const char *); weak
// int __cdecl _std_exception_destroy(_DWORD); weak
// int __cdecl _std_exception_copy(_DWORD, _DWORD); weak

//-------------------------------------------------------------------------
// Data declarations

// extern BOOL (__stdcall *IsProcessorFeaturePresent)(DWORD ProcessorFeature);
// extern HMODULE (__stdcall *GetModuleHandleW)(LPCWSTR lpModuleName);
// extern void (__stdcall *InitializeSListHead)(PSLIST_HEADER ListHead);
// extern LPTOP_LEVEL_EXCEPTION_FILTER (__stdcall *SetUnhandledExceptionFilter)(LPTOP_LEVEL_EXCEPTION_FILTER lpTopLevelExceptionFilter);
// extern _UNKNOWN std::cout; weak
// extern _UNKNOWN std::cin; weak
// extern void (__cdecl __noreturn *invalid_parameter_noinfo_noreturn)();
__int128 xmmword_4071E0 = 0x102030405060708090A0B0C0D0E0Fi64; // weak
void *type_info::`vftable' = &sub_4051B6; // weak
void *std::exception::`vftable' = &sub_40136B; // weak
void *std::bad_alloc::`vftable' = &sub_40136B; // weak
void *std::bad_array_new_length::`vftable' = &sub_40136B; // weak
int (__stdcall *off_4072C8)(int) = &sub_403AD4; // weak
_UNKNOWN unk_4072CC; // weak
int (__thiscall *off_4072D4)(void *Block, char) = &sub_403412; // weak
int (__stdcall *off_407310)(int) = &sub_403ACC; // weak
_UNKNOWN unk_407314; // weak
_UNKNOWN unk_40731C; // weak
int (__stdcall *off_407324)(int, int, int) = &sub_4027C6; // weak
const _ThrowInfo _TI2_AVbad_alloc_std__ = { 0u, &sub_401399, NULL, &_CTA2_AVbad_alloc_std__ }; // idb
const _ThrowInfo _TI3_AVbad_array_new_length_std__ = { 0u, &sub_401399, NULL, &_CTA3_AVbad_array_new_length_std__ }; // idb
int dword_40A004 = 1; // weak
int dword_40A010 = 1; // weak
int dword_40A3D8; // weak
int dword_40A3DC; // weak
int dword_40A3E0; // weak
union _SLIST_HEADER ListHead; // idb
_UNKNOWN unk_40A3F0; // weak
_UNKNOWN unk_40A3F8; // weak
int dword_40A400; // weak
int dword_40A404; // weak
_DWORD dword_40A408[2]; // weak
void *Block; // idb
void *dword_40A414; // idb
int dword_40A418; // weak
int dword_40A41C; // weak
int dword_40A420; // weak
int dword_40A424; // weak
_UNKNOWN unk_40A42C; // weak
_UNKNOWN unk_40A430; // weak


//----- (00401000) --------------------------------------------------------
int sub_401000()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = 120779315;
  v6[1] = -1690852714;
  v6[2] = 987782044;
  v6[3] = -686254453;
  v6[4] = 620147277;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = 2034781181;
  v5[1] = -565763295;
  v5[2] = -1917053112;
  v5[3] = -784121239;
  v5[4] = 1211855279;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -737866525;
  v4[1] = -87013448;
  v4[2] = 1148744304;
  v4[3] = -387155722;
  v4[4] = 1002842513;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&dword_40A400, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_40695D);
}
// 40A400: using guessed type int dword_40A400;

//----- (004010ED) --------------------------------------------------------
int sub_4010ED()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = -1963204422;
  v6[1] = -1256440389;
  v6[2] = -1838863551;
  v6[3] = -1397570986;
  v6[4] = 91604784;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = 1450262758;
  v5[1] = 388979981;
  v5[2] = 963305469;
  v5[3] = -609091096;
  v5[4] = 783443537;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -2083184370;
  v4[1] = -628347752;
  v4[2] = 1833553915;
  v4[3] = 616564496;
  v4[4] = 1758939125;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&dword_40A424, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_406967);
}
// 40A424: using guessed type int dword_40A424;

//----- (004011DA) --------------------------------------------------------
int sub_4011DA()
{
  int v1[2]; // [esp+10h] [ebp-60h] BYREF
  int v2; // [esp+18h] [ebp-58h] BYREF
  int v3; // [esp+20h] [ebp-50h] BYREF
  int v4[5]; // [esp+28h] [ebp-48h] BYREF
  int v5[5]; // [esp+3Ch] [ebp-34h] BYREF
  int v6[5]; // [esp+50h] [ebp-20h] BYREF
  int v7; // [esp+64h] [ebp-Ch] BYREF
  int v8; // [esp+6Ch] [ebp-4h]

  v6[0] = -431631174;
  v6[1] = 167467927;
  v6[2] = -2076276486;
  v6[3] = 350225387;
  v6[4] = -335311827;
  sub_404508(v1, v6, (int)&v7);
  v8 = 0;
  v5[0] = -1206364452;
  v5[1] = -274983458;
  v5[2] = 1755464728;
  v5[3] = -934355571;
  v5[4] = -8630772;
  sub_404508(&v2, v5, (int)v6);
  LOBYTE(v8) = 1;
  v4[0] = -1491598442;
  v4[1] = 1588880116;
  v4[2] = -1705674312;
  v4[3] = -856792348;
  v4[4] = -90173564;
  sub_404508(&v3, v4, (int)v5);
  v8 = 2;
  sub_404533((void **)&dword_40A408, (int)v1, (int)v4);
  v8 = -1;
  `eh vector destructor iterator'(v1, 8u, 3u, (void (__thiscall *)(void *))sub_4044EF);
  return atexit(sub_406971);
}

//----- (004012C7) --------------------------------------------------------
void __usercall sub_4012C7(int a1@<ebp>)
{
  *(_BYTE *)(a1 - 22) = 1;
  *(_WORD *)(a1 - 24) = 0;
  *(_DWORD *)(a1 - 4) = 0;
  sub_403C42(a1, (_DWORD *)(a1 - 32), (_BYTE *)(a1 - 24), (_BYTE *)(a1 - 21), 0, 0);
  atexit(sub_40697B);
  sub_4060C3();
}

//----- (00401309) --------------------------------------------------------
struct _PEB *sub_401309()
{
  struct _PEB *result; // eax

  result = NtCurrentPeb();
  dword_40A420 = (int)result;
  return result;
}
// 40A420: using guessed type int dword_40A420;

//----- (00401315) --------------------------------------------------------
int sub_401315()
{
  sub_40403A();
  sub_4040E3();
  return sub_40418B();
}

//----- (00401330) --------------------------------------------------------
_DWORD *__thiscall sub_401330(_DWORD *this, int a2)
{
  *this = &std::exception::`vftable';
  this[1] = 0;
  this[2] = 0;
  _std_exception_copy(a2 + 4, this + 1);
  return this;
}
// 4070E8: using guessed type int __cdecl _std_exception_copy(_DWORD, _DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (0040135D) --------------------------------------------------------
const char *__thiscall sub_40135D(_DWORD *this)
{
  const char *result; // eax

  result = "Unknown exception";
  if ( this[1] )
    return (const char *)this[1];
  return result;
}

//----- (0040136B) --------------------------------------------------------
char *__thiscall sub_40136B(char *Block, char a2)
{
  *(_DWORD *)Block = &std::exception::`vftable';
  _std_exception_destroy(Block + 4);
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}
// 4070E4: using guessed type int __cdecl _std_exception_destroy(_DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (00401399) --------------------------------------------------------
int __thiscall sub_401399(_DWORD *this)
{
  *this = &std::exception::`vftable';
  return _std_exception_destroy(this + 1);
}
// 4070E4: using guessed type int __cdecl _std_exception_destroy(_DWORD);
// 407234: using guessed type void *std::exception::`vftable';

//----- (004013AB) --------------------------------------------------------
_DWORD *__thiscall sub_4013AB(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad array new length";
  *this = &std::bad_array_new_length::`vftable';
  return result;
}
// 40725C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (004013C3) --------------------------------------------------------
void __noreturn sub_4013C3()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_4013AB(pExceptionObject);
  CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI3_AVbad_array_new_length_std__);
}
// 4013C3: using guessed type void __noreturn sub_4013C3();
// 4013C3: using guessed type _DWORD pExceptionObject[3];

//----- (004013E0) --------------------------------------------------------
_DWORD *__thiscall sub_4013E0(_DWORD *this, int a2)
{
  sub_401330(this, a2);
  *this = &std::bad_array_new_length::`vftable';
  return this;
}
// 40725C: using guessed type void *std::bad_array_new_length::`vftable';

//----- (004013FB) --------------------------------------------------------
_DWORD *__thiscall sub_4013FB(_DWORD *this, int a2)
{
  sub_401330(this, a2);
  *this = &std::bad_alloc::`vftable';
  return this;
}
// 407240: using guessed type void *std::bad_alloc::`vftable';

//----- (00401416) --------------------------------------------------------
void __noreturn sub_401416()
{
  std::_Xlength_error("string too long");
}
// 401416: using guessed type void __noreturn sub_401416();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (00401422) --------------------------------------------------------
int __cdecl sub_401422(int a1)
{
  int result; // eax

  result = a1;
  *(_DWORD *)(a1 + 20) = *(_DWORD *)(a1 + 20) & 0xFFFFF1FF | 0x800;
  return result;
}

//----- (0040143C) --------------------------------------------------------
int __fastcall sub_40143C(char a1)
{
  int result; // eax
  int v2; // [esp-4h] [ebp-4h]

  switch ( a1 )
  {
    case '0':
      return 0;
    case '1':
      return 1;
    case '2':
      v2 = 2;
      goto LABEL_6;
    case '3':
      v2 = 3;
      goto LABEL_6;
    case '4':
      v2 = 4;
      goto LABEL_6;
    case '5':
      v2 = 5;
      goto LABEL_6;
    case '6':
      v2 = 6;
      goto LABEL_6;
    case '7':
      v2 = 7;
      goto LABEL_6;
    case '8':
      v2 = 8;
      goto LABEL_6;
    case '9':
      v2 = 9;
      goto LABEL_6;
    case 'A':
    case 'a':
      v2 = 10;
      goto LABEL_6;
    case 'B':
    case 'b':
      v2 = 11;
      goto LABEL_6;
    case 'C':
    case 'c':
      v2 = 12;
      goto LABEL_6;
    case 'D':
    case 'd':
      v2 = 13;
      goto LABEL_6;
    case 'E':
    case 'e':
      v2 = 14;
      goto LABEL_6;
    case 'F':
    case 'f':
      v2 = 15;
      goto LABEL_6;
    case 'G':
    case 'g':
      v2 = 16;
      goto LABEL_6;
    case 'H':
    case 'h':
      v2 = 17;
      goto LABEL_6;
    case 'I':
    case 'i':
      v2 = 18;
      goto LABEL_6;
    case 'J':
    case 'j':
      v2 = 19;
      goto LABEL_6;
    case 'K':
    case 'k':
      v2 = 20;
      goto LABEL_6;
    case 'L':
    case 'l':
      v2 = 21;
      goto LABEL_6;
    case 'M':
    case 'm':
      v2 = 22;
      goto LABEL_6;
    case 'N':
    case 'n':
      v2 = 23;
      goto LABEL_6;
    case 'O':
    case 'o':
      v2 = 24;
      goto LABEL_6;
    case 'P':
    case 'p':
      v2 = 25;
      goto LABEL_6;
    case 'Q':
    case 'q':
      v2 = 26;
      goto LABEL_6;
    case 'R':
    case 'r':
      v2 = 27;
      goto LABEL_6;
    case 'S':
    case 's':
      v2 = 28;
      goto LABEL_6;
    case 'T':
    case 't':
      v2 = 29;
      goto LABEL_6;
    case 'U':
    case 'u':
      v2 = 30;
      goto LABEL_6;
    case 'V':
    case 'v':
      v2 = 31;
      goto LABEL_6;
    case 'W':
    case 'w':
      v2 = 32;
      goto LABEL_6;
    case 'X':
    case 'x':
      v2 = 33;
      goto LABEL_6;
    case 'Y':
    case 'y':
      v2 = 34;
      goto LABEL_6;
    case 'Z':
    case 'z':
      v2 = 35;
LABEL_6:
      result = v2;
      break;
    default:
      result = -1;
      break;
  }
  return result;
}

//----- (004015D7) --------------------------------------------------------
void __thiscall sub_4015D7(_DWORD *this)
{
  *this = 0;
  this[1] = 0;
  this[2] = 0;
  *((_BYTE *)this + 12) = 0;
}

//----- (004015E7) --------------------------------------------------------
int __thiscall sub_4015E7(int this, int a2)
{
  int result; // eax

  *(_DWORD *)this = 0;
  *(_DWORD *)(this + 4) = 0;
  *(_DWORD *)(this + 8) = 0;
  if ( this != a2 )
    sub_4038D2((void **)this, *(char **)a2, *(_DWORD *)(a2 + 4), this);
  result = this;
  *(_BYTE *)(this + 12) = *(_BYTE *)(a2 + 12);
  return result;
}

//----- (0040162C) --------------------------------------------------------
int __thiscall sub_40162C(int this, int a2)
{
  int result; // eax
  int v4; // [esp+8h] [ebp-4h]

  if ( this != a2 )
    sub_4038D2((void **)this, *(char **)a2, *(_DWORD *)(a2 + 4), v4);
  result = this;
  *(_BYTE *)(this + 12) = *(_BYTE *)(a2 + 12);
  return result;
}
// 401643: variable 'v4' is possibly undefined

//----- (00401656) --------------------------------------------------------
int __thiscall sub_401656(int this, char *a2, unsigned __int64 a3, int a4)
{
  char *v5; // edi
  char v6; // al
  unsigned __int64 v7; // rax
  int v8; // ecx

  *(_DWORD *)this = 0;
  *(_DWORD *)(this + 4) = 0;
  *(_DWORD *)(this + 8) = 0;
  v5 = a2;
  *(_BYTE *)(this + 12) = 0;
  v6 = *a2;
  if ( *a2 == 45 )
  {
    v5 = a2 + 1;
    *(_BYTE *)(this + 12) = 1;
    v6 = a2[1];
  }
  if ( v6 )
  {
    do
    {
      sub_40218E((int *)this, a3);
      LODWORD(v7) = sub_40143C(*v5);
      if ( v7 >= a3 )
        break;
      sub_402266((int *)this, v7, SHIDWORD(v7), v8);
      ++v5;
    }
    while ( *v5 );
  }
  return this;
}
// 4016A9: variable 'v7' is possibly undefined
// 4016B0: variable 'v8' is possibly undefined

//----- (004016C5) --------------------------------------------------------
void __thiscall sub_4016C5(int *this, unsigned int a2)
{
  char *v3; // ebx
  int v4; // edx
  unsigned int v5; // ecx
  char *v6; // eax
  size_t v7; // esi

  v3 = (char *)this[1];
  v4 = *this;
  v5 = (int)&v3[-*this] >> 3;
  if ( a2 >= v5 )
  {
    if ( a2 <= v5 )
      return;
    if ( a2 > (this[2] - v4) >> 3 )
    {
      sub_403848((int)this, a2, v5);
      return;
    }
    v7 = 8 * (a2 - v5);
    memset(v3, 0, v7);
    v6 = &v3[v7];
  }
  else
  {
    v6 = (char *)(v4 + 8 * a2);
  }
  this[1] = (int)v6;
}

//----- (0040171C) --------------------------------------------------------
_DWORD *__thiscall sub_40171C(_DWORD *this, _DWORD *a2, int a3)
{
  _DWORD *v4; // esi
  _DWORD *result; // eax
  int v6; // ecx

  v4 = (_DWORD *)this[1];
  if ( v4 == (_DWORD *)this[2] )
    return sub_403966((int)this, v4, &a2);
  result = a2;
  v6 = a3;
  *v4 = a2;
  v4[1] = v6;
  this[1] += 8;
  return result;
}

//----- (0040174A) --------------------------------------------------------
int *__thiscall sub_40174A(int *this)
{
  int v2; // edx
  int v3; // edi
  int v4; // ecx
  int v5; // eax

  v2 = this[1];
  v3 = *this;
  while ( (v2 - v3) >> 3 )
  {
    v4 = v2 - 8;
    v5 = *(_DWORD *)(v2 - 8);
    v2 = v4;
    if ( *(_DWORD *)(v4 + 4) | v5 )
      break;
    this[1] = v4;
  }
  return this;
}

//----- (00401774) --------------------------------------------------------
int __fastcall sub_401774(int *a1, int *a2)
{
  int v2; // esi
  int v3; // edi
  unsigned int v4; // eax
  unsigned int v5; // ecx
  unsigned int *v7; // ecx
  int v8; // esi
  unsigned int v9; // ebx
  unsigned int v10; // edx
  unsigned int v11; // edi
  bool v12; // cf
  bool v13; // cc

  v2 = *a1;
  v3 = *a2;
  v4 = (a1[1] - *a1) >> 3;
  v5 = (a2[1] - *a2) >> 3;
  if ( v4 != v5 )
    return v4 < v5 ? -1 : 1;
  if ( !v4 )
    return 0;
  v7 = (unsigned int *)(v3 + 8 * v4);
  v8 = v2 - v3;
  while ( 1 )
  {
    v7 -= 2;
    --v4;
    v9 = *(unsigned int *)((char *)v7 + v8);
    v10 = *(unsigned int *)((char *)v7 + v8 + 4);
    v11 = v7[1];
    if ( v9 != *v7 )
      break;
    v12 = v10 < v11;
    v13 = v10 <= v11;
    if ( v10 != v11 )
      goto LABEL_10;
    if ( !v4 )
      return 0;
  }
  v12 = v10 < v11;
  v13 = v10 <= v11;
LABEL_10:
  if ( v13 && (v12 || v9 < *v7) )
    return -1;
  else
    return 1;
}

//----- (004017DF) --------------------------------------------------------
__int64 __cdecl sub_4017DF(unsigned __int64 a1)
{
  _DWORD *v1; // ecx
  bool v2; // cf

  v2 = __CFADD__((_DWORD)a1, *v1);
  *v1 += a1;
  v1[1] += HIDWORD(a1) + v2;
  return *(_QWORD *)v1 < a1;
}
// 4017E5: variable 'v1' is possibly undefined

//----- (0040180F) --------------------------------------------------------
__int64 __cdecl sub_40180F(__int64 a1)
{
  unsigned int *v1; // ecx
  unsigned int v2; // edx
  unsigned int v3; // edi
  bool v4; // cf
  unsigned int v5; // esi
  unsigned int v6; // eax

  v2 = v1[1];
  v3 = *v1;
  v4 = *v1 < (unsigned int)a1;
  v5 = *v1 - a1;
  *v1 = v5;
  v6 = v2 - (v4 + HIDWORD(a1));
  v1[1] = v6;
  return __PAIR64__(v6, v5) > __PAIR64__(v2, v3);
}
// 401812: variable 'v1' is possibly undefined

//----- (0040184B) --------------------------------------------------------
unsigned __int64 __cdecl sub_40184B(__int64 a1, unsigned int a2, unsigned int a3)
{
  __int64 v3; // rdi

  v3 = (unsigned int)(__CFADD__((a1 * (unsigned __int64)a2) >> 32, a3 * a1)
                    + ((a3 * (unsigned __int64)(unsigned int)a1) >> 32));
  return __PAIR64__(
           HIDWORD(v3),
           (a2 * (unsigned __int64)HIDWORD(a1) + ((a2 * (unsigned __int64)(unsigned int)a1) >> 32)) >> 32)
       + (unsigned int)v3
       + a3 * (unsigned __int64)HIDWORD(a1);
}

//----- (004018A7) --------------------------------------------------------
int *__fastcall sub_4018A7(int *a1, _DWORD *a2)
{
  unsigned int v2; // esi
  unsigned int v3; // ebx
  unsigned int v4; // ecx
  bool v5; // zf
  unsigned __int64 v6; // rdi
  int v7; // ebx
  __int64 v8; // rax
  __int64 v9; // rax
  unsigned int v12; // [esp+14h] [ebp-1Ch]
  unsigned int v14; // [esp+28h] [ebp-8h]
  unsigned int v15; // [esp+2Ch] [ebp-4h]

  v2 = (a2[1] - *a2) >> 3;
  v3 = (a1[1] - *a1) >> 3;
  if ( v3 < v2 )
    v3 = (a2[1] - *a2) >> 3;
  v14 = (a2[1] - *a2) >> 3;
  v15 = v3;
  sub_4016C5(a1, v3);
  v4 = 0;
  v5 = v2 == 0;
  v6 = 0i64;
  v12 = 0;
  if ( !v5 )
  {
    do
    {
      v7 = 8 * v4;
      v8 = sub_4017DF(v6);
      v6 = sub_4017DF(*(_QWORD *)(v7 + *a2)) + v8;
      v4 = v12 + 1;
      v12 = v4;
    }
    while ( v4 < v14 );
    v3 = v15;
  }
  while ( v4 < v3 )
  {
    if ( !v6 )
      return sub_40174A(a1);
    v9 = sub_4017DF(v6);
    v4 = v12 + 1;
    v6 = v9;
    ++v12;
  }
  if ( v6 )
    sub_40171C(a1, (_DWORD *)v6, SHIDWORD(v6));
  return sub_40174A(a1);
}

//----- (004019A4) --------------------------------------------------------
int *__fastcall sub_4019A4(int *a1, _DWORD *a2)
{
  unsigned int v2; // esi
  unsigned int v3; // edi
  unsigned int v4; // ebx
  unsigned int i; // eax
  __int64 v6; // kr00_8
  __int64 v7; // rax
  unsigned int v8; // ecx
  __int64 v9; // rax
  unsigned int v11; // [esp+Ch] [ebp-20h]
  unsigned int v13; // [esp+14h] [ebp-18h]
  unsigned int v15; // [esp+24h] [ebp-8h]

  v2 = 0;
  v3 = 0;
  v4 = (a1[1] - *a1) >> 3;
  v15 = (a2[1] - *a2) >> 3;
  v13 = 0;
  if ( !v15 )
  {
    v8 = 0;
    goto LABEL_9;
  }
  for ( i = 0; ; i = v7 + v6 )
  {
    v6 = sub_40180F(__SPAIR64__(v3, i));
    v7 = sub_40180F(*(_QWORD *)(8 * v2 + *a2));
    v3 = (unsigned __int64)(v7 + v6) >> 32;
    v8 = v7 + v6;
    v11 = v7 + v6;
    v2 = v13 + 1;
    v13 = v2;
    if ( v2 >= v15 )
      break;
  }
  while ( v2 < v4 && v3 | v8 )
  {
    v9 = sub_40180F(__SPAIR64__(v3, v11));
    v3 = HIDWORD(v9);
    v8 = v9;
    ++v2;
LABEL_9:
    v11 = v8;
  }
  return sub_40174A(a1);
}

//----- (00401A95) --------------------------------------------------------
int __usercall sub_401A95@<eax>(int a1@<edx>, int a2@<ecx>, int a3)
{
  int v3; // ecx
  char v4; // bl
  char v5; // bl
  unsigned int v6; // esi
  unsigned int v7; // edi
  unsigned int v8; // ebx
  unsigned int v9; // eax
  unsigned int v10; // ecx
  int v11; // edi
  __int64 v12; // rax
  int v13; // ecx
  bool v14; // cf
  unsigned __int64 v15; // rax
  __int64 v16; // rax
  int v17; // ecx
  int *v18; // eax
  int *v19; // eax
  int v22; // [esp+18h] [ebp-54h]
  unsigned int v24; // [esp+24h] [ebp-48h]
  unsigned int v25; // [esp+28h] [ebp-44h]
  int v26; // [esp+2Ch] [ebp-40h]
  int v27[3]; // [esp+30h] [ebp-3Ch] BYREF
  int v28; // [esp+3Ch] [ebp-30h]
  int v29[3]; // [esp+40h] [ebp-2Ch] BYREF
  int v30; // [esp+4Ch] [ebp-20h]
  __int64 v31[3]; // [esp+50h] [ebp-1Ch] BYREF
  int v32; // [esp+68h] [ebp-4h]

  HIDWORD(v31[0]) = a2;
  v22 = (*(_DWORD *)(a1 + 4) - *(_DWORD *)a1) >> 3;
  v3 = *(_DWORD *)(a3 + 4) - *(_DWORD *)a3;
  v4 = *(_BYTE *)(a3 + 12);
  memset(v27, 0, sizeof(v27));
  v5 = *(_BYTE *)(a1 + 12) ^ v4;
  v3 >>= 3;
  v6 = v3 + v22 + 1;
  v24 = v3;
  v31[0] = 0i64;
  v28 = 0;
  v27[0] = 0;
  sub_4036B0(v27, v6, v31);
  LOBYTE(v28) = v5;
  v32 = 0;
  v31[0] = 0i64;
  v30 = 0;
  memset(v29, 0, sizeof(v29));
  sub_4036B0(v29, v6, v31);
  LOBYTE(v30) = 0;
  v7 = 0;
  LOBYTE(v32) = 1;
  v8 = v22;
  HIDWORD(v31[0]) = 0;
  if ( v22 )
  {
    v9 = v24;
    do
    {
      v10 = 0;
      v25 = 0;
      if ( v9 )
      {
        v11 = 8 * v7;
        v26 = v11;
        do
        {
          v12 = sub_4017DF(*(_QWORD *)(*(_DWORD *)a3 + 8 * v10) * *(_QWORD *)(v11 + *(_DWORD *)a1));
          v13 = v12;
          LODWORD(v12) = v29[0];
          v14 = __CFADD__(v13, *(_DWORD *)(v26 + v29[0] + 8));
          *(_DWORD *)(v26 + v29[0] + 8) += v13;
          *(_DWORD *)(v26 + v12 + 12) += HIDWORD(v12) + v14;
          v15 = sub_40184B(
                  *(_QWORD *)(v11 + *(_DWORD *)a1),
                  *(_DWORD *)(*(_DWORD *)a3 + 8 * v25),
                  *(_DWORD *)(*(_DWORD *)a3 + 8 * v25 + 4));
          v26 += 8;
          v16 = sub_4017DF(v15);
          v17 = v16;
          LODWORD(v16) = v29[0];
          v14 = __CFADD__(v17, *(_DWORD *)(v26 + v29[0] + 8));
          *(_DWORD *)(v26 + v29[0] + 8) += v17;
          *(_DWORD *)(v26 + v16 + 12) += HIDWORD(v16) + v14;
          v10 = v25 + 1;
          v25 = v10;
        }
        while ( v10 < v24 );
        v7 = HIDWORD(v31[0]);
        v8 = v22;
        v9 = v24;
      }
      HIDWORD(v31[0]) = ++v7;
    }
    while ( v7 < v8 );
  }
  v18 = sub_4018A7(v27, v29);
  v19 = sub_40174A(v18);
  sub_4015E7(a2, (int)v19);
  sub_40339B(v29);
  sub_40339B(v27);
  return a2;
}

//----- (00401C41) --------------------------------------------------------
int *__usercall sub_401C41@<eax>(int *a1@<edx>, int *a2@<ecx>, int *a3)
{
  unsigned int v4; // ecx
  unsigned int v5; // ebx
  int v6; // ecx
  _DWORD *v7; // eax
  int *v8; // esi
  int *v9; // ecx
  int v10; // edx
  _DWORD *v11; // eax
  _DWORD *v12; // eax
  int v13; // edx
  int v15; // [esp-4h] [ebp-C8h]
  _DWORD v16[4]; // [esp+10h] [ebp-B4h] BYREF
  void *v17[6]; // [esp+20h] [ebp-A4h] BYREF
  int v18; // [esp+38h] [ebp-8Ch]
  int *v19; // [esp+3Ch] [ebp-88h]
  _DWORD v20[4]; // [esp+40h] [ebp-84h] BYREF
  _DWORD v21[4]; // [esp+50h] [ebp-74h] BYREF
  _DWORD v22[4]; // [esp+60h] [ebp-64h] BYREF
  int v23[4]; // [esp+70h] [ebp-54h] BYREF
  char v24[16]; // [esp+80h] [ebp-44h] BYREF
  int v25[4]; // [esp+90h] [ebp-34h] BYREF
  char v26[32]; // [esp+A0h] [ebp-24h] BYREF
  int v27; // [esp+C0h] [ebp-4h]

  v19 = a2;
  v17[5] = a2;
  v27 = 0;
  v17[4] = a2;
  v18 = 0;
  v4 = (a1[1] - *a1) >> 3;
  if ( v4 < (a3[1] - *a3) >> 3 )
    v4 = (a3[1] - *a3) >> 3;
  v5 = (v4 & 1) + (v4 >> 1);
  `eh vector constructor iterator'(v23, 0x10u, 2u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  v27 = 1;
  `eh vector constructor iterator'(v25, 0x10u, 2u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  LOBYTE(v27) = 2;
  sub_4020C6(v23, a1, v6, v5);
  sub_4020C6(v25, a3, v15, v5);
  v5 <<= 6;
  memset(v21, 0, sizeof(v21));
  sub_402412(v21, v25);
  LOBYTE(v27) = 3;
  memset(v20, 0, sizeof(v20));
  sub_402398((int)v23, v16, (int)v24);
  LOBYTE(v27) = 4;
  v7 = sub_402398((int)v25, v17, (int)v26);
  LOBYTE(v27) = 5;
  sub_402412(v20, v7);
  sub_40339B(v17);
  LOBYTE(v27) = 8;
  sub_40339B(v16);
  memset(v22, 0, sizeof(v22));
  sub_402412(v22, v26);
  LOBYTE(v27) = 9;
  v8 = v19;
  v9 = v19;
  *v19 = 0;
  v9[1] = 0;
  v9[2] = 0;
  v9[3] = 0;
  sub_4015E7((int)v9, (int)v22);
  v18 = 1;
  sub_401F2F(v8, v10, v5);
  v11 = sub_4023D2((int)v20, v17, (int)v22);
  LOBYTE(v27) = 10;
  v12 = sub_4023D2((int)v11, v16, (int)v21);
  LOBYTE(v27) = 11;
  sub_4022E4((int)v8, (int)v12);
  sub_40339B(v16);
  LOBYTE(v27) = 9;
  sub_40339B(v17);
  sub_401F2F(v8, v13, v5);
  sub_4022E4((int)v8, (int)v21);
  sub_40339B(v22);
  sub_40339B(v20);
  sub_40339B(v21);
  LOBYTE(v27) = 1;
  `eh vector destructor iterator'(v25, 0x10u, 2u, sub_40245D);
  LOBYTE(v27) = 0;
  `eh vector destructor iterator'(v23, 0x10u, 2u, sub_40245D);
  return v8;
}
// 401CD0: variable 'v6' is possibly undefined
// 401CDE: variable 'v15' is possibly undefined
// 401DAD: variable 'v10' is possibly undefined
// 401E07: variable 'v13' is possibly undefined
// 402412: using guessed type _DWORD __stdcall sub_402412(_DWORD, _DWORD);
// 401C41: using guessed type int var_54[4];
// 401C41: using guessed type int var_34[4];
// 401C41: using guessed type _DWORD var_74[4];
// 401C41: using guessed type _DWORD var_84[4];
// 401C41: using guessed type char var_44[16];
// 401C41: using guessed type _DWORD var_B4[4];
// 401C41: using guessed type _DWORD var_64[4];

//----- (00401E63) --------------------------------------------------------
int __usercall sub_401E63@<eax>(int *a1@<edx>, int a2@<ecx>, char a3, _DWORD *a4, char a5)
{
  int *v7; // eax
  char *v8; // eax
  char *v9; // ecx
  int v10; // eax
  char v12[20]; // [esp+10h] [ebp-4Ch] BYREF
  char v13[16]; // [esp+24h] [ebp-38h] BYREF
  int v14; // [esp+34h] [ebp-28h]
  _DWORD *v15; // [esp+38h] [ebp-24h]
  int v16[7]; // [esp+3Ch] [ebp-20h] BYREF
  int v17; // [esp+58h] [ebp-4h]

  v14 = a2;
  v15 = a4;
  if ( a3 == a5 )
  {
    memset(v16, 0, 16);
    sub_4015E7((int)v16, (int)a1);
    v17 = 0;
    v7 = sub_4018A7(v16, v15);
    sub_4015E7((int)v13, (int)v7);
    sub_40339B(v16);
    v17 = 1;
    v13[12] = a3;
    v8 = v13;
  }
  else
  {
    if ( sub_401774(a1, a4) < 0 )
    {
      v10 = sub_40213F((int)a4, (int)v12, a1);
      v17 = 3;
      *(_BYTE *)(v10 + 12) = a5;
      sub_4015E7(a2, v10);
      v9 = v12;
      goto LABEL_7;
    }
    v8 = (char *)sub_40213F((int)a1, (int)v13, a4);
    v17 = 2;
    v8[12] = a3;
  }
  sub_4015E7(a2, (int)v8);
  v9 = v13;
LABEL_7:
  sub_40339B(v9);
  return a2;
}
// 401E63: using guessed type int var_20[7];

//----- (00401F2F) --------------------------------------------------------
int *__fastcall sub_401F2F(int *a1, int a2, unsigned int a3)
{
  int *v3; // esi
  unsigned int v5; // ebx
  BOOL v6; // eax
  unsigned int v7; // edi
  int v8; // ecx
  int v9; // edx
  int v10; // eax
  unsigned int v11; // ecx
  char v12; // di
  int v13; // ecx
  int v14; // ebx
  __int64 v15; // rax
  int v16; // esi
  int v17; // edi
  int v18; // edi
  __int64 v19; // rax
  unsigned int v20; // ecx
  _DWORD *v21; // edi
  unsigned int v22; // eax
  int v23; // eax
  unsigned int v24; // [esp+14h] [ebp-28h]
  int v25; // [esp+1Ch] [ebp-20h]
  int v26; // [esp+20h] [ebp-1Ch]
  int v27; // [esp+24h] [ebp-18h]
  int v28; // [esp+24h] [ebp-18h]
  unsigned int v29; // [esp+28h] [ebp-14h]
  int v30; // [esp+2Ch] [ebp-10h]
  int v31; // [esp+30h] [ebp-Ch]
  int v33; // [esp+44h] [ebp+8h]

  v3 = a1;
  if ( !a3 )
    return a1;
  v5 = a3 >> 6;
  v24 = v5;
  v6 = (a3 & 0x3F) != 0;
  v33 = a3 & 0x3F;
  v27 = ((a1[1] - *a1) >> 3) + v6;
  v7 = v27 + v5;
  sub_4016C5(a1, v27 + v5);
  if ( v33 )
  {
    v11 = v7 - 1;
    v29 = v7 - 1;
    if ( v7 - 1 <= v5 )
    {
      v19 = 0i64;
    }
    else
    {
      v12 = 64 - v33;
      v13 = 8 * (v11 - v5);
      v30 = 0;
      v28 = v13;
      v31 = 0;
      do
      {
        v14 = *v3;
        v25 = *(_DWORD *)(v13 + *v3 - 4);
        v26 = *(_DWORD *)(v13 + *v3 - 8);
        v15 = *(_QWORD *)(v13 + *v3 - 8) >> v12;
        v16 = v15;
        LODWORD(v15) = v31;
        v17 = HIDWORD(v15);
        HIDWORD(v15) = v30;
        v19 = v15 << v33;
        v18 = HIDWORD(v19) | v17;
        HIDWORD(v19) = v25;
        v31 = v26;
        *(_DWORD *)(v14 + 8 * v29) = v19 | v16;
        v13 = v28 - 8;
        v3 = a1;
        *(_DWORD *)(v14 + 8 * v29 + 4) = v18;
        v5 = v24;
        v12 = 64 - v33;
        v30 = v25;
        --v29;
        v28 -= 8;
      }
      while ( v29 > v24 );
      LODWORD(v19) = v26;
    }
    *(_QWORD *)(*v3 + 8 * v5) = v19 << v33;
  }
  else if ( v7 > v5 )
  {
    v8 = 8 * v27;
    do
    {
      v9 = *v3;
      --v7;
      v10 = *(_DWORD *)(v8 - 8 + *v3);
      *(_DWORD *)(v9 + 8 * v7 + 4) = *(_DWORD *)(v8 - 8 + v9 + 4);
      v8 -= 8;
      *(_DWORD *)(v9 + 8 * v7) = v10;
    }
    while ( v7 > v5 );
  }
  v20 = 0;
  if ( v5 )
  {
    if ( v5 < 2 )
      goto LABEL_25;
    v21 = (_DWORD *)*v3;
    if ( *v3 <= (unsigned int)v3 && *v3 + 8 * (v5 - 1) >= (unsigned int)v3 )
      goto LABEL_25;
    v22 = v5 & 0xFFFFFFFE;
    do
      v20 += 2;
    while ( v20 < v22 );
    *v21 = 0;
    v21[1] = 0;
    qmemcpy(v21 + 2, v21, 4 * ((16 * (v22 >> 1) - 8) >> 2));
    v3 = a1;
    if ( v20 < v5 )
    {
LABEL_25:
      do
      {
        v23 = *v3;
        *(_DWORD *)(v23 + 8 * v20) = 0;
        *(_DWORD *)(v23 + 8 * v20++ + 4) = 0;
      }
      while ( v20 < v5 );
    }
  }
  return sub_40174A(v3);
}

//----- (004020C6) --------------------------------------------------------
int __usercall sub_4020C6@<eax>(int *a1@<edx>, int *a2@<ecx>, int a3, unsigned int a4)
{
  unsigned int v4; // edi
  unsigned int v6; // ebx
  int v7; // edx
  int v8; // ecx
  int v9; // eax
  int v10; // edx
  int *v11; // eax
  int result; // eax
  int v14; // [esp+10h] [ebp-8h]
  unsigned int v15; // [esp+14h] [ebp-4h]

  v4 = a4;
  v6 = 0;
  v14 = 2;
  do
  {
    sub_4016C5(a1, v4);
    v15 = 0;
    if ( v4 )
    {
      do
      {
        v7 = *a2;
        if ( v6 >= (a2[1] - *a2) >> 3 )
          break;
        v8 = *(_DWORD *)(v7 + 8 * v6);
        v9 = *a1;
        v10 = *(_DWORD *)(v7 + 8 * v6++ + 4);
        *(_DWORD *)(v9 + 8 * v15) = v8;
        v4 = a4;
        *(_DWORD *)(v9 + 8 * v15++ + 4) = v10;
      }
      while ( v15 < a4 );
    }
    v11 = sub_40174A(a1);
    result = sub_40162C((int)a1, (int)v11);
    a1 += 4;
    --v14;
  }
  while ( v14 );
  return result;
}

//----- (0040213F) --------------------------------------------------------
int __usercall sub_40213F@<eax>(int a1@<edx>, int a2@<ecx>, _DWORD *a3)
{
  int *v4; // eax
  int v6[9]; // [esp+18h] [ebp-24h] BYREF

  memset(v6, 0, 16);
  sub_4015E7((int)v6, a1);
  v6[8] = 0;
  v4 = sub_4019A4(v6, a3);
  sub_4015E7(a2, (int)v4);
  sub_40339B(v6);
  return a2;
}

//----- (0040218E) --------------------------------------------------------
int *__thiscall sub_40218E(int *this, __int64 a2)
{
  unsigned int v3; // edx
  int v4; // ecx
  unsigned int v5; // edi
  unsigned int v6; // ebx
  __int64 v7; // rax
  unsigned __int64 v8; // kr08_8
  unsigned int v10; // [esp+Ch] [ebp-10h]
  int v11; // [esp+10h] [ebp-Ch]
  __int64 v12; // [esp+14h] [ebp-8h]

  v3 = 0;
  v10 = 0;
  v4 = *this;
  v11 = v4;
  if ( (this[1] - v4) >> 3 )
  {
    v5 = 0;
    v6 = 0;
    do
    {
      v12 = *(_QWORD *)(v4 + 8 * v3) * a2;
      v7 = sub_4017DF(__PAIR64__(v5, v6));
      v8 = sub_40184B(*(_QWORD *)(v11 + 8 * v10), a2, HIDWORD(a2)) + v7;
      v5 = HIDWORD(v8);
      v6 = v8;
      *(_QWORD *)(v11 + 8 * v10) = v12;
      v4 = *this;
      v3 = v10 + 1;
      v10 = v3;
      v11 = *this;
    }
    while ( v3 < (this[1] - *this) >> 3 );
    if ( v8 )
      sub_40171C(this, (_DWORD *)v8, SHIDWORD(v8));
  }
  return sub_40174A(this);
}

//----- (00402266) --------------------------------------------------------
int *__thiscall sub_402266(int *this, unsigned int a2, int a3, int a4)
{
  __int64 v5; // rax
  int v8; // [esp+Ch] [ebp-4h]

  if ( !((this[1] - *this) >> 3) )
    sub_4016C5(this, 1u);
  HIDWORD(v5) = a3;
  v8 = 0;
  if ( (this[1] - *this) >> 3 )
  {
    while ( HIDWORD(v5) | a2 )
    {
      v5 = sub_4017DF(__PAIR64__(HIDWORD(v5), a2));
      a2 = v5;
      if ( ++v8 >= (unsigned int)((this[1] - *this) >> 3) )
        goto LABEL_6;
    }
  }
  else
  {
LABEL_6:
    if ( HIDWORD(v5) | a2 )
      sub_40171C(this, (_DWORD *)a2, SHIDWORD(v5));
  }
  return sub_40174A(this);
}

//----- (004022E4) --------------------------------------------------------
int __thiscall sub_4022E4(int this, int a2)
{
  int v3; // esi
  _DWORD v5[9]; // [esp+10h] [ebp-24h] BYREF

  memset(v5, 0, 16);
  sub_401E63((int *)this, (int)v5, *(_BYTE *)(this + 12), (_DWORD *)a2, *(_BYTE *)(a2 + 12));
  v5[8] = 0;
  v3 = sub_40162C(this, (int)v5);
  sub_40339B(v5);
  return v3;
}

//----- (00402339) --------------------------------------------------------
bool __thiscall sub_402339(int this, int a2)
{
  int v2; // eax
  char v3; // al
  char v4; // bl

  if ( ((*(_DWORD *)(this + 4) - *(_DWORD *)this) & 0xFFFFFFF8) != 0
    || ((*(_DWORD *)(a2 + 4) - *(_DWORD *)a2) & 0xFFFFFFF8) != 0 )
  {
    v3 = *(_BYTE *)(a2 + 12);
    v4 = *(_BYTE *)(this + 12);
    if ( v4 )
    {
      if ( v3 )
      {
        v2 = -sub_401774((int *)this, (int *)a2);
        return v2 == 0;
      }
    }
    else if ( !v3 )
    {
      v2 = sub_401774((int *)this, (int *)a2);
      return v2 == 0;
    }
    if ( !v4 || v3 )
      v2 = 1;
    else
      v2 = -1;
  }
  else
  {
    v2 = 0;
  }
  return v2 == 0;
}

//----- (00402398) --------------------------------------------------------
_DWORD *__thiscall sub_402398(int this, _DWORD *a2, int a3)
{
  *a2 = 0;
  a2[1] = 0;
  a2[2] = 0;
  a2[3] = 0;
  sub_401E63((int *)this, (int)a2, *(_BYTE *)(this + 12), (_DWORD *)a3, *(_BYTE *)(a3 + 12));
  return a2;
}

//----- (004023D2) --------------------------------------------------------
_DWORD *__thiscall sub_4023D2(int this, _DWORD *a2, int a3)
{
  *a2 = 0;
  a2[1] = 0;
  a2[2] = 0;
  a2[3] = 0;
  sub_401E63((int *)this, (int)a2, *(_BYTE *)(this + 12), (_DWORD *)a3, *(_BYTE *)(a3 + 12) == 0);
  return a2;
}

//----- (00402412) --------------------------------------------------------
int *__thiscall sub_402412(int *this, int *a2, int *a3)
{
  int *v3; // esi

  if ( (unsigned int)((this[1] - *this) >> 3) <= 0x14 || (unsigned int)((a3[1] - *a3) >> 3) <= 0x14 )
  {
    v3 = a2;
    sub_401A95((int)this, (int)a2, (int)a3);
  }
  else
  {
    v3 = a2;
    sub_401C41(this, a2, a3);
  }
  return v3;
}

//----- (00402462) --------------------------------------------------------
void __thiscall sub_402462(_DWORD **this)
{
  *this = &off_407324;
  `eh vector destructor iterator'(this + 55, 0x10u, 3u, sub_40245D);
  `eh vector destructor iterator'(this + 43, 0x10u, 3u, sub_40245D);
  `eh vector destructor iterator'(this + 7, 0x10u, 9u, sub_40245D);
  sub_4033BD(this + 1);
}
// 407324: using guessed type int (__stdcall *off_407324)(int, int, int);

//----- (004024DF) --------------------------------------------------------
int __thiscall sub_4024DF(_DWORD *this, int a2, int a3, int a4, int a5, int a6, unsigned int a7)
{
  int v7; // ebx
  _DWORD **v8; // edi
  int *v9; // eax
  int *v10; // ecx
  char *v11; // edi
  char v12; // bl
  int v13; // esi
  int v14; // eax
  unsigned int v15; // edx
  int v16; // ecx
  _DWORD *v17; // eax
  signed int v18; // esi
  int v19; // edi
  int v20; // ebx
  int v21; // ecx
  char *v22; // eax
  int v23; // eax
  _DWORD *v25[6]; // [esp+14h] [ebp-100h] BYREF
  char *v26; // [esp+2Ch] [ebp-E8h]
  _DWORD *v27; // [esp+30h] [ebp-E4h]
  _DWORD *v28; // [esp+34h] [ebp-E0h]
  int *v29; // [esp+38h] [ebp-DCh]
  int v30[44]; // [esp+3Ch] [ebp-D8h] BYREF
  _DWORD *v31[9]; // [esp+ECh] [ebp-28h] BYREF
  int v32; // [esp+110h] [ebp-4h]

  v7 = (int)this;
  v27 = this;
  v32 = 0;
  v8 = (_DWORD **)(this + 1);
  *this = &off_407324;
  v28 = this + 1;
  this[1] = 0;
  this[5] = 0;
  this[6] = 15;
  *((_BYTE *)this + 4) = 0;
  `eh vector constructor iterator'(this + 7, 0x10u, 9u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  `eh vector constructor iterator'((void *)(v7 + 172), 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  `eh vector constructor iterator'((void *)(v7 + 220), 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  LOBYTE(v32) = 5;
  memset(v30, 0, sizeof(v30));
  v30[0] = (int)&unk_40731C;
  v30[4] = (int)&unk_4072CC;
  std::ios::ios(&v30[26]);
  LOBYTE(v32) = 6;
  v29 = (int *)4;
  std::iostream::basic_iostream<char>(v30, &v30[6], 0);
  v32 = 7;
  *(int *)((char *)v30 + *(_DWORD *)(v30[0] + 4)) = (int)&off_407310;
  *(int *)((char *)&v30[-1] + *(_DWORD *)(v30[0] + 4)) = *(_DWORD *)(v30[0] + 4) - 104;
  sub_4034FB(&v30[6], 3);
  LOBYTE(v32) = 8;
  v9 = &a2;
  v29 = &a2;
  if ( a7 < 0x10 )
  {
    v10 = &a2;
  }
  else
  {
    v9 = (int *)a2;
    v10 = (int *)a2;
    v29 = (int *)a2;
  }
  v26 = (char *)v10 + a6;
  if ( v9 != (int *)((char *)v10 + a6) )
  {
    v11 = (char *)v29;
    do
    {
      v12 = *v11;
      v13 = std::ostream::operator<<(&v30[4], sub_401422);
      *(_BYTE *)(*(_DWORD *)(*(_DWORD *)v13 + 4) + v13 + 64) = 48;
      v14 = std::setw(&v25[2], 2, 0);
      (*(void (__cdecl **)(int, _DWORD, _DWORD))v14)(
        v13 + *(_DWORD *)(*(_DWORD *)v13 + 4),
        *(_DWORD *)(v14 + 8),
        *(_DWORD *)(v14 + 12));
      std::ostream::operator<<(v13, v12);
      ++v11;
    }
    while ( v11 != v26 );
    v8 = (_DWORD **)v28;
    v7 = (int)v27;
  }
  sub_403466((int)&v30[6], v25);
  if ( v8 != v25 )
  {
    v15 = (unsigned int)v8[5];
    if ( v15 >= 0x10 )
      sub_403795(*v8, v15 + 1);
    v8[4] = 0;
    *(_BYTE *)v8 = 0;
    v8[5] = (_DWORD *)15;
    qmemcpy(v8, v25, 0x18u);
    v25[4] = 0;
    v25[5] = (_DWORD *)15;
    LOBYTE(v25[0]) = 0;
    LOBYTE(v32) = 8;
  }
  sub_4033BD(v25);
  v17 = (_DWORD *)(v7 + 4);
  v18 = 0;
  v19 = v7 + 220;
  v28 = (_DWORD *)(v7 + 4);
  v20 = 6;
  do
  {
    sub_40354F(v31, v17, v18, v16, v16);
    v20 |= 1u;
    LOBYTE(v32) = 11;
    v22 = (char *)v31;
    if ( v31[5] >= (_DWORD *)0x10 )
      v22 = (char *)v31[0];
    v23 = sub_401656((int)&v25[2], v22, 0x10ui64, v21);
    LOBYTE(v32) = 12;
    sub_40162C(v19, v23);
    sub_40339B(&v25[2]);
    LOBYTE(v32) = 8;
    sub_4033BD(v31);
    v17 = v28;
    v18 += 20;
    v19 += 16;
  }
  while ( v18 < 60 );
  std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(&v30[26]);
  std::ios::~ios<char,std::char_traits<char>>(&v30[26]);
  sub_4033BD((_DWORD **)&a2);
  return (int)v27;
}
// 40272F: variable 'v16' is possibly undefined
// 402752: variable 'v21' is possibly undefined
// 40336B: using guessed type int __thiscall std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(_DWORD);
// 407038: using guessed type int __thiscall std::ios::ios(_DWORD);
// 407040: using guessed type int __thiscall std::iostream::basic_iostream<char>(_DWORD, _DWORD, _DWORD);
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 407074: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 407078: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4070C8: using guessed type int __cdecl std::setw(_DWORD, _DWORD, _DWORD);
// 407310: using guessed type int (__stdcall *off_407310)(int);
// 407324: using guessed type int (__stdcall *off_407324)(int, int, int);

//----- (004027C6) --------------------------------------------------------
int __thiscall sub_4027C6(void *this, int a2, int a3, unsigned int *a4)
{
  int v4; // edi
  unsigned int v5; // eax
  int v6; // ecx
  char *v7; // eax
  int v9; // [esp-4h] [ebp-F4h]
  _DWORD v10[4]; // [esp+10h] [ebp-E0h] BYREF
  _DWORD *v11[7]; // [esp+20h] [ebp-D0h] BYREF
  void *v12; // [esp+3Ch] [ebp-B4h]
  int v13; // [esp+40h] [ebp-B0h]
  int v14; // [esp+44h] [ebp-ACh]
  _DWORD v15[41]; // [esp+48h] [ebp-A8h] BYREF
  int v16; // [esp+ECh] [ebp-4h]

  v12 = this;
  v14 = a2;
  v13 = a3;
  memset(v15, 0, 0x98u);
  sub_402E58(v15, v9);
  v16 = 0;
  v4 = 24;
  do
  {
    v5 = -1775737769 - 1224826265 * *a4;
    *a4 = v5;
    std::ostream::operator<<(v15, v5 % 0xA);
    --v4;
  }
  while ( v4 );
  sub_403466((int)&v15[1], v11);
  LOBYTE(v16) = 1;
  v7 = (char *)v11;
  if ( v11[5] >= (_DWORD *)0x10 )
    v7 = (char *)v11[0];
  sub_401656((int)v10, v7, 0xAui64, v6);
  LOBYTE(v16) = 2;
  sub_40162C((int)v12 + 48 * v14 + 16 * v13 + 28, (int)v10);
  sub_40339B(v10);
  sub_4033BD(v11);
  sub_402E28(&v15[20]);
  return std::ios::~ios<char,std::char_traits<char>>(&v15[20]);
}
// 40280C: variable 'v9' is possibly undefined
// 402876: variable 'v6' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 40707C: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4027C6: using guessed type _DWORD var_E0[4];

//----- (004028E9) --------------------------------------------------------
int __thiscall sub_4028E9(void *this, int a2, __m128i **a3, char a4)
{
  __m128i *v4; // ebx
  __m128i *i; // edi
  int v6; // esi
  int v7; // eax
  int v8; // ecx
  char *v9; // eax
  int v10; // eax
  int v11; // esi
  int v12; // eax
  int v14; // [esp-4h] [ebp-F0h]
  _DWORD v15[4]; // [esp+14h] [ebp-D8h] BYREF
  _DWORD *v16[2]; // [esp+24h] [ebp-C8h] BYREF
  _DWORD v17[4]; // [esp+2Ch] [ebp-C0h] BYREF
  void *v18; // [esp+3Ch] [ebp-B0h]
  int v19; // [esp+40h] [ebp-ACh]
  _DWORD v20[41]; // [esp+44h] [ebp-A8h] BYREF
  int v21; // [esp+E8h] [ebp-4h]

  v18 = this;
  v19 = a2;
  memset(v20, 0, 0x98u);
  sub_402E58(v20, v14);
  v21 = 0;
  sub_404F50(*a3, a3[1]);
  v4 = a3[1];
  for ( i = *a3; i != v4; i = (__m128i *)((char *)i + 1) )
  {
    v6 = std::ostream::operator<<(v20, sub_401422);
    *(_BYTE *)(*(_DWORD *)(*(_DWORD *)v6 + 4) + v6 + 64) = 48;
    v7 = std::setw(v17, 2, 0);
    (*(void (__cdecl **)(int, _DWORD, _DWORD))v7)(
      v6 + *(_DWORD *)(*(_DWORD *)v6 + 4),
      *(_DWORD *)(v7 + 8),
      *(_DWORD *)(v7 + 12));
    std::ostream::operator<<(v6, i->m128i_u8[0]);
  }
  sub_403466((int)&v20[1], v16);
  LOBYTE(v21) = 1;
  v9 = (char *)v16;
  if ( v17[3] >= 0x10u )
    v9 = (char *)v16[0];
  v10 = sub_401656((int)v15, v9, 0x10ui64, v8);
  v11 = (int)v18 + 16 * v19 + 172;
  LOBYTE(v21) = 2;
  sub_40162C(v11, v10);
  sub_40339B(v15);
  LOBYTE(v21) = 0;
  sub_4033BD(v16);
  if ( a4 )
  {
    v12 = sub_4015E7((int)v17, v11);
    LOBYTE(v21) = 3;
    *(_BYTE *)(v12 + 12) = *(_BYTE *)(v11 + 12) == 0;
    sub_4015E7((int)v15, v12);
    sub_40339B(v17);
    LOBYTE(v21) = 4;
    sub_40162C(v11, (int)v15);
    sub_40339B(v15);
  }
  sub_402E28(&v20[20]);
  return std::ios::~ios<char,std::char_traits<char>>(&v20[20]);
}
// 402926: variable 'v14' is possibly undefined
// 4029CB: variable 'v8' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 407074: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 407078: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 4070C8: using guessed type int __cdecl std::setw(_DWORD, _DWORD, _DWORD);
// 4028E9: using guessed type _DWORD var_D8[4];

//----- (00402A7A) --------------------------------------------------------
int __thiscall sub_402A7A(void *this)
{
  unsigned int v1; // edi
  int v2; // esi
  int v3; // ebx
  int v4; // ecx
  char *v5; // eax
  int v6; // esi
  int result; // eax
  bool v8; // zf
  int v9; // [esp-4h] [ebp-F0h]
  _DWORD v10[4]; // [esp+10h] [ebp-DCh] BYREF
  _DWORD *v11[6]; // [esp+20h] [ebp-CCh] BYREF
  int v12; // [esp+38h] [ebp-B4h]
  int v13; // [esp+3Ch] [ebp-B0h]
  int v14; // [esp+40h] [ebp-ACh]
  _DWORD v15[41]; // [esp+44h] [ebp-A8h] BYREF
  int v16; // [esp+E8h] [ebp-4h]

  v1 = 4919;
  v14 = 3;
  v2 = (int)this + 28;
  do
  {
    v13 = v2;
    v12 = 3;
    do
    {
      memset(v15, 0, 0x98u);
      sub_402E58(v15, v9);
      v16 = 0;
      v3 = 24;
      do
      {
        v1 = -1775737769 - 1224826265 * v1;
        std::ostream::operator<<(v15, v1 % 0xA);
        --v3;
      }
      while ( v3 );
      sub_403466((int)&v15[1], v11);
      LOBYTE(v16) = 1;
      v5 = (char *)v11;
      if ( v11[5] >= (_DWORD *)0x10 )
        v5 = (char *)v11[0];
      sub_401656((int)v10, v5, 0xAui64, v4);
      v6 = v13;
      LOBYTE(v16) = 2;
      sub_40162C(v13, (int)v10);
      sub_40339B(v10);
      sub_4033BD(v11);
      v16 = -1;
      sub_402E28(&v15[20]);
      result = std::ios::~ios<char,std::char_traits<char>>(&v15[20]);
      v2 = v6 + 16;
      v8 = v12-- == 1;
      v13 = v2;
    }
    while ( !v8 );
    --v14;
  }
  while ( v14 );
  return result;
}
// 402AC5: variable 'v9' is possibly undefined
// 402B30: variable 'v4' is possibly undefined
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);
// 40707C: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 402A7A: using guessed type _DWORD var_DC[4];

//----- (00402BA1) --------------------------------------------------------
bool __thiscall sub_402BA1(int *this)
{
  int *v1; // edi
  int *v2; // esi
  int *v3; // ebx
  int *v4; // eax
  _DWORD *v5; // esi
  int *v6; // ecx
  int *v7; // eax
  _DWORD *v8; // eax
  int *v9; // esi
  int *v10; // eax
  _DWORD *v11; // esi
  int *v12; // eax
  _DWORD *v13; // eax
  int *v14; // esi
  int *v15; // eax
  _DWORD *v16; // esi
  int *v17; // ebx
  int *v18; // eax
  _DWORD *v19; // eax
  bool v20; // bl
  int v22[4]; // [esp+10h] [ebp-94h] BYREF
  int v23[4]; // [esp+20h] [ebp-84h] BYREF
  _DWORD v24[4]; // [esp+30h] [ebp-74h] BYREF
  int v25[4]; // [esp+40h] [ebp-64h] BYREF
  int v26[4]; // [esp+50h] [ebp-54h] BYREF
  int *v27; // [esp+60h] [ebp-44h]
  char v28[16]; // [esp+64h] [ebp-40h] BYREF
  char v29[16]; // [esp+74h] [ebp-30h] BYREF
  char v30[28]; // [esp+84h] [ebp-20h] BYREF
  int v31; // [esp+A0h] [ebp-4h]

  v1 = this;
  v27 = this;
  `eh vector constructor iterator'(v28, 0x10u, 3u, (void (__thiscall *)(void *))sub_4015D7, sub_40245D);
  v31 = 0;
  v2 = sub_402412(v1 + 7, v22, v1 + 55);
  v3 = v1 + 59;
  LOBYTE(v31) = 1;
  v4 = sub_402412(v1 + 11, v23, v1 + 59);
  LOBYTE(v31) = 2;
  v5 = sub_402398((int)v2, v24, (int)v4);
  v6 = v1 + 15;
  LOBYTE(v31) = 3;
  v1 += 63;
  v7 = sub_402412(v6, v25, v1);
  LOBYTE(v31) = 4;
  v8 = sub_4023D2((int)v5, v26, (int)v7);
  LOBYTE(v31) = 5;
  sub_40162C((int)v28, (int)v8);
  sub_40339B(v26);
  sub_40339B(v25);
  sub_40339B(v24);
  sub_40339B(v23);
  LOBYTE(v31) = 0;
  sub_40339B(v22);
  v9 = sub_402412(v27 + 19, v26, v27 + 55);
  LOBYTE(v31) = 6;
  v10 = sub_402412(v27 + 23, v25, v3);
  LOBYTE(v31) = 7;
  v11 = sub_402398((int)v9, v24, (int)v10);
  LOBYTE(v31) = 8;
  v12 = sub_402412(v27 + 27, v23, v1);
  LOBYTE(v31) = 9;
  v13 = sub_402398((int)v11, v22, (int)v12);
  LOBYTE(v31) = 10;
  sub_40162C((int)v29, (int)v13);
  sub_40339B(v22);
  sub_40339B(v23);
  sub_40339B(v24);
  sub_40339B(v25);
  LOBYTE(v31) = 0;
  sub_40339B(v26);
  v14 = sub_402412(v27 + 31, v26, v27 + 55);
  LOBYTE(v31) = 11;
  v15 = sub_402412(v27 + 35, v25, v3);
  LOBYTE(v31) = 12;
  v16 = sub_4023D2((int)v14, v24, (int)v15);
  v17 = v27;
  LOBYTE(v31) = 13;
  v18 = sub_402412(v27 + 39, v23, v1);
  LOBYTE(v31) = 14;
  v19 = sub_4023D2((int)v16, v22, (int)v18);
  LOBYTE(v31) = 15;
  sub_40162C((int)v30, (int)v19);
  sub_40339B(v22);
  sub_40339B(v23);
  sub_40339B(v24);
  sub_40339B(v25);
  sub_40339B(v26);
  v20 = sub_402339((int)v28, (int)(v17 + 43))
     && sub_402339((int)v29, (int)(v17 + 47))
     && sub_402339((int)v30, (int)(v17 + 51));
  v31 = -1;
  `eh vector destructor iterator'(v28, 0x10u, 3u, sub_40245D);
  return v20;
}
// 402BA1: using guessed type int var_94[4];
// 402BA1: using guessed type int var_84[4];
// 402BA1: using guessed type _DWORD var_74[4];
// 402BA1: using guessed type int var_64[4];
// 402BA1: using guessed type int var_54[4];

//----- (00402E28) --------------------------------------------------------
int __thiscall sub_402E28(_DWORD *this)
{
  *(_DWORD *)((char *)this + *(_DWORD *)(*(this - 20) + 4) - 80) = &off_4072C8;
  *(_DWORD *)((char *)this + *(_DWORD *)(*(this - 20) + 4) - 84) = *(_DWORD *)(*(this - 20) + 4) - 80;
  sub_403304((_BYTE *)this - 76);
  return std::ostream::~ostream<char,std::char_traits<char>>(this - 18);
}
// 407070: using guessed type int __thiscall std::ostream::~ostream<char,std::char_traits<char>>(_DWORD);
// 4072C8: using guessed type int (__stdcall *off_4072C8)(int);

//----- (00402E58) --------------------------------------------------------
_DWORD *__thiscall sub_402E58(_DWORD *this, int a2)
{
  *this = &unk_407314;
  std::ios::ios(this + 20);
  std::ostream::ostream(this, this + 1, 0, 0);
  *(_DWORD *)((char *)this + *(_DWORD *)(*this + 4)) = &off_4072C8;
  *(_DWORD *)((char *)this + *(_DWORD *)(*this + 4) - 4) = *(_DWORD *)(*this + 4) - 80;
  sub_4034FB(this + 1, 2);
  return this;
}
// 407038: using guessed type int __thiscall std::ios::ios(_DWORD);
// 40703C: using guessed type int __thiscall std::ostream::ostream(_DWORD, _DWORD, _DWORD, _DWORD);
// 4072C8: using guessed type int (__stdcall *off_4072C8)(int);

//----- (00402EC4) --------------------------------------------------------
unsigned int *__thiscall sub_402EC4(int this, unsigned int *a2, __int64 a3, __int64 a4, int a5, int a6, char a7)
{
  unsigned int v7; // ebx
  unsigned int *v8; // esi
  unsigned int v10; // ecx
  char v11; // dl
  int v12; // edx
  int v14; // [esp+Ch] [ebp-18h]
  int v15; // [esp+18h] [ebp-Ch]
  unsigned int v16; // [esp+1Ch] [ebp-8h]
  int v17; // [esp+20h] [ebp-4h]

  v7 = a4 + a3;
  v8 = a2;
  v16 = (unsigned __int64)(a4 + a3) >> 32;
  v15 = **(_DWORD **)(this + 28);
  if ( (*(_BYTE *)(this + 60) & 2) != 0 )
  {
    v10 = 0;
  }
  else
  {
    v10 = **(_DWORD **)(this + 32);
    if ( v10 && *(_DWORD *)(this + 56) < v10 )
      *(_DWORD *)(this + 56) = v10;
  }
  v14 = *(_DWORD *)(this + 56);
  v17 = **(_DWORD **)(this + 12);
  if ( __PAIR64__(v16, v7) > v14 - v17 || (v11 = a7, v16 | v7) && ((a7 & 1) != 0 && !v15 || (a7 & 2) != 0 && !v10) )
  {
    *a2 = -1;
    a2[1] = -1;
  }
  else
  {
    if ( (a7 & 1) != 0 && v15 )
    {
      **(_DWORD **)(this + 12) = v17;
      **(_DWORD **)(this + 28) = v7 + v17;
      v8 = a2;
      **(_DWORD **)(this + 44) = v14 - (v7 + v17);
      v11 = a7;
    }
    if ( (v11 & 2) != 0 && v10 )
    {
      v8 = a2;
      v12 = **(_DWORD **)(this + 48) + **(_DWORD **)(this + 32);
      **(_DWORD **)(this + 16) = v17;
      **(_DWORD **)(this + 32) = v7 + v17;
      **(_DWORD **)(this + 48) = v12 - (v7 + v17);
    }
    *v8 = v7;
    v8[1] = v16;
  }
  v8[2] = 0;
  v8[3] = 0;
  v8[4] = 0;
  v8[5] = 0;
  return v8;
}

//----- (00402FCE) --------------------------------------------------------
_DWORD *__thiscall sub_402FCE(int this, _DWORD *a2, __int64 a3, int a4, char a5)
{
  unsigned int v6; // edi
  unsigned int v7; // ecx
  char v8; // bl
  int v9; // edx
  int v10; // eax
  int v11; // edi
  int v12; // eax
  unsigned int v13; // eax
  __int64 v14; // kr00_8
  int v15; // edx
  int v16; // edx
  _DWORD *result; // eax
  int v18; // [esp+18h] [ebp-10h]
  unsigned int v19; // [esp+1Ch] [ebp-Ch]
  int v20; // [esp+24h] [ebp-4h]
  int v21; // [esp+38h] [ebp+10h]
  int v22; // [esp+3Ch] [ebp+14h]

  v6 = **(_DWORD **)(this + 28);
  v19 = v6;
  if ( (*(_BYTE *)(this + 60) & 2) != 0 )
  {
    v7 = 0;
  }
  else
  {
    v7 = **(_DWORD **)(this + 32);
    if ( v7 && *(_DWORD *)(this + 56) < v7 )
      *(_DWORD *)(this + 56) = v7;
  }
  v8 = a5;
  v9 = **(_DWORD **)(this + 12);
  v20 = *(_DWORD *)(this + 56);
  v18 = v9;
  if ( !a4 )
  {
    v12 = 0;
    v11 = 0;
    goto LABEL_22;
  }
  if ( a4 == 1 )
  {
    if ( (a5 & 3) != 3 )
    {
      if ( (a5 & 1) != 0 )
      {
        if ( !v6 && v9 )
          goto LABEL_35;
        v13 = v6;
      }
      else
      {
        if ( (a5 & 2) == 0 || !v7 && v9 )
          goto LABEL_35;
        v13 = v7;
      }
      v10 = v13 - v9;
      goto LABEL_10;
    }
LABEL_35:
    result = a2;
    *a2 = -1;
    a2[1] = -1;
    goto LABEL_36;
  }
  if ( a4 != 2 )
    goto LABEL_35;
  v10 = v20 - v9;
LABEL_10:
  v11 = v10;
  v12 = v10 >> 31;
LABEL_22:
  v14 = a3 + __PAIR64__(v12, v11);
  v22 = (a3 + __PAIR64__(v12, v11)) >> 32;
  if ( a3 + __PAIR64__(v12, v11) > v20 - v9 || v14 && ((a5 & 1) != 0 && !v19 || (a5 & 2) != 0 && !v7) )
    goto LABEL_35;
  v15 = v14 + v9;
  v21 = v14 + v18;
  if ( (a5 & 1) != 0 && v19 )
  {
    **(_DWORD **)(this + 12) = v18;
    v8 = a5;
    **(_DWORD **)(this + 28) = v15;
    **(_DWORD **)(this + 44) = v20 - v15;
  }
  if ( (v8 & 2) != 0 && v7 )
  {
    v16 = **(_DWORD **)(this + 48) + **(_DWORD **)(this + 32);
    **(_DWORD **)(this + 16) = v18;
    **(_DWORD **)(this + 32) = v21;
    **(_DWORD **)(this + 48) = v16 - v21;
  }
  result = a2;
  *a2 = v14;
  a2[1] = v22;
LABEL_36:
  result[2] = 0;
  result[3] = 0;
  result[4] = 0;
  result[5] = 0;
  return result;
}

//----- (00403136) --------------------------------------------------------
int __thiscall sub_403136(int this)
{
  unsigned __int8 **v2; // edi
  unsigned __int8 *v3; // ecx
  unsigned int *v5; // eax
  unsigned int v6; // esi
  unsigned int v7; // esi

  v2 = *(unsigned __int8 ***)(this + 28);
  v3 = *v2;
  if ( !*v2 )
    return -1;
  if ( v3 < &v3[**(_DWORD **)(this + 44)] )
    return *v3;
  v5 = *(unsigned int **)(this + 32);
  if ( !*v5 || (*(_BYTE *)(this + 60) & 4) != 0 )
    return -1;
  v6 = *(_DWORD *)(this + 56);
  if ( v6 < *v5 )
    v6 = *v5;
  if ( v6 <= (unsigned int)v3 )
    return -1;
  *(_DWORD *)(this + 56) = v6;
  v7 = v6 - (_DWORD)*v2;
  *v2 = *v2;
  **(_DWORD **)(this + 44) = v7;
  return ***(unsigned __int8 ***)(this + 28);
}

//----- (00403192) --------------------------------------------------------
int __thiscall sub_403192(int this, int a2)
{
  unsigned int v3; // esi
  int v4; // ecx

  v3 = **(_DWORD **)(this + 28);
  if ( !v3 )
    return -1;
  if ( v3 <= **(_DWORD **)(this + 12) )
    return -1;
  v4 = a2;
  if ( a2 != -1 && (_BYTE)a2 != *(_BYTE *)(v3 - 1) && (*(_BYTE *)(this + 60) & 2) != 0 )
    return -1;
  ++**(_DWORD **)(this + 44);
  --**(_DWORD **)(this + 28);
  if ( a2 != -1 )
    ***(_BYTE ***)(this + 28) = a2;
  if ( a2 == -1 )
    return 0;
  return v4;
}

//----- (004031E5) --------------------------------------------------------
int __thiscall sub_4031E5(int this, int a2)
{
  unsigned int v4; // ebx
  unsigned int v5; // ecx
  _BYTE *v6; // eax
  int v7; // ecx
  size_t v8; // esi
  size_t v9; // ebx
  char *v10; // ecx
  int v11; // esi
  _BYTE *v12; // eax
  _DWORD *Src; // [esp+Ch] [ebp-8h]
  _DWORD *v14; // [esp+10h] [ebp-4h]

  if ( (*(_BYTE *)(this + 60) & 2) == 0 )
  {
    if ( a2 == -1 )
      return 0;
    v4 = **(_DWORD **)(this + 32);
    v5 = v4 + **(_DWORD **)(this + 48);
    if ( v4 && v4 < v5 )
    {
      v6 = (_BYTE *)std::streambuf::_Pninc(this);
      v7 = a2;
      *v6 = a2;
      *(_DWORD *)(this + 56) = v4 + 1;
      return v7;
    }
    v8 = 32;
    Src = **(_DWORD ***)(this + 12);
    v9 = v4 != 0 ? v5 - (_DWORD)Src : 0;
    if ( v9 < 0x20 )
    {
LABEL_12:
      v14 = sub_403756(v8);
      memcpy(v14, Src, v9);
      *(_DWORD *)(this + 56) = (char *)v14 + v9 + 1;
      **(_DWORD **)(this + 16) = v14;
      **(_DWORD **)(this + 32) = (char *)v14 + v9;
      **(_DWORD **)(this + 48) = v8 - v9;
      if ( (*(_BYTE *)(this + 60) & 4) != 0 )
      {
        **(_DWORD **)(this + 12) = v14;
        **(_DWORD **)(this + 28) = 0;
        **(_DWORD **)(this + 44) = v14;
      }
      else
      {
        v10 = (char *)v14 + **(_DWORD **)(this + 28) - (_DWORD)Src;
        v11 = *(_DWORD *)(this + 56) - (_DWORD)v10;
        **(_DWORD **)(this + 12) = v14;
        **(_DWORD **)(this + 28) = v10;
        **(_DWORD **)(this + 44) = v11;
      }
      if ( (*(_BYTE *)(this + 60) & 1) != 0 )
        sub_403795(Src, v9);
      *(_DWORD *)(this + 60) |= 1u;
      v12 = (_BYTE *)std::streambuf::_Pninc(this);
      v7 = a2;
      *v12 = a2;
      return v7;
    }
    if ( v9 < 0x3FFFFFFF )
    {
      v8 = 2 * v9;
      goto LABEL_12;
    }
    v8 = 0x7FFFFFFF;
    if ( v9 < 0x7FFFFFFF )
      goto LABEL_12;
  }
  return -1;
}
// 407034: using guessed type int __thiscall std::streambuf::_Pninc(_DWORD);

//----- (00403304) --------------------------------------------------------
int __thiscall sub_403304(_BYTE *this)
{
  bool v2; // zf
  int v3; // ecx
  int v4; // edx

  v2 = (this[60] & 1) == 0;
  *(_DWORD *)this = &off_4072D4;
  if ( !v2 )
  {
    v3 = **((_DWORD **)this + 8);
    if ( v3 )
      v4 = v3 + **((_DWORD **)this + 12);
    else
      v4 = **((_DWORD **)this + 7) + **((_DWORD **)this + 11);
    sub_403795(**((_DWORD ***)this + 3), v4 - **((_DWORD **)this + 3));
  }
  **((_DWORD **)this + 3) = 0;
  **((_DWORD **)this + 7) = 0;
  **((_DWORD **)this + 11) = 0;
  **((_DWORD **)this + 4) = 0;
  **((_DWORD **)this + 8) = 0;
  **((_DWORD **)this + 12) = 0;
  *((_DWORD *)this + 15) &= ~1u;
  *((_DWORD *)this + 14) = 0;
  return std::streambuf::~streambuf<char,std::char_traits<char>>(this);
}
// 407044: using guessed type int __thiscall std::streambuf::~streambuf<char,std::char_traits<char>>(_DWORD);
// 4072D4: using guessed type int (__thiscall *off_4072D4)(void *Block, char);

//----- (0040339B) --------------------------------------------------------
int __thiscall sub_40339B(_DWORD *this)
{
  _DWORD *v2; // ecx
  int result; // eax

  v2 = (_DWORD *)*this;
  if ( v2 )
  {
    sub_403795(v2, (this[2] - (_DWORD)v2) & 0xFFFFFFF8);
    result = 0;
    *this = 0;
    this[1] = 0;
    this[2] = 0;
  }
  return result;
}

//----- (004033BD) --------------------------------------------------------
void __thiscall sub_4033BD(_DWORD **this)
{
  unsigned int v2; // edx

  v2 = (unsigned int)this[5];
  if ( v2 >= 0x10 )
    sub_403795(*this, v2 + 1);
  this[4] = 0;
  *(_BYTE *)this = 0;
  this[5] = (_DWORD *)15;
}

//----- (004033E0) --------------------------------------------------------
_DWORD *__thiscall sub_4033E0(_DWORD *this, char a2)
{
  _DWORD *v3; // edi

  v3 = this - 20;
  sub_402E28(this);
  std::ios::~ios<char,std::char_traits<char>>(this);
  if ( (a2 & 1) != 0 )
    sub_4051A8(v3);
  return v3;
}
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);

//----- (00403412) --------------------------------------------------------
_BYTE *__thiscall sub_403412(_BYTE *Block, char a2)
{
  sub_403304(Block);
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}

//----- (00403434) --------------------------------------------------------
char *__thiscall sub_403434(char *this, char a2)
{
  char *v3; // edi

  v3 = this - 104;
  std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>();
  std::ios::~ios<char,std::char_traits<char>>(this);
  if ( (a2 & 1) != 0 )
    sub_4051A8(v3);
  return v3;
}
// 40336B: using guessed type int std::basic_stringstream<char,std::char_traits<char>,std::allocator<char>>::~basic_stringstream<char,std::char_traits<char>,std::allocator<char>>(void);
// 40706C: using guessed type int __thiscall std::ios::~ios<char,std::char_traits<char>>(_DWORD);

//----- (00403466) --------------------------------------------------------
_DWORD *__thiscall sub_403466(int this, _DWORD *a2)
{
  unsigned int v3; // ecx
  void **v4; // eax
  void *v5; // edx
  size_t v6; // ecx
  int v7; // edi

  *a2 = 0;
  a2[4] = 0;
  a2[5] = 15;
  *(_BYTE *)a2 = 0;
  if ( (*(_DWORD *)(this + 60) & 0x22) == 2 || (v3 = **(_DWORD **)(this + 32)) == 0 )
  {
    if ( (*(_BYTE *)(this + 60) & 4) != 0 || (v7 = **(_DWORD **)(this + 28)) == 0 )
    {
      v6 = 0;
      v5 = 0;
    }
    else
    {
      v5 = **(void ***)(this + 12);
      v6 = v7 + **(_DWORD **)(this + 44) - (_DWORD)v5;
    }
  }
  else
  {
    v4 = *(void ***)(this + 16);
    if ( v3 < *(_DWORD *)(this + 56) )
      v3 = *(_DWORD *)(this + 56);
    v5 = *v4;
    v6 = v3 - (_DWORD)*v4;
  }
  if ( v5 )
    sub_403606(a2, v5, v6);
  return a2;
}

//----- (004034FB) --------------------------------------------------------
_DWORD *__thiscall sub_4034FB(_DWORD *this, char a2)
{
  int v3; // edx
  int v4; // ecx
  int v5; // eax

  std::streambuf::streambuf();
  this[14] = 0;
  *this = &off_4072D4;
  v3 = (4 * ((a2 & 1) == 0)) | 2;
  if ( (a2 & 2) != 0 )
    v3 = 4 * ((a2 & 1) == 0);
  v4 = v3 | 8;
  if ( (a2 & 8) == 0 )
    v4 = v3;
  v5 = v4 | 0x10;
  if ( (a2 & 4) == 0 )
    v5 = v4;
  this[15] = v5;
  return this;
}
// 4070C0: using guessed type int std::streambuf::streambuf(void);
// 4072D4: using guessed type int (__thiscall *off_4072D4)(void *Block, char);

//----- (0040354F) --------------------------------------------------------
_DWORD *__thiscall sub_40354F(_DWORD *this, _DWORD *a2, unsigned int a3, int a4, int a5)
{
  _DWORD *v5; // eax
  unsigned int v7; // ecx
  unsigned int v8; // ecx
  size_t v9; // esi
  char *v10; // eax
  int v11; // edi
  _DWORD *v12; // esi
  void *Src; // [esp+8h] [ebp-8h]
  size_t Size; // [esp+Ch] [ebp-4h]

  v5 = a2;
  *this = 0;
  this[4] = 0;
  this[5] = 0;
  v7 = a2[4];
  if ( v7 < a3 )
    sub_4036A4();
  v8 = v7 - a3;
  v9 = 20;
  if ( v8 < 0x14 )
    v9 = v8;
  Size = v9;
  if ( a2[5] >= 0x10u )
    v5 = (_DWORD *)*a2;
  v10 = (char *)v5 + a3;
  Src = v10;
  this[5] = 15;
  if ( v9 >= 0x10 )
  {
    v11 = sub_4037E8(this, v9);
    v12 = sub_403756(__CFADD__(v11, 1) ? -1 : v11 + 1);
    this[5] = v11;
    *this = v12;
    this[4] = Size;
    memcpy(v12, Src, Size);
    *((_BYTE *)v12 + Size) = 0;
  }
  else
  {
    this[4] = v9;
    memmove(this, v10, v9);
    *((_BYTE *)this + v9) = 0;
  }
  return this;
}
// 403593: conditional instruction was optimized away because esi.4<15u
// 401416: using guessed type void __noreturn sub_401416(void);
// 4036A4: using guessed type void __noreturn sub_4036A4(void);

//----- (00403606) --------------------------------------------------------
_DWORD *__thiscall sub_403606(_DWORD *this, void *Src, size_t Size)
{
  size_t v4; // eax
  _DWORD *v5; // esi
  int v6; // esi
  unsigned int v8; // [esp+Ch] [ebp-Ch]
  _DWORD *v9; // [esp+10h] [ebp-8h]

  v4 = this[5];
  v8 = v4;
  if ( Size > v4 )
  {
    if ( Size > 0x7FFFFFFF )
      sub_401416();
    v6 = sub_4037E8(this, Size);
    v9 = sub_403756(__CFADD__(v6, 1) ? -1 : v6 + 1);
    this[4] = Size;
    this[5] = v6;
    memcpy(v9, Src, Size);
    *((_BYTE *)v9 + Size) = 0;
    if ( v8 >= 0x10 )
      sub_403795((_DWORD *)*this, v8 + 1);
    *this = v9;
  }
  else
  {
    v5 = this;
    if ( v4 >= 0x10 )
      v5 = (_DWORD *)*this;
    this[4] = Size;
    memmove(v5, Src, Size);
    *((_BYTE *)v5 + Size) = 0;
  }
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (004036A4) --------------------------------------------------------
void __noreturn sub_4036A4()
{
  std::_Xout_of_range("invalid string position");
  JUMPOUT(0x4036AF);
}
// 4036A9: control flows out of bounds to 4036AF
// 4036A4: using guessed type void __noreturn sub_4036A4();
// 4070CC: using guessed type void __cdecl std::_Xout_of_range(const char *);

//----- (004036B0) --------------------------------------------------------
void __thiscall sub_4036B0(_DWORD *this, unsigned int a2, _DWORD *a3)
{
  unsigned int v3; // edi
  _DWORD *v5; // eax
  _DWORD *v6; // esi
  int v7; // ecx
  size_t Size; // [esp+8h] [ebp-10h] BYREF
  __int64 v9; // [esp+Ch] [ebp-Ch]

  v3 = a2;
  if ( a2 )
  {
    if ( a2 > 0x1FFFFFFF )
      sub_40381C();
    v5 = sub_403828(a2);
    v6 = v5;
    *this = v5;
    this[1] = v5;
    Size = 8 * a2;
    v9 = 0i64;
    this[2] = &v5[2 * a2];
    if ( *(_QWORD *)a3 == v9 )
    {
      memset(v5, 0, Size);
      v6 = (_DWORD *)((char *)v6 + Size);
    }
    else
    {
      do
      {
        v7 = a3[1];
        *v6 = *a3;
        v6[1] = v7;
        v6 += 2;
        --v3;
      }
      while ( v3 );
    }
    Size = 0;
    this[1] = v6;
    sub_4037C2((int *)&Size);
  }
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403756) --------------------------------------------------------
_DWORD *__thiscall sub_403756(size_t Size)
{
  void *v1; // eax
  void *v2; // ecx
  _DWORD *result; // eax

  if ( Size < 0x1000 )
  {
    if ( Size )
      return operator new(Size);
    else
      return 0;
  }
  else
  {
    if ( Size + 35 <= Size )
      sub_4013C3();
    v1 = operator new(Size + 35);
    v2 = v1;
    if ( !v1 )
      invalid_parameter_noinfo_noreturn();
    result = (_DWORD *)(((unsigned int)v1 + 35) & 0xFFFFFFE0);
    *(result - 1) = v2;
  }
  return result;
}
// 4013C3: using guessed type void __noreturn sub_4013C3(void);

//----- (00403795) --------------------------------------------------------
void __fastcall sub_403795(_DWORD *Block, unsigned int a2)
{
  if ( a2 >= 0x1000 )
  {
    if ( (unsigned int)Block - *(Block - 1) - 4 > 0x1F )
      invalid_parameter_noinfo_noreturn();
    Block = (_DWORD *)*(Block - 1);
  }
  sub_4051A8(Block);
}

//----- (004037C2) --------------------------------------------------------
int __thiscall sub_4037C2(int *this)
{
  int v1; // esi
  int result; // eax

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
    {
      sub_403795(*(_DWORD **)v1, (*(_DWORD *)(v1 + 8) - *(_DWORD *)v1) & 0xFFFFFFF8);
      result = 0;
      *(_DWORD *)v1 = 0;
      *(_DWORD *)(v1 + 4) = 0;
      *(_DWORD *)(v1 + 8) = 0;
    }
  }
  return result;
}

//----- (004037E8) --------------------------------------------------------
int __thiscall sub_4037E8(_DWORD *this, int a2)
{
  int v2; // edx
  unsigned int v3; // edi

  v2 = 0x7FFFFFFF;
  v3 = this[5];
  if ( (a2 | 0xFu) <= 0x7FFFFFFF && v3 <= 0x7FFFFFFF - (v3 >> 1) )
  {
    v2 = a2 | 0xF;
    if ( (a2 | 0xFu) < v3 + (v3 >> 1) )
      return v3 + (v3 >> 1);
  }
  return v2;
}

//----- (0040381C) --------------------------------------------------------
void __noreturn sub_40381C()
{
  std::_Xlength_error("vector too long");
}
// 40381C: using guessed type void __noreturn sub_40381C();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (00403828) --------------------------------------------------------
_DWORD *__stdcall sub_403828(unsigned int a1)
{
  int savedregs; // [esp+0h] [ebp+0h]

  if ( a1 > 0x1FFFFFFF )
    sub_4013C3(savedregs);
  return sub_403756(8 * a1);
}
// 403842: variable 'savedregs' is possibly undefined
// 4013C3: using guessed type void __stdcall __noreturn sub_4013C3(_DWORD);

//----- (00403848) --------------------------------------------------------
int __thiscall sub_403848(int this, unsigned int a2, int a3)
{
  unsigned int v3; // edi
  unsigned int v4; // ecx
  unsigned int v5; // edx
  _DWORD *v6; // esi
  int v8; // [esp+Ch] [ebp-8h]

  v3 = 0x1FFFFFFF;
  if ( a2 > 0x1FFFFFFF )
    sub_40381C();
  v8 = (*(_DWORD *)(this + 4) - *(_DWORD *)this) >> 3;
  v4 = (*(_DWORD *)(this + 8) - *(_DWORD *)this) >> 3;
  v5 = v4 >> 1;
  if ( v4 <= 0x1FFFFFFF - (v4 >> 1) )
  {
    v3 = v5 + v4;
    if ( v5 + v4 < a2 )
      v3 = a2;
  }
  v6 = sub_403828(v3);
  memset(&v6[2 * v8], 0, 8 * (a2 - v8));
  memmove(v6, *(const void **)this, *(_DWORD *)(this + 4) - *(_DWORD *)this);
  return sub_403A31((_DWORD *)this, (int)v6, a2, v3);
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (004038D2) --------------------------------------------------------
char *__thiscall sub_4038D2(void **this, char *Src, int a3, int a4)
{
  _BYTE *v5; // esi
  unsigned int v6; // edi
  unsigned int v7; // eax
  char *v8; // edi
  char *v9; // esi
  char *result; // eax

  v5 = *this;
  v6 = (a3 - (int)Src) >> 3;
  if ( v6 > ((_BYTE *)this[2] - (_BYTE *)*this) >> 3 )
  {
    sub_403A66(this, (a3 - (int)Src) >> 3);
    v5 = *this;
    memmove(*this, Src, a3 - (_DWORD)Src);
LABEL_6:
    result = &v5[8 * v6];
    goto LABEL_7;
  }
  v7 = ((_BYTE *)this[1] - v5) >> 3;
  if ( v6 <= v7 )
  {
    memmove(v5, Src, a3 - (_DWORD)Src);
    goto LABEL_6;
  }
  v8 = &Src[8 * v7];
  memmove(v5, Src, 8 * v7);
  v9 = (char *)this[1];
  memmove(v9, v8, a3 - (_DWORD)v8);
  result = &v9[8 * ((a3 - (int)v8) >> 3)];
LABEL_7:
  this[1] = result;
  return result;
}

//----- (00403966) --------------------------------------------------------
_DWORD *__thiscall sub_403966(int this, const void *a2, _DWORD *a3)
{
  unsigned int v4; // esi
  int v5; // eax
  int v6; // ebx
  unsigned int v7; // ecx
  unsigned int v8; // edx
  _DWORD *v9; // eax
  _DWORD *v10; // ebx
  int v11; // ecx
  const void *v12; // ecx
  int v13; // ebx
  _DWORD *v15; // [esp+Ch] [ebp-10h]
  unsigned int v16; // [esp+10h] [ebp-Ch]
  void *v17; // [esp+18h] [ebp-4h]

  v4 = 0x1FFFFFFF;
  v5 = (*(_DWORD *)(this + 4) - *(_DWORD *)this) >> 3;
  v6 = ((int)a2 - *(_DWORD *)this) >> 3;
  if ( v5 == 0x1FFFFFFF )
    sub_40381C();
  v7 = (*(_DWORD *)(this + 8) - *(_DWORD *)this) >> 3;
  v16 = v5 + 1;
  v8 = v7 >> 1;
  if ( v7 <= 0x1FFFFFFF - (v7 >> 1) )
  {
    v4 = v8 + v7;
    if ( v8 + v7 < v16 )
      v4 = v5 + 1;
  }
  v9 = sub_403828(v4);
  v17 = v9;
  v10 = &v9[2 * v6];
  v11 = a3[1];
  *v10 = *a3;
  v10[1] = v11;
  v12 = *(const void **)(this + 4);
  v15 = v10;
  if ( a2 == v12 )
  {
    memmove(v9, *(const void **)this, (size_t)v12 - *(_DWORD *)this);
    v13 = (int)v17;
  }
  else
  {
    v13 = (int)v9;
    memmove(v9, *(const void **)this, (size_t)a2 - *(_DWORD *)this);
    memmove(v15 + 2, a2, *(_DWORD *)(this + 4) - (_DWORD)a2);
  }
  sub_403A31((_DWORD *)this, v13, v16, v4);
  return v15;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403A31) --------------------------------------------------------
int __thiscall sub_403A31(_DWORD *this, int a2, int a3, int a4)
{
  _DWORD *v5; // ecx
  int result; // eax

  v5 = (_DWORD *)*this;
  if ( v5 )
    sub_403795(v5, (this[2] - (_DWORD)v5) & 0xFFFFFFF8);
  *this = a2;
  this[1] = a2 + 8 * a3;
  result = a2 + 8 * a4;
  this[2] = result;
  return result;
}

//----- (00403A66) --------------------------------------------------------
_DWORD *__thiscall sub_403A66(_DWORD *this, unsigned int a2)
{
  unsigned int v2; // edi
  _DWORD *v4; // ecx
  unsigned int v5; // edx
  unsigned int v6; // ebx
  _DWORD *v7; // eax
  _DWORD *result; // eax

  v2 = 0x1FFFFFFF;
  if ( a2 > 0x1FFFFFFF )
    sub_40381C();
  v4 = (_DWORD *)*this;
  v5 = (this[2] - *this) >> 3;
  v6 = v5 >> 1;
  if ( v5 <= 0x1FFFFFFF - (v5 >> 1) )
  {
    v2 = v6 + v5;
    if ( v6 + v5 < a2 )
      v2 = a2;
  }
  if ( v4 )
  {
    sub_403795(v4, 8 * v5);
    *this = 0;
    this[1] = 0;
    this[2] = 0;
  }
  v7 = sub_403828(v2);
  *this = v7;
  this[1] = v7;
  result = &v7[2 * v2];
  this[2] = result;
  return result;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00403ACC) --------------------------------------------------------
char *__thiscall sub_403ACC(char *this, char a2)
{
  return sub_403434(&this[-*((_DWORD *)this - 1)], a2);
}

//----- (00403AD4) --------------------------------------------------------
_DWORD *__thiscall sub_403AD4(_DWORD *this, char a2)
{
  return sub_4033E0((_DWORD *)((char *)this - *(this - 1)), a2);
}

//----- (00403ADC) --------------------------------------------------------
int __fastcall sub_403ADC(int a1, int a2)
{
  int v2; // ebx
  struct _LIST_ENTRY *p_InMemoryOrderModuleList; // edx
  struct _LIST_ENTRY *Flink; // esi
  unsigned int v5; // edi
  char *v6; // esi
  char v7; // cl
  unsigned __int8 *v8; // edi
  unsigned __int8 v9; // al
  int v10; // ecx
  struct _LIST_ENTRY *v11; // ecx
  _DWORD *v12; // eax
  int v13; // edi
  int v14; // edi
  unsigned __int8 *v15; // ebx
  unsigned __int8 v16; // al
  int v17; // edx
  int v19; // [esp+Ch] [ebp-64h]
  int v20; // [esp+10h] [ebp-60h]
  unsigned int v21; // [esp+14h] [ebp-5Ch]
  struct _LIST_ENTRY *v23; // [esp+1Ch] [ebp-54h]
  int v24; // [esp+20h] [ebp-50h]
  struct _LIST_ENTRY *v26; // [esp+28h] [ebp-48h]
  int v27; // [esp+28h] [ebp-48h]
  char v28[64]; // [esp+2Ch] [ebp-44h] BYREF

  v2 = a2;
  p_InMemoryOrderModuleList = &NtCurrentTeb()->ProcessEnvironmentBlock->Ldr->InMemoryOrderModuleList;
  v23 = p_InMemoryOrderModuleList;
  Flink = p_InMemoryOrderModuleList->Flink;
  v26 = p_InMemoryOrderModuleList->Flink;
  if ( p_InMemoryOrderModuleList->Flink == p_InMemoryOrderModuleList )
    return 0;
  while ( 1 )
  {
    if ( LOWORD(Flink[4].Blink) >= 0x3Fu )
      goto LABEL_24;
    v5 = 0;
    if ( Flink[5].Flink->Flink )
    {
      v6 = (char *)Flink[5].Flink;
      do
      {
        if ( v5 >= 0x3F )
          break;
        v7 = *v6 - 32;
        if ( (unsigned __int8)(*v6 - 97) > 0x19u )
          v7 = *v6;
        v6 += 2;
        v28[v5++] = v7;
      }
      while ( *(_WORD *)v6 );
      Flink = v26;
      if ( v5 >= 0x40 )
      {
        __report_rangecheckfailure(0);
        __debugbreak();
      }
      p_InMemoryOrderModuleList = v23;
      v2 = a2;
    }
    v28[v5] = 0;
    v8 = (unsigned __int8 *)v28;
    v9 = v28[0];
    v10 = -2128831035;
    while ( v9 )
    {
      ++v8;
      v10 = 16777619 * (v10 ^ v9);
      v9 = *v8;
    }
    if ( v10 != v2 )
      goto LABEL_24;
    v11 = Flink[2].Flink;
    v12 = (struct _LIST_ENTRY **)((char *)&v11->Flink
                                + *(unsigned int *)((char *)&v11[7].Blink[15].Flink + (unsigned int)v11));
    v13 = v12[8];
    if ( !v13 )
      goto LABEL_24;
    v20 = (int)v11 + v12[9];
    v24 = (int)v11 + v13;
    v14 = 0;
    v19 = (int)v11 + v12[7];
    v21 = v12[6];
    if ( v21 )
      break;
LABEL_23:
    v2 = a2;
LABEL_24:
    Flink = Flink->Flink;
    v26 = Flink;
    if ( Flink == p_InMemoryOrderModuleList )
      return 0;
  }
  while ( 1 )
  {
    v27 = -2128831035;
    v15 = (unsigned __int8 *)v11 + *(_DWORD *)(v24 + 4 * v14);
    v16 = *v15;
    if ( *v15 )
    {
      v17 = -2128831035;
      do
      {
        ++v15;
        v17 = 16777619 * (v17 ^ v16);
        v16 = *v15;
      }
      while ( *v15 );
      v27 = v17;
      p_InMemoryOrderModuleList = v23;
    }
    if ( v27 == a1 )
      return (int)v11 + *(_DWORD *)(v19 + 4 * *(unsigned __int16 *)(v20 + 2 * v14));
    if ( ++v14 >= v21 )
      goto LABEL_23;
  }
}
// 40536F: using guessed type int __thiscall __report_rangecheckfailure(_DWORD);
// 403ADC: using guessed type char var_44[64];

//----- (00403C42) --------------------------------------------------------
_DWORD *__userpurge sub_403C42@<eax>(int a1@<ebp>, _DWORD *a2, _BYTE *a3, _BYTE *a4, int a5, int a6)
{
  _BYTE *v6; // esi
  int v7; // eax
  void *v8; // edi
  int **v9; // eax
  int *v10; // edx
  unsigned int v11; // ecx
  _BYTE *v12; // edi
  int v13; // eax
  int v14; // eax
  _DWORD *v15; // esi
  int v17; // [esp-20h] [ebp-2Ch] BYREF
  _DWORD *v18; // [esp-18h] [ebp-24h]
  int v19; // [esp-14h] [ebp-20h]
  void *v20; // [esp-10h] [ebp-1Ch] BYREF
  int v21; // [esp-Ch] [ebp-18h]
  _BYTE *v22; // [esp-8h] [ebp-14h]
  _DWORD v23[3]; // [esp+0h] [ebp-Ch] BYREF
  void *retaddr; // [esp+Ch] [ebp+0h]

  v23[0] = a1;
  v23[1] = retaddr;
  v6 = a3;
  v18 = a2;
  v22 = a4;
  v19 = a6 + 32 * ((a5 - (int)Block) >> 2);
  v7 = sub_403D15((int)v23, a4 - a3, a5, a6);
  v8 = Block;
  v21 = 0;
  v20 = Block;
  v9 = (int **)sub_403FE2((int *)&v20, &v17, v7);
  v10 = *v9;
  v11 = (unsigned int)v9[1];
  if ( a3 != v22 )
  {
    v12 = v22;
    do
    {
      v13 = *v10;
      if ( *v6 )
        v14 = v13 | (1 << v11);
      else
        v14 = v13 & ~(1 << v11);
      *v10 = v14;
      if ( v11 >= 0x1F )
      {
        v11 = 0;
        ++v10;
      }
      else
      {
        ++v11;
      }
      ++v6;
    }
    while ( v6 != v12 );
    v8 = Block;
  }
  v15 = v18;
  v21 = 0;
  v20 = v8;
  sub_403FE2((int *)&v20, v18, v19);
  return v15;
}
// 403C42: could not find valid save-restore pair for ebp

//----- (00403D15) --------------------------------------------------------
int __userpurge sub_403D15@<eax>(int a1@<ebp>, unsigned int a2, int a3, int a4)
{
  int v4; // edi
  void *v5; // esi
  int v6; // esi
  _DWORD *v7; // eax
  int *v8; // edx
  _DWORD *v9; // edi
  _DWORD *v10; // ecx
  int v11; // eax
  int v12; // ecx
  int v13; // eax
  int v14; // eax
  int v16; // [esp-2Ch] [ebp-38h] BYREF
  _DWORD v17[2]; // [esp-24h] [ebp-30h] BYREF
  int v18; // [esp-1Ch] [ebp-28h]
  int v19; // [esp-18h] [ebp-24h] BYREF
  void *v20; // [esp-14h] [ebp-20h] BYREF
  _DWORD *v21; // [esp-10h] [ebp-1Ch]
  __int64 v22; // [esp-Ch] [ebp-18h] BYREF
  int v23; // [esp+0h] [ebp-Ch]
  int v24; // [esp+4h] [ebp-8h]
  int retaddr; // [esp+Ch] [ebp+0h]

  v23 = a1;
  v24 = retaddr;
  v4 = a4 + 32 * ((a3 - (int)Block) >> 2);
  v18 = v4;
  if ( a2 )
  {
    if ( 0x7FFFFFFF - dword_40A41C < a2 )
      sub_4044BC();
    v19 = 0;
    sub_403E63((a2 + dword_40A41C + 31) >> 5, &v19);
    if ( dword_40A41C )
    {
      v5 = Block;
      v21 = 0;
      v22 = 0i64;
      v20 = Block;
      sub_403FE2((int *)&v20, &v22, dword_40A41C);
      v21 = 0;
      dword_40A41C += a2;
      v20 = v5;
      sub_403FE2((int *)&v20, v17, dword_40A41C);
      v21 = 0;
      v20 = v5;
      v6 = v17[1];
      v7 = sub_403FE2((int *)&v20, &v16, v4);
      v8 = (int *)v17[0];
      v9 = (_DWORD *)v22;
      v10 = (_DWORD *)*v7;
      v11 = v7[1];
      v21 = v10;
      v12 = HIDWORD(v22);
      v19 = v11;
      while ( v21 != v9 || v11 != v12 )
      {
        if ( v12 )
        {
          --v12;
        }
        else
        {
          v12 = 31;
          --v9;
        }
        if ( v6 )
        {
          --v6;
        }
        else
        {
          v6 = 31;
          --v8;
        }
        v13 = *v8;
        if ( ((1 << v12) & *v9) != 0 )
          v14 = v13 | (1 << v6);
        else
          v14 = v13 & ~(1 << v6);
        *v8 = v14;
        v11 = v19;
      }
      return v18;
    }
    else
    {
      dword_40A41C = a2;
    }
  }
  return v4;
}
// 403D15: could not find valid save-restore pair for ebp
// 4044BC: using guessed type void __noreturn sub_4044BC(void);
// 40A41C: using guessed type int dword_40A41C;

//----- (00403E63) --------------------------------------------------------
void __stdcall sub_403E63(unsigned int a1, _DWORD *a2)
{
  unsigned int v2; // ecx
  _DWORD *v3; // eax

  v2 = ((_BYTE *)dword_40A414 - (_BYTE *)Block) >> 2;
  if ( a1 >= v2 )
  {
    if ( a1 <= v2 )
      return;
    if ( a1 > (dword_40A418 - (int)Block) >> 2 )
    {
      sub_403EBC(a1, a2);
      return;
    }
    v3 = sub_403F89(dword_40A414, a1 - v2, a2);
  }
  else
  {
    v3 = (char *)Block + 4 * a1;
  }
  dword_40A414 = v3;
}
// 40A418: using guessed type int dword_40A418;

//----- (00403EBC) --------------------------------------------------------
_DWORD *__stdcall sub_403EBC(unsigned int a1, _DWORD *a2)
{
  unsigned int v2; // ecx
  unsigned int v3; // edx
  int v4; // edi
  unsigned int v5; // eax
  _DWORD *v6; // ebx
  _DWORD *result; // eax
  int v8; // [esp-4h] [ebp-10h]
  int v9; // [esp+8h] [ebp-4h]

  if ( a1 > 0x3FFFFFFF )
    sub_40381C();
  v2 = (dword_40A418 - (int)Block) >> 2;
  v3 = v2 >> 1;
  v4 = ((_BYTE *)dword_40A414 - (_BYTE *)Block) >> 2;
  if ( v2 <= 0x3FFFFFFF - (v2 >> 1) )
  {
    v5 = v3 + v2;
    if ( v3 + v2 >= a1 )
    {
      if ( v5 > 0x3FFFFFFF )
        sub_4013C3(v8);
    }
    else
    {
      v5 = a1;
    }
  }
  else
  {
    v5 = 0x3FFFFFFF;
  }
  v9 = v5;
  v6 = sub_403756(4 * v5);
  sub_403F89(&v6[v4], a1 - v4, a2);
  memmove(v6, Block, (_BYTE *)dword_40A414 - (_BYTE *)Block);
  if ( Block )
    sub_403795(Block, (dword_40A418 - (_DWORD)Block) & 0xFFFFFFFC);
  Block = v6;
  dword_40A414 = &v6[a1];
  result = &v6[v9];
  dword_40A418 = (int)&v6[v9];
  return result;
}
// 403F7E: variable 'v8' is possibly undefined
// 4013C3: using guessed type void __stdcall __noreturn sub_4013C3(_DWORD);
// 40381C: using guessed type void __noreturn sub_40381C(void);
// 40A418: using guessed type int dword_40A418;

//----- (00403F89) --------------------------------------------------------
_DWORD *__usercall sub_403F89@<eax>(_DWORD *a1@<ecx>, int a2@<edx>, _DWORD *a3)
{
  _DWORD *v3; // edi
  int v4; // esi

  v3 = a1;
  if ( *a3 )
  {
    for ( ; a2; --a2 )
      *v3++ = *a3;
    return v3;
  }
  else
  {
    v4 = a2;
    memset(a1, 0, 4 * a2);
    return &v3[v4];
  }
}

//----- (00403FE2) --------------------------------------------------------
_DWORD *__thiscall sub_403FE2(int *this, _DWORD *a2, int a3)
{
  int v3; // eax
  int *v4; // edi
  unsigned int v5; // esi
  _DWORD *result; // eax

  v3 = *this;
  a2[1] = this[1];
  *a2 = v3;
  v4 = a2 + 1;
  if ( a3 >= 0 || *v4 >= (unsigned int)-a3 )
  {
    v5 = a3 + *v4;
    *a2 += 4 * (v5 >> 5);
  }
  else
  {
    v5 = a3 + *v4;
    *a2 += -4 - 4 * (~v5 >> 5);
  }
  *v4 = v5;
  result = a2;
  *v4 = v5 & 0x1F;
  return result;
}

//----- (0040403A) --------------------------------------------------------
int sub_40403A()
{
  unsigned int v0; // ebx
  void (__stdcall *v1)(char *); // esi
  char v3[23]; // [esp+9h] [ebp-17h] BYREF

  v0 = 0;
  v1 = (void (__stdcall *)(char *))sub_403ADC(1102179001, 701355107);
  qmemcpy(v3, "yj)jUj?j?j+jUj?j?jjj", 20);
  do
  {
    v3[v0] = (35 * (106 - (unsigned __int8)v3[v0]) % 127 + 127) % 127;
    ++v0;
  }
  while ( v0 < 0x14 );
  v1(v3);
  return 0;
}

//----- (004040E3) --------------------------------------------------------
int sub_4040E3()
{
  int (__stdcall *v0)(int, int *, int, char *); // eax
  int v1; // eax
  int *v2; // esi
  int (__stdcall *v4)(int); // [esp+Ch] [ebp-14h]
  void *v5; // [esp+10h] [ebp-10h] BYREF
  char v6[4]; // [esp+14h] [ebp-Ch] BYREF
  int v7; // [esp+18h] [ebp-8h] BYREF

  v4 = (int (__stdcall *)(int))sub_403ADC(-366093686, 341012667);
  if ( !v4
    || (v0 = (int (__stdcall *)(int, int *, int, char *))sub_403ADC(1842915397, 701355107),
        v1 = v0(31, &v7, 4, v6),
        v4(v1) < 0)
    || v7 )
  {
    v2 = sub_4046ED(&v5);
    if ( v2 != &dword_40A400 )
    {
      sub_404691((void **)&dword_40A400);
      dword_40A400 = *v2;
      dword_40A404 = v2[1];
      v2[1] = 0;
      *v2 = 0;
    }
    sub_404691(&v5);
  }
  return 0;
}
// 404111: conditional instruction was optimized away because eax.4!=0
// 40A400: using guessed type int dword_40A400;
// 40A404: using guessed type int dword_40A404;
// 4040E3: using guessed type char var_C[4];

//----- (0040418B) --------------------------------------------------------
int sub_40418B()
{
  int v0; // eax
  void *v2[2]; // [esp+Ch] [ebp-38h] BYREF
  _DWORD *v3; // [esp+14h] [ebp-30h]
  void (__stdcall *v4)(_DWORD, _DWORD, _DWORD); // [esp+18h] [ebp-2Ch]
  void (__stdcall *v5)(_DWORD, _DWORD, _DWORD); // [esp+1Ch] [ebp-28h]
  int (__stdcall *v6)(_DWORD); // [esp+20h] [ebp-24h]
  int (__stdcall *v7)(_DWORD *); // [esp+24h] [ebp-20h]
  int (__stdcall *v8)(_DWORD); // [esp+28h] [ebp-1Ch]
  int (__stdcall *v9)(_DWORD, _DWORD, _DWORD, _DWORD); // [esp+2Ch] [ebp-18h]
  int (__stdcall *v10)(_DWORD, _DWORD, _DWORD, _DWORD); // [esp+30h] [ebp-14h]
  int v11; // [esp+34h] [ebp-10h]
  int v12; // [esp+38h] [ebp-Ch]
  _DWORD *v13; // [esp+3Ch] [ebp-8h]
  _DWORD *v14; // [esp+40h] [ebp-4h]

  v11 = 0;
  v10 = (int (__stdcall *)(_DWORD, _DWORD, _DWORD, _DWORD))sub_403ADC(52974849, 701355107);
  v9 = v10;
  v14 = (_DWORD *)v10(0, 716, 4096, 4);
  if ( v14 )
  {
    memset(v14, 0, 0x2CCu);
    v13 = v14 + 179;
    v12 = 0;
    *v14 = 65552;
    v8 = (int (__stdcall *)(_DWORD))sub_403ADC(-2050186626, 701355107);
    v7 = (int (__stdcall *)(_DWORD *))sub_403ADC(-1681545720, 701355107);
    v6 = v8;
    v0 = v7(v14);
    if ( v8(v0) && (v14[1] || v14[2] || v14[3] || v14[4]) )
      v11 = 1;
    v5 = (void (__stdcall *)(_DWORD, _DWORD, _DWORD))sub_403ADC(983223410, 701355107);
    v4 = v5;
    v5(v14, 0, 0x8000);
  }
  if ( !v11 && !*(_BYTE *)(dword_40A420 + 2) )
  {
    v3 = sub_4047C7(&dword_40A400, v2, dword_40A408);
    sub_40459E((int)&dword_40A400, v3);
    sub_40452E(v2);
  }
  return 0;
}
// 40A400: using guessed type int dword_40A400;
// 40A408: using guessed type _DWORD dword_40A408[2];
// 40A420: using guessed type int dword_40A420;

//----- (004042D2) --------------------------------------------------------
int __cdecl main(int argc, const char **argv, const char **envp)
{
  int v3; // ebx
  unsigned __int8 v4; // al
  int v5; // eax
  _DWORD *v6; // esi
  _DWORD **v7; // ebx
  int v8; // esi
  char *v9; // eax
  int v10; // eax
  unsigned int v11; // esi
  char v12; // al
  const char *v13; // edx
  int v14; // eax
  int v16[5]; // [esp-18h] [ebp-64h] BYREF
  unsigned int v17; // [esp-4h] [ebp-50h]
  void *Block; // [esp+10h] [ebp-3Ch] BYREF
  unsigned int v19; // [esp+14h] [ebp-38h]
  _DWORD *Src[4]; // [esp+18h] [ebp-34h] BYREF
  int v21; // [esp+28h] [ebp-24h]
  int v22; // [esp+2Ch] [ebp-20h]
  void *v23; // [esp+30h] [ebp-1Ch] BYREF
  _DWORD *v24; // [esp+34h] [ebp-18h]
  char *v25; // [esp+38h] [ebp-14h]
  int v26; // [esp+48h] [ebp-4h]

  Src[0] = 0;
  v21 = 0;
  v22 = 15;
  v3 = 1;
  v26 = 1;
  sub_4048B4(std::cout, "[+] Enter flag: ");
  v4 = std::ios::widen(std::cin + *(_DWORD *)(std::cin + 4), 10);
  sub_404CD6(Src, std::cin, v4);
  if ( v21 == 30 )
  {
    v6 = operator new(0x10Cu);
    Block = v6;
    LOBYTE(v26) = 2;
    sub_4045CA(v16, Src);
    v7 = (_DWORD **)sub_4024DF(v6, v16[0], v16[1], v16[2], v16[3], v16[4], v17);
    LOBYTE(v26) = 1;
    ((void (__thiscall *)(_DWORD **))(*v7)[1])(v7);
    ((void (__thiscall *)(_DWORD **))(*v7)[3])(v7);
    v8 = 0;
    Block = 0;
    v19 = 0;
    do
    {
      v23 = 0;
      v24 = 0;
      v25 = 0;
      v9 = (char *)sub_403756(0x14u);
      v23 = v9;
      v25 = v9 + 20;
      *(_DWORD *)v9 = 0;
      *((_DWORD *)v9 + 1) = 0;
      *((_DWORD *)v9 + 2) = 0;
      *((_DWORD *)v9 + 3) = 0;
      *((_DWORD *)v9 + 4) = 0;
      v24 = v9 + 20;
      sub_404B41((int *)&Block);
      LOBYTE(v26) = 3;
      sub_404E21(
        (char **)&v23,
        *(char **)(dword_40A400 + 8 * v8),
        *(_DWORD *)(dword_40A400 + 8 * v8) + *(_DWORD *)(dword_40A400 + 8 * v8 + 4),
        (int)Block);
      v10 = 1 << (v19 & 0x1F);
      v11 = v19;
      LOBYTE(v10) = (v10 & *((_DWORD *)::Block + (v19 >> 5))) != 0;
      ((void (__thiscall *)(_DWORD **, unsigned int, void **, int))(*v7)[2])(v7, v19, &v23, v10);
      LOBYTE(v26) = 1;
      if ( v23 )
      {
        sub_403795(v23, v25 - (_BYTE *)v23);
        v23 = 0;
        v24 = 0;
        v25 = 0;
      }
      v8 = v11 + 1;
      v19 = v8;
    }
    while ( v8 < 3 );
    v12 = ((int (__thiscall *)(_DWORD **))(*v7)[3])(v7);
    v13 = "[-] Correct!";
    if ( !v12 )
      v13 = "[!] Wrong!";
    v14 = sub_4048B4(std::cout, v13);
    std::ostream::operator<<(v14, sub_404A45);
    sub_402462(v7);
    v17 = 268;
    sub_4051A8(v7);
    v3 = 0;
  }
  else
  {
    v5 = sub_4048B4(std::cout, "[!] Wrong!");
    std::ostream::operator<<(v5, sub_404A45);
  }
  sub_4033BD(Src);
  return v3;
}
// 404A45: using guessed type int __cdecl sub_404A45(int);
// 4070A4: using guessed type int __thiscall std::ios::widen(_DWORD, _DWORD);
// 4070BC: using guessed type int __thiscall std::ostream::operator<<(_DWORD, _DWORD);
// 40A400: using guessed type int dword_40A400;

//----- (004044BC) --------------------------------------------------------
void __noreturn sub_4044BC()
{
  std::_Xlength_error("vector<bool> too long");
}
// 4044BC: using guessed type void __noreturn sub_4044BC();
// 4070C4: using guessed type void __cdecl __noreturn std::_Xlength_error(const char *);

//----- (004044EF) --------------------------------------------------------
void __thiscall sub_4044EF(void **this)
{
  if ( *this )
    j_free(*this);
  this[1] = 0;
  *this = 0;
}

//----- (00404508) --------------------------------------------------------
_DWORD *__thiscall sub_404508(_DWORD *this, _BYTE *a2, int a3)
{
  this[1] = 0;
  *this = 0;
  sub_404651(this, a3 - (_DWORD)a2, a2, (int)this);
  return this;
}

//----- (00404533) --------------------------------------------------------
void **__thiscall sub_404533(void **this, int a2, int a3)
{
  int v4; // ebx
  unsigned int v5; // edi
  unsigned int v6; // ecx
  _DWORD *v7; // ecx
  unsigned int v9; // [esp+14h] [ebp-10h]

  v4 = a2;
  this[1] = 0;
  *this = 0;
  v5 = (a3 - a2) >> 3;
  if ( v5 )
  {
    *this = sub_404A74(v5);
    v6 = 0;
    v9 = 0;
    do
    {
      v7 = (char *)*this + 8 * v6;
      v7[1] = 0;
      *v7 = 0;
      sub_404651(v7, *(_DWORD *)(v4 + 4), *(_BYTE **)v4, (int)v7);
      v4 += 8;
      v6 = v9 + 1;
      v9 = v6;
    }
    while ( v6 < v5 );
    this[1] = (void *)v5;
  }
  return this;
}

//----- (0040459E) --------------------------------------------------------
int __thiscall sub_40459E(int this, _DWORD *a2)
{
  if ( (_DWORD *)this != a2 )
  {
    sub_404691((void **)this);
    *(_DWORD *)this = *a2;
    *(_DWORD *)(this + 4) = a2[1];
    a2[1] = 0;
    *a2 = 0;
  }
  return this;
}

//----- (004045CA) --------------------------------------------------------
_DWORD *__thiscall sub_4045CA(_DWORD *this, _DWORD *Src)
{
  _DWORD *v2; // ebx
  unsigned int v4; // eax
  int v5; // esi
  _DWORD *v6; // eax
  unsigned int v8; // [esp+8h] [ebp-4h]

  v2 = Src;
  *this = 0;
  this[4] = 0;
  this[5] = 0;
  v4 = Src[4];
  v8 = v4;
  if ( Src[5] >= 0x10u )
    v2 = (_DWORD *)*Src;
  if ( v4 > 0x7FFFFFFF )
    sub_401416();
  this[5] = 15;
  if ( v4 >= 0x10 )
  {
    v5 = sub_4037E8(this, v4);
    v6 = sub_403756(__CFADD__(v5, 1) ? -1 : v5 + 1);
    this[4] = v8;
    *this = v6;
    this[5] = v5;
    memcpy(v6, v2, v8 + 1);
  }
  else
  {
    this[4] = v4;
    memmove(this, v2, 0x10u);
  }
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (00404651) --------------------------------------------------------
void __thiscall sub_404651(_DWORD *this, size_t Size, _BYTE *a3, int a4)
{
  size_t v4; // esi
  void *v6; // eax
  _BYTE *v7; // ebx
  size_t v8; // edx

  v4 = Size;
  if ( Size )
  {
    v6 = operator new(Size);
    v7 = a3;
    v8 = 0;
    *this = v6;
    do
    {
      *(_BYTE *)(v8 + *this) = *v7;
      ++v8;
      ++v7;
    }
    while ( v8 < v4 );
    Size = 0;
    this[1] = v4;
    sub_4046D0((int *)&Size);
  }
}

//----- (00404691) --------------------------------------------------------
void __thiscall sub_404691(void **this)
{
  unsigned int *v2; // esi
  unsigned int i; // ebx

  v2 = (unsigned int *)(this + 1);
  if ( *this )
  {
    for ( i = 0; i < *v2; ++i )
      sub_4044EF((void **)*this + 2 * i);
    j_free(*this);
  }
  *this = 0;
  *v2 = 0;
}

//----- (004046D0) --------------------------------------------------------
void __thiscall sub_4046D0(int *this)
{
  int v1; // esi

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
      j_free(*(void **)v1);
    *(_DWORD *)(v1 + 4) = 0;
    *(_DWORD *)v1 = 0;
  }
}

//----- (004046ED) --------------------------------------------------------
_DWORD *__thiscall sub_4046ED(_DWORD *this)
{
  _DWORD *v1; // esi
  unsigned int v2; // edi
  unsigned int v3; // ebx
  size_t v4; // ebx
  int v7; // [esp+18h] [ebp-28h]
  int v8; // [esp+1Ch] [ebp-24h]
  unsigned int v9; // [esp+20h] [ebp-20h]
  size_t v10; // [esp+24h] [ebp-1Ch]
  void *Block[2]; // [esp+28h] [ebp-18h] BYREF
  int v12; // [esp+30h] [ebp-10h]
  int v13; // [esp+3Ch] [ebp-4h]

  v1 = this;
  v2 = 0;
  v3 = dword_40A404;
  *this = 0;
  v9 = v3;
  this[1] = 0;
  sub_404C1C((void **)this, v3);
  v13 = 0;
  v12 = 1;
  if ( v3 )
  {
    do
    {
      v8 = dword_40A424;
      v7 = dword_40A400;
      v10 = *(_DWORD *)(dword_40A400 + 8 * v2 + 4);
      *(_QWORD *)Block = 0i64;
      sub_404F0B(Block, v10);
      v12 |= 2u;
      v4 = 0;
      if ( v10 )
      {
        do
        {
          *((_BYTE *)Block[0] + v4) = *(_BYTE *)(*(_DWORD *)(v7 + 8 * v2) + v4) ^ *(_BYTE *)(*(_DWORD *)(v8 + 8 * v2)
                                                                                           + v4);
          ++v4;
        }
        while ( v4 < v10 );
        v1 = this;
      }
      sub_404C9F(8 * v2 + *v1, Block);
      if ( Block[0] )
        j_free(Block[0]);
      Block[1] = 0;
      Block[0] = 0;
      ++v2;
    }
    while ( v2 < v9 );
  }
  return v1;
}
// 40A400: using guessed type int dword_40A400;
// 40A404: using guessed type int dword_40A404;
// 40A424: using guessed type int dword_40A424;

//----- (004047C7) --------------------------------------------------------
_DWORD *__usercall sub_4047C7@<eax>(_DWORD *a1@<edx>, _DWORD *a2@<ecx>, _DWORD *a3)
{
  _DWORD *v3; // esi
  unsigned int v4; // edi
  unsigned int v5; // ebx
  size_t i; // ebx
  _DWORD *v9; // [esp+18h] [ebp-34h]
  _DWORD *v10; // [esp+1Ch] [ebp-30h]
  unsigned int v12; // [esp+28h] [ebp-24h]
  unsigned int v13; // [esp+2Ch] [ebp-20h]
  size_t v14; // [esp+30h] [ebp-1Ch]
  void *Block[2]; // [esp+34h] [ebp-18h] BYREF
  int v16; // [esp+3Ch] [ebp-10h]
  int v17; // [esp+48h] [ebp-4h]

  v3 = a2;
  v4 = 0;
  v17 = 0;
  v16 = 0;
  v5 = a1[1];
  *a2 = 0;
  v12 = v5;
  a2[1] = 0;
  sub_404C1C((void **)a2, v5);
  v17 = 0;
  v16 = 1;
  v13 = 0;
  if ( v5 )
  {
    do
    {
      v9 = (_DWORD *)(8 * v4 + *a3);
      v10 = (_DWORD *)(8 * v4 + *a1);
      v14 = v10[1];
      *(_QWORD *)Block = 0i64;
      sub_404F0B(Block, v14);
      v16 |= 2u;
      if ( v14 )
      {
        for ( i = 0; i < v14; ++i )
          *((_BYTE *)Block[0] + i) = *(_BYTE *)(*v10 + i) + *(_BYTE *)(*v9 + i);
        v3 = a2;
        v4 = v13;
        v5 = v12;
      }
      sub_404C9F(8 * v4 + *v3, Block);
      if ( Block[0] )
        j_free(Block[0]);
      Block[1] = 0;
      Block[0] = 0;
      v13 = ++v4;
    }
    while ( v4 < v5 );
  }
  return v3;
}

//----- (004048B4) --------------------------------------------------------
int __fastcall sub_4048B4(int a1, const char *a2)
{
  int v3; // ebx
  unsigned int v4; // edx
  int v5; // eax
  int v6; // eax
  unsigned int v7; // ecx
  int v8; // eax
  int v9; // eax
  int i; // ecx
  int v11; // eax
  int v12; // ecx
  int v13; // eax
  bool v14; // cf
  int v15; // eax
  int v16; // edx
  int v17; // eax
  int j; // ecx
  int v19; // eax
  int v20; // ecx
  int v22; // [esp+10h] [ebp-34h] BYREF
  char v23; // [esp+14h] [ebp-30h]
  const char *v24; // [esp+18h] [ebp-2Ch]
  int v25; // [esp+1Ch] [ebp-28h]
  unsigned int v26; // [esp+20h] [ebp-24h]
  int v27; // [esp+28h] [ebp-1Ch]
  __int64 v28; // [esp+2Ch] [ebp-18h]
  int v29; // [esp+40h] [ebp-4h]

  v24 = a2;
  v25 = a1;
  v3 = 0;
  v4 = strlen(a2);
  v5 = *(_DWORD *)a1;
  v26 = v4;
  v6 = *(_DWORD *)(v5 + 4);
  v7 = *(_DWORD *)(v6 + a1 + 32);
  v8 = *(_DWORD *)(v6 + a1 + 36);
  if ( v8 >= 0 && (v8 > 0 || v7 && v7 > v4) )
  {
    v27 = (__PAIR64__(v8, v7) - v4) >> 32;
    HIDWORD(v28) = v7 - v4;
  }
  else
  {
    v28 = 0i64;
    v27 = 0;
  }
  sub_404BB5(&v22, a1);
  v29 = 0;
  if ( v23 )
  {
    LOBYTE(v29) = 1;
    if ( (*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a1 + 4) + a1 + 20) & 0x1C0) != 64 )
    {
      v9 = HIDWORD(v28);
      for ( i = v27; i >= 0 && (i > 0 || v9); v27 = i )
      {
        v11 = *(_DWORD *)(*(_DWORD *)a1 + 4);
        v12 = *(_DWORD *)(v11 + a1 + 56);
        LOBYTE(v11) = *(_BYTE *)(v11 + a1 + 64);
        if ( std::streambuf::sputc(v12, v11) == -1 )
        {
          v3 = 4;
          goto LABEL_16;
        }
        v14 = HIDWORD(v28) != 0;
        v9 = --HIDWORD(v28);
        i = v14 + v27 - 1;
      }
    }
    v15 = std::streambuf::sputn(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a1 + 4) + a1 + 56), v24, v26, 0);
    if ( v15 != v26 || v16 )
    {
LABEL_25:
      v3 = 4;
    }
    else
    {
      v17 = HIDWORD(v28);
      for ( j = v27; j >= 0 && (j > 0 || v17); v27 = j )
      {
        v19 = *(_DWORD *)(*(_DWORD *)a1 + 4);
        v20 = *(_DWORD *)(v19 + a1 + 56);
        LOBYTE(v19) = *(_BYTE *)(v19 + a1 + 64);
        if ( std::streambuf::sputc(v20, v19) == -1 )
          goto LABEL_25;
        v14 = HIDWORD(v28) != 0;
        v17 = --HIDWORD(v28);
        j = v14 + v27 - 1;
      }
    }
LABEL_16:
    v13 = *(_DWORD *)(*(_DWORD *)a1 + 4);
    *(_DWORD *)(v13 + a1 + 32) = 0;
    *(_DWORD *)(v13 + a1 + 36) = 0;
    v29 = 0;
  }
  else
  {
    v3 = 4;
  }
  std::ios::setstate(a1 + *(_DWORD *)(*(_DWORD *)a1 + 4), v3, 0);
  sub_404B64(&v22);
  return a1;
}
// 4048F6: conditional instruction was optimized away because eax.4==0
// 4048F8: conditional instruction was optimized away because eax.4==0
// 4049BE: variable 'v16' is possibly undefined
// 40709C: using guessed type int __thiscall std::streambuf::sputn(_DWORD, _DWORD, _DWORD, _DWORD);
// 4070B8: using guessed type int __thiscall std::streambuf::sputc(_DWORD, _DWORD);

//----- (00404A45) --------------------------------------------------------
int __cdecl sub_404A45(int a1)
{
  unsigned __int8 v1; // al

  v1 = std::ios::widen(a1 + *(_DWORD *)(*(_DWORD *)a1 + 4), 10);
  std::ostream::put(a1, v1);
  std::ostream::flush(a1);
  return a1;
}
// 404A45: using guessed type int __cdecl sub_404A45(int);
// 4070A4: using guessed type int __thiscall std::ios::widen(_DWORD, _DWORD);
// 4070A8: using guessed type int __thiscall std::ostream::put(_DWORD, _DWORD);
// 4070AC: using guessed type int __thiscall std::ostream::flush(_DWORD);

//----- (00404A74) --------------------------------------------------------
void *__fastcall sub_404A74(unsigned int a1)
{
  if ( !a1 )
    return 0;
  if ( a1 > 0x1FFFFFFF )
    sub_4013C3();
  return operator new(8 * a1);
}
// 4013C3: using guessed type void __noreturn sub_4013C3(void);

//----- (00404A94) --------------------------------------------------------
_DWORD *__thiscall sub_404A94(_DWORD *this, int a2, int a3, char a4)
{
  size_t v4; // ebx
  int v5; // esi
  _DWORD *v6; // ecx
  _DWORD *v7; // esi
  _DWORD *v8; // eax
  unsigned int v10; // [esp+Ch] [ebp-Ch]
  _DWORD *v12; // [esp+14h] [ebp-4h]

  v4 = this[4];
  if ( v4 == 0x7FFFFFFF )
    sub_401416();
  v10 = this[5];
  v5 = sub_4037E8(this, v4 + 1);
  v6 = sub_403756(__CFADD__(v5, 1) ? -1 : v5 + 1);
  v12 = v6;
  this[4] = v4 + 1;
  this[5] = v5;
  if ( v10 < 0x10 )
  {
    memcpy(v6, this, v4);
    v8 = v12;
    *((_BYTE *)v12 + v4) = a4;
    *((_BYTE *)v12 + v4 + 1) = 0;
  }
  else
  {
    v7 = (_DWORD *)*this;
    memcpy(v6, (const void *)*this, v4);
    *((_BYTE *)v12 + v4) = a4;
    *((_BYTE *)v12 + v4 + 1) = 0;
    sub_403795(v7, v10 + 1);
    v8 = v12;
  }
  *this = v8;
  return this;
}
// 401416: using guessed type void __noreturn sub_401416(void);

//----- (00404B41) --------------------------------------------------------
int __thiscall sub_404B41(int *this)
{
  int v1; // esi
  int result; // eax

  v1 = *this;
  if ( *this )
  {
    if ( *(_DWORD *)v1 )
    {
      sub_403795(*(_DWORD **)v1, *(_DWORD *)(v1 + 8) - *(_DWORD *)v1);
      result = 0;
      *(_DWORD *)v1 = 0;
      *(_DWORD *)(v1 + 4) = 0;
      *(_DWORD *)(v1 + 8) = 0;
    }
  }
  return result;
}

//----- (00404B64) --------------------------------------------------------
int __thiscall sub_404B64(int *this)
{
  if ( !std::uncaught_exceptions() )
    std::ostream::_Osfx(*this);
  return sub_404C57(this);
}
// 407084: using guessed type int __cdecl std::uncaught_exceptions();
// 407098: using guessed type int __thiscall std::ostream::_Osfx(_DWORD);

//----- (00404BB5) --------------------------------------------------------
_BYTE *__thiscall sub_404BB5(_BYTE *this, int a2)
{
  int v3; // ecx
  bool v4; // bl
  int v5; // ecx
  int v6; // ecx

  *(_DWORD *)this = a2;
  v3 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 56);
  if ( v3 )
    (*(void (__thiscall **)(int))(*(_DWORD *)v3 + 4))(v3);
  v4 = 0;
  v5 = *(_DWORD *)(*(_DWORD *)a2 + 4);
  if ( !*(_DWORD *)(v5 + a2 + 12) )
  {
    v6 = *(_DWORD *)(v5 + a2 + 60);
    if ( !v6 || v6 == a2 )
    {
      v4 = 1;
    }
    else
    {
      std::ostream::flush(v6);
      v4 = *(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 12) == 0;
    }
  }
  this[4] = v4;
  return this;
}
// 4070AC: using guessed type int __thiscall std::ostream::flush(_DWORD);

//----- (00404C1C) --------------------------------------------------------
void **__thiscall sub_404C1C(void **this, unsigned int a2)
{
  unsigned int i; // ecx
  _DWORD *v4; // eax

  this[1] = 0;
  *this = 0;
  if ( a2 )
  {
    *this = sub_404A74(a2);
    for ( i = 0; i < a2; ++i )
    {
      v4 = *this;
      v4[2 * i + 1] = 0;
      v4[2 * i] = 0;
    }
    this[1] = (void *)a2;
  }
  return this;
}

//----- (00404C57) --------------------------------------------------------
int __thiscall sub_404C57(int *this)
{
  int v1; // ecx
  int result; // eax
  int v3; // ecx

  v1 = *this;
  result = *(_DWORD *)(*(_DWORD *)v1 + 4);
  v3 = *(_DWORD *)(result + v1 + 56);
  if ( v3 )
    return (*(int (**)(void))(*(_DWORD *)v3 + 8))();
  return result;
}

//----- (00404C9F) --------------------------------------------------------
int __thiscall sub_404C9F(int this, _DWORD *a2)
{
  int result; // eax

  if ( (_DWORD *)this != a2 )
  {
    if ( *(_DWORD *)this )
      j_free(*(void **)this);
    *(_DWORD *)(this + 4) = 0;
    *(_DWORD *)this = 0;
    *(_DWORD *)this = *a2;
    result = a2[1];
    *(_DWORD *)(this + 4) = result;
    a2[1] = 0;
    *a2 = 0;
  }
  return result;
}

//----- (00404CD6) --------------------------------------------------------
int __usercall sub_404CD6@<eax>(_DWORD *a1@<edx>, int a2@<ecx>, unsigned __int8 a3)
{
  int v5; // edi
  int v6; // eax
  int v7; // ecx
  _BYTE *v8; // eax
  int i; // eax
  char v10; // dl
  int v11; // eax
  unsigned int v12; // ecx
  bool v13; // cf
  _DWORD *v14; // eax
  int v15; // eax
  int v17; // [esp+10h] [ebp-2Ch] BYREF
  char v18; // [esp+14h] [ebp-28h]
  int v19; // [esp+18h] [ebp-24h]
  int v20; // [esp+1Ch] [ebp-20h]
  int v21; // [esp+20h] [ebp-1Ch]
  char v22; // [esp+27h] [ebp-15h]
  int v23; // [esp+28h] [ebp-14h]
  int v24; // [esp+38h] [ebp-4h]

  v21 = a2;
  v22 = 0;
  v5 = 0;
  v6 = *(_DWORD *)a2;
  v20 = 0;
  v17 = a2;
  v7 = *(_DWORD *)(*(_DWORD *)(v6 + 4) + a2 + 56);
  if ( v7 )
    (*(void (__thiscall **)(int))(*(_DWORD *)v7 + 4))(v7);
  v18 = std::istream::_Ipfx(a2, 1);
  v24 = 1;
  if ( !v18 )
    goto LABEL_20;
  LOBYTE(v24) = 2;
  v8 = a1;
  if ( a1[5] >= 0x10u )
    v8 = (_BYTE *)*a1;
  a1[4] = 0;
  *v8 = 0;
  v19 = a3;
  for ( i = std::streambuf::sgetc(*(_DWORD *)(*(_DWORD *)(*(_DWORD *)a2 + 4) + a2 + 56));
        ;
        i = std::streambuf::snextc(*(_DWORD *)(*(_DWORD *)(v15 + 4) + a2 + 56)) )
  {
    v10 = i;
    if ( i == -1 )
    {
      v5 = 1;
      goto LABEL_19;
    }
    if ( i == v19 )
    {
      v11 = *(_DWORD *)a2;
      v22 = 1;
      std::streambuf::sbumpc(*(_DWORD *)(*(_DWORD *)(v11 + 4) + a2 + 56));
      goto LABEL_19;
    }
    v12 = a1[4];
    if ( v12 >= 0x7FFFFFFF )
      break;
    LOBYTE(v23) = i;
    if ( v12 >= a1[5] )
    {
      sub_404A94(a1, v12, v20, v23);
    }
    else
    {
      v13 = a1[5] < 0x10u;
      a1[4] = v12 + 1;
      v14 = a1;
      if ( !v13 )
        v14 = (_DWORD *)*a1;
      *((_BYTE *)v14 + v12) = v10;
      *((_BYTE *)v14 + v12 + 1) = 0;
    }
    v15 = *(_DWORD *)a2;
    v22 = 1;
  }
  v5 = 2;
LABEL_19:
  v24 = 1;
  if ( !v22 )
LABEL_20:
    v5 |= 2u;
  std::ios::setstate(a2 + *(_DWORD *)(*(_DWORD *)a2 + 4), v5, 0);
  sub_404C57(&v17);
  return a2;
}
// 407090: using guessed type int __thiscall std::istream::_Ipfx(_DWORD, _DWORD);
// 407094: using guessed type int __thiscall std::streambuf::snextc(_DWORD);
// 4070B0: using guessed type int __thiscall std::streambuf::sbumpc(_DWORD);
// 4070B4: using guessed type int __thiscall std::streambuf::sgetc(_DWORD);

//----- (00404E21) --------------------------------------------------------
char *__thiscall sub_404E21(char **this, char *a2, int a3, int a4)
{
  char *v5; // eax
  size_t v6; // edi
  char *v7; // ecx
  unsigned int v8; // eax
  size_t v9; // esi
  char *v10; // esi
  char *result; // eax
  size_t v12; // eax
  char *v13; // edi
  char *v14; // esi
  char *v15; // esi
  unsigned int v16; // [esp+10h] [ebp-Ch]
  int v17; // [esp+18h] [ebp-4h]

  v5 = this[2];
  v6 = a3 - (_DWORD)a2;
  v7 = *this;
  v8 = v5 - v7;
  if ( a3 - (int)a2 <= v8 )
  {
    v12 = this[1] - v7;
    if ( v6 <= v12 )
    {
      v15 = &v7[v6];
      result = (char *)memmove(v7, a2, a3 - (_DWORD)a2);
      this[1] = v15;
    }
    else
    {
      v13 = &a2[v12];
      memmove(v7, a2, this[1] - v7);
      v14 = this[1];
      memmove(v14, v13, a3 - (_DWORD)v13);
      result = &v14[a3 - (_DWORD)v13];
      this[1] = result;
    }
  }
  else
  {
    v9 = 0x7FFFFFFF;
    v17 = 0x7FFFFFFF;
    if ( v6 > 0x7FFFFFFF )
      sub_40381C();
    v16 = v8 >> 1;
    if ( v8 <= 0x7FFFFFFF - (v8 >> 1) )
    {
      v9 = v8 + v16;
      if ( v8 + v16 < v6 )
        v9 = a3 - (_DWORD)a2;
      v17 = v9;
    }
    if ( v7 )
    {
      sub_403795(v7, v8);
      *this = 0;
      this[1] = 0;
      this[2] = 0;
    }
    v10 = (char *)sub_403756(v9);
    *this = v10;
    this[1] = v10;
    this[2] = &v10[v17];
    memmove(v10, a2, v6);
    result = &v10[v6];
    this[1] = &v10[v6];
  }
  return result;
}
// 40381C: using guessed type void __noreturn sub_40381C(void);

//----- (00404F0B) --------------------------------------------------------
_DWORD *__thiscall sub_404F0B(_DWORD *this, size_t Size)
{
  size_t v3; // edi
  size_t i; // ecx

  v3 = Size;
  this[1] = 0;
  *this = 0;
  if ( v3 )
  {
    *this = operator new(v3);
    for ( i = 0; i < v3; ++i )
      *(_BYTE *)(*this + i) = 0;
    Size = 0;
    this[1] = v3;
    sub_4046D0((int *)&Size);
  }
  return this;
}

//----- (00404F50) --------------------------------------------------------
__m128i *__cdecl sub_404F50(__m128i *a1, __m128i *a2)
{
  __m128i *result; // eax
  __m128i *v9; // edx
  __m128i v10; // xmm0
  __m128i v11; // xmm1
  __int8 v12; // dl

  result = a1;
  _ESI = a2;
  if ( (unsigned int)((char *)a2 - (char *)a1) >= 0x40 && (dword_40A004 & 0x20) != 0 )
  {
    __asm { vmovdqu ymm2, ds:ymmword_407200 }
    do
    {
      __asm { vpermq  ymm0, ymmword ptr [eax], 4Eh ; 'N' }
      _ESI -= 2;
      __asm
      {
        vpshufb ymm1, ymm0, ymm2
        vpermq  ymm0, ymmword ptr [esi], 4Eh ; 'N'
        vpshufb ymm0, ymm0, ymm2
        vmovdqu ymmword ptr [eax], ymm0
      }
      result += 2;
      __asm { vmovdqu ymmword ptr [esi], ymm1 }
    }
    while ( result != (__m128i *)&a1->m128i_i8[((unsigned int)((char *)a2 - (char *)a1) >> 1) & 0x7FFFFFE0] );
  }
  if ( (unsigned int)((char *)_ESI - (char *)result) >= 0x20 && (dword_40A004 & 4) != 0 )
  {
    v9 = (__m128i *)((char *)result + (((unsigned int)((char *)_ESI - (char *)result) >> 1) & 0x7FFFFFF0));
    do
    {
      v10 = _ESI[-1];
      --_ESI;
      v11 = _mm_shuffle_epi8(*result, (__m128i)xmmword_4071E0);
      *result++ = _mm_shuffle_epi8(v10, (__m128i)xmmword_4071E0);
      *_ESI = v11;
    }
    while ( result != v9 );
  }
  for ( ; result != _ESI; _ESI->m128i_i8[0] = v12 )
  {
    _ESI = (__m128i *)((char *)_ESI - 1);
    if ( result == _ESI )
      break;
    v12 = result->m128i_i8[0];
    result->m128i_i8[0] = _ESI->m128i_i8[0];
    result = (__m128i *)((char *)result + 1);
  }
  return result;
}
// 404F50: unsupported processor register 'ymm2'
// 4071E0: using guessed type __int128 xmmword_4071E0;
// 40A004: using guessed type int dword_40A004;

//----- (004051A8) --------------------------------------------------------
void __cdecl sub_4051A8(void *Block)
{
  j_free(Block);
}

//----- (004051B6) --------------------------------------------------------
_DWORD *__thiscall sub_4051B6(_DWORD *Block, char a2)
{
  *Block = &type_info::`vftable';
  if ( (a2 & 1) != 0 )
    sub_4051A8(Block);
  return Block;
}
// 407224: using guessed type void *type_info::`vftable';

//----- (00405746) --------------------------------------------------------
int sub_405746()
{
  __scrt_initialize_default_local_stdio_options();
  return 0;
}
// 405E30: using guessed type int __scrt_initialize_default_local_stdio_options(void);

//----- (0040574E) --------------------------------------------------------
int sub_40574E()
{
  int v0; // eax

  sub_405CEC();
  v0 = UserMathErrorFunction();
  return set_new_mode(v0);
}

//----- (004058EC) --------------------------------------------------------
int sub_4058EC()
{
  int v5; // edi
  int v11; // eax
  int v12; // edi
  int v18; // eax
  int v19; // eax
  int v20; // eax
  int v22; // [esp+0h] [ebp-24h]
  char v23; // [esp+10h] [ebp-14h]
  int v24; // [esp+18h] [ebp-Ch]
  int v25; // [esp+1Ch] [ebp-8h]
  int v26; // [esp+20h] [ebp-4h]
  int v27; // [esp+20h] [ebp-4h]

  dword_40A3D8 = 0;
  dword_40A004 |= 1u;
  if ( IsProcessorFeaturePresent(0xAu) )
  {
    _EAX = 0;
    __asm { cpuid }
    v24 = _EAX;
    v5 = _EBX ^ 0x756E6547;
    v26 = _EDX ^ 0x49656E69;
    v25 = _ECX ^ 0x6C65746E;
    _EAX = 1;
    __asm { cpuid }
    v22 = _EAX;
    if ( !(v5 | v25 | v26)
      && ((v11 = _EAX & 0xFFF3FF0, (v22 & 0xFFF3FF0) == 67264)
       || v11 == 132704
       || v11 == 132720
       || v11 == 198224
       || v11 == 198240
       || v11 == 198256) )
    {
      v12 = dword_40A3DC | 1;
      dword_40A3DC |= 1u;
    }
    else
    {
      v12 = dword_40A3DC;
    }
    _EAX = 7;
    v27 = _ECX;
    if ( v24 < 7 )
    {
      _EBX = 0;
    }
    else
    {
      __asm { cpuid }
      _ECX = v27;
      if ( (_EBX & 0x200) != 0 )
        dword_40A3DC = v12 | 2;
    }
    v18 = dword_40A004 | 2;
    dword_40A3D8 = 1;
    dword_40A004 |= 2u;
    if ( (_ECX & 0x100000) != 0 )
    {
      v19 = v18 | 4;
      dword_40A3D8 = 2;
      dword_40A004 = v19;
      if ( (_ECX & 0x8000000) != 0 && (_ECX & 0x10000000) != 0 )
      {
        __asm { xgetbv }
        v23 = v19;
        if ( (v19 & 6) == 6 )
        {
          v20 = dword_40A004 | 8;
          dword_40A3D8 = 3;
          dword_40A004 |= 8u;
          if ( (_EBX & 0x20) != 0 )
          {
            dword_40A3D8 = 5;
            dword_40A004 = v20 | 0x20;
            if ( (_EBX & 0xD0030000) == -805109760 && (v23 & 0xE0) == 224 )
            {
              dword_40A004 |= 0x40u;
              dword_40A3D8 = 6;
            }
          }
        }
      }
    }
  }
  return 0;
}
// 4058EC: could not find valid save-restore pair for ebx
// 40A004: using guessed type int dword_40A004;
// 40A3D8: using guessed type int dword_40A3D8;
// 40A3DC: using guessed type int dword_40A3DC;

//----- (00405AC0) --------------------------------------------------------
_DWORD *__thiscall sub_405AC0(_DWORD *this)
{
  _DWORD *result; // eax

  this[1] = 0;
  result = this;
  this[2] = 0;
  this[1] = "bad allocation";
  *this = &std::bad_alloc::`vftable';
  return result;
}
// 407240: using guessed type void *std::bad_alloc::`vftable';

//----- (00405AD8) --------------------------------------------------------
void __noreturn sub_405AD8()
{
  _DWORD pExceptionObject[3]; // [esp+0h] [ebp-Ch] BYREF

  sub_405AC0(pExceptionObject);
  CxxThrowException(pExceptionObject, (_ThrowInfo *)&_TI2_AVbad_alloc_std__);
}
// 405AD8: using guessed type void __noreturn sub_405AD8();
// 405AD8: using guessed type _DWORD pExceptionObject[3];

//----- (00405B77) --------------------------------------------------------
int sub_405B77()
{
  return 1;
}

//----- (00405CA7) --------------------------------------------------------
int __cdecl UserMathErrorFunction()
{
  return 0;
}

//----- (00405CAA) --------------------------------------------------------
bool sub_405CAA()
{
  HMODULE ModuleHandleW; // eax
  char *v1; // ecx
  bool result; // al

  ModuleHandleW = GetModuleHandleW(0);
  result = ModuleHandleW
        && *(_WORD *)ModuleHandleW == 23117
        && (v1 = (char *)ModuleHandleW + *((_DWORD *)ModuleHandleW + 15), *(_DWORD *)v1 == 17744)
        && *((_WORD *)v1 + 12) == 267
        && *((_DWORD *)v1 + 29) > 0xEu
        && *((_DWORD *)v1 + 58) != 0;
  return result;
}

//----- (00405CEC) --------------------------------------------------------
LPTOP_LEVEL_EXCEPTION_FILTER sub_405CEC()
{
  return SetUnhandledExceptionFilter(__scrt_unhandled_exception_filter);
}

//----- (00405D4E) --------------------------------------------------------
void sub_405D4E()
{
  dword_40A3E0 = 0;
}
// 40A3E0: using guessed type int dword_40A3E0;

//----- (00405DF4) --------------------------------------------------------
void sub_405DF4()
{
  InitializeSListHead(&ListHead);
}

//----- (00405E00) --------------------------------------------------------
char sub_405E00()
{
  return 1;
}

//----- (00405E24) --------------------------------------------------------
void *sub_405E24()
{
  return &unk_40A3F0;
}

//----- (00405E2A) --------------------------------------------------------
void *sub_405E2A()
{
  return &unk_40A3F8;
}

//----- (00405E4D) --------------------------------------------------------
BOOL sub_405E4D()
{
  return dword_40A010 == 0;
}
// 40A010: using guessed type int dword_40A010;

//----- (00405E59) --------------------------------------------------------
void *sub_405E59()
{
  return &unk_40A430;
}

//----- (00405E5F) --------------------------------------------------------
void *sub_405E5F()
{
  return &unk_40A42C;
}

//----- (00405E65) --------------------------------------------------------
void sub_405E65()
{
  ;
}
// 405E65: could not find valid save-restore pair for edi

//----- (00405E91) --------------------------------------------------------
void __cdecl sub_405E91()
{
  ;
}
// 405E91: could not find valid save-restore pair for edi

//----- (004060C3) --------------------------------------------------------
// positive sp value has been detected, the output may be wrong!
void sub_4060C3()
{
  ;
}
// 4060E3: positive sp value 18 has been found
// 4060E4: unbalanced stack, ignored a potential tail call

//----- (0040695D) --------------------------------------------------------
void __cdecl sub_40695D()
{
  sub_404691((void **)&dword_40A400);
}
// 40A400: using guessed type int dword_40A400;

//----- (00406967) --------------------------------------------------------
void __cdecl sub_406967()
{
  sub_404691((void **)&dword_40A424);
}
// 40A424: using guessed type int dword_40A424;

//----- (00406971) --------------------------------------------------------
void __cdecl sub_406971()
{
  sub_404691((void **)&dword_40A408);
}

//----- (0040697B) --------------------------------------------------------
void __cdecl sub_40697B()
{
  if ( Block )
  {
    sub_403795(Block, ((_BYTE *)*(&Block + 2) - (_BYTE *)Block) & 0xFFFFFFFC);
    Block = 0;
    *(&Block + 1) = 0;
    *(&Block + 2) = 0;
  }
}

// nfuncs=235 queued=143 decompiled=143 lumina nreq=0 worse=0 better=0
// ALL OK, 143 function(s) have been successfully decompiled
